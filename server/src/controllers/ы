короче кидаю весь проект который я планирую показывать на совсебе на стажера/джуна по фулстаку # Features

## Authentication

Register with email/password. Login with credentials. JWT stored in localStorage, included in all requests.
Password hashing with bcrypt (10 rounds). User scoping on all database queries.

## Projects

Create projects with title and color. Mark as favorite for quick access. View all projects in sidebar.
Update project details. Delete project (cascade deletes sections and tasks).

## Tasks

Create tasks in a project or standalone. Edit title, priority, deadline, comment.
Set priority (1-4). Set deadline with day picker. Mark complete/incomplete.
Add subtasks to break down work. Delete task (cascade deletes subtasks).

## Sections

Create sections within projects to organize tasks.
Update section title. Delete section (tasks are removed).
Tasks can be assigned to sections or left unsectionized.

## Task Organization

Tasks grouped by project and section. View all tasks or filter by project.
Subtasks nested under parent task. Show task hierarchy.

## User Profile

View current user info (email, username, created date).
Update username or email. Delete account (removes all user data).
See statistics (project count, active tasks).

## Responsive Design

Desktop: Sidebar navigation on left, main content on right.

Mobile: Bottom drawer for navigation, header at top.

Safe area handling for iOS notch and home indicator.

Touch-friendly button sizes and spacing.

## Mobile Features

Bottom drawer for projects navigation. Mobile-optimized forms.
Header menu access on mobile. Responsive task card layout.

## What's Working

All core CRUD operations for projects, tasks.

User authentication and profile management.

Responsive mobile and desktop layouts.

Task priorities and deadlines.

Subtask support.

## What's Planned

Phase 2:

- Drag-and-drop task reordering
- Search and filtering
- Sections
- Keyboard shortcuts
- better error handling
- board mode
- Automated tests

Phase 3:

- Analytics dashboard
- Productivity trends
import { api } from "@/api/client";
import type { User } from "@/types/user";

export const authApi = {
  login: (credentials: { email: string; password: string }) =>
    api.post<{ user: User }>("/auth/login", credentials),

  logout: () => api.post<void>("/auth/logout", null),

  register: (data: { userName: string; email: string; password: string }) =>
    api.post<{ user: User }>("/auth/register", data),

  getMe: () => api.get<User>("/auth/me"),

  updateMe: (data: Partial<User>) => api.patch<User>("/auth/me", data),
  deleteMe: () => api.delete<void>("/auth/me"),
};const BASE_URL = import.meta.env.VITE_API_URL;

interface ApiRequestOptions extends Omit<RequestInit, "body"> {
  body?: unknown;
}

async function apiRequest<T>(
  endpoint: string,
  options: ApiRequestOptions = {},
): Promise<T> {
  const { body, ...customConfig } = options;

  const headers: Record<string, string> = {
    "Content-Type": "application/json",
  };

  const config: RequestInit = {
    ...customConfig,
    headers: { ...headers, ...customConfig.headers },
  };

  if (body) config.body = JSON.stringify(body);

  const response = await fetch(`${BASE_URL}${endpoint}`, {
    ...config,
    credentials: "include",
  });

  if (!response.ok) {
    let errorMessage = "Something went wrong";
    try {
      const errorData = await response.json();
      errorMessage = errorData.error || errorData.message || errorMessage;
    } catch {
      errorMessage = response.statusText;
    }
    throw new Error(errorMessage);
  }

  if (response.status === 204) return {} as T;
  return response.json();
}

export const api = {
  get: <T>(url: string) => apiRequest<T>(url, { method: "GET" }),
  post: <T>(url: string, body: unknown) =>
    apiRequest<T>(url, { method: "POST", body }),
  patch: <T>(url: string, body: unknown) =>
    apiRequest<T>(url, { method: "PATCH", body }),
  delete: <T>(url: string) => apiRequest<T>(url, { method: "DELETE" }),
};import { api } from "@/api/client";
import type { Project } from "@/types/project";

export const projectsApi = {
  fetchProjects: () => api.get<Project[]>("/projects"),
  fetchProjectBoard: (id: string) => api.get<Project>(`/projects/${id}`),
  createProject: (data: { title: string; color: string; favorites: boolean }) =>
    api.post<Project>("/projects", data),

  updateProject: (id: string, data: Partial<Project>) =>
    api.patch<Project>(`/projects/${id}`, data),

  deleteProject: (id: string) => api.delete(`/projects/${id}`),
};import { api } from "@/api/client";
import type { Section } from "@/types/section";

export const sectionApi = {
  createSection: (data: { title: string; order: number; projectId: string }) =>
    api.post<Section>("/sections", data),

  updateSection: (id: string, data: Partial<Section>) =>
    api.patch<Section>(`/sections/${id}`, data),

  deleteSection: (id: string) => api.delete(`/sections/${id}`),
};import { api } from "@/api//client";
import type { Task } from "@/types/tasks";

type FetchTasksParams = {
  projectId?: string | null;
  sectionId?: string | null;
  parentId?: string | null;
  isDone?: boolean;
  deadline?: string;
  userId?: string;
};

export const tasksApi = {
  fetchTasks: (params?: FetchTasksParams) => {
    const query = new URLSearchParams();

    if (params) {
      Object.entries(params).forEach(([key, value]) => {
        if (value !== undefined) {
          query.append(key, value === null ? "null" : String(value));
        }
      });
    }

    return api.get<Task[]>(`/tasks?${query.toString()}`);
  },
  createTask: (data: Partial<Task>) => api.post<Task>("/tasks", data),

  updateInfo: (id: string, data: Partial<Task>) =>
    api.patch<Task>(`/tasks/${id}`, data),

  updateStatus: (id: string, isDone: boolean) =>
    api.patch<Task>(`/tasks/${id}`, { isDone }),

  deleteTask: (id: string) => api.delete(`/tasks/${id}`),
  fetchTodayTasks: () => {
    const today = new Date().toISOString().split("T")[0];
    return tasksApi.fetchTasks({ deadline: today, isDone: false });
  },

  fetchAllCompleted: () => tasksApi.fetchTasks({ isDone: true }),

  fetchProjectTasks: (projectId: string, showCompleted = false) =>
    tasksApi.fetchTasks({
      projectId,
      ...(showCompleted ? {} : { isDone: false }),
    }),

  fetchInboxTasks: () => tasksApi.fetchTasks({ projectId: null }),
};import { useState, useMemo, useCallback } from "react";
import type { ReactNode } from "react";
import { addDays, startOfToday } from "date-fns";
import { useTranslation } from "react-i18next";
import {
  useFloating,
  autoUpdate,
  offset,
  flip,
  shift,
  useInteractions,
  useClick,
  useDismiss,
  FloatingPortal,
} from "@floating-ui/react";

import { generateTimeOptions } from "../../utils/timeUtils";
import { generateDatePresets } from "../../utils/dateFormatters";
import { formatDateLabel, dateColor } from "../../utils/dateFormatters";
import { useIsMobile } from "../../hooks/useIsMobile";
import { MobileDrawer } from "../../features/MobileDrawer";
import { SharedDayPicker } from "./SharedDayPicker";
import { QuickDateButtons } from "./Quickdatebuttons";
import { TimeSelector } from "./Timeselector";
import { localeMap } from "@/i18n";
import { enUS } from "date-fns/locale";

interface CalendarProps {
  date: Date | null;
  time: string | null;
  setIsCalOpen?: (val: boolean) => void;
  setDate: (val: Date | null) => void;
  setTime: (val: string | null) => void;
  children?: ReactNode;
}

const STEP = 30;

export const Calendar = (props: CalendarProps) => {
  const isMobile = useIsMobile();
  const { date, time, setDate, setTime, setIsCalOpen, children } = props;
  const { t, i18n } = useTranslation();
  const langKey = i18n.language.split("-")[0];
  const locale = localeMap[langKey] ?? enUS;
  const [open, setOpen] = useState(false);

  const handleOpenChange = useCallback(
    (value: boolean) => {
      setOpen(value);
      setIsCalOpen?.(value);
    },
    [setIsCalOpen],
  );

  const { refs, floatingStyles, context, isPositioned } = useFloating({
    open,
    onOpenChange: handleOpenChange,
    placement: "left-end",
    whileElementsMounted: autoUpdate,
    strategy: "fixed",
    middleware: [offset(4), flip(), shift({ padding: 10 })],
  });

  const click = useClick(context);

  const dismiss = useDismiss(context, {
    enabled: !isMobile,
    outsidePressEvent: "click",
    outsidePress: (event) => {
      event.stopPropagation();
      event.preventDefault();
      return true;
    },
  });

  const { getReferenceProps, getFloatingProps } = useInteractions([
    click,
    dismiss,
  ]);

  const timeOptions = useMemo(() => generateTimeOptions(STEP), [open]);

  const dates = useMemo(() => generateDatePresets(), [i18n.language]);
  const label = formatDateLabel(date, locale);
  const meta = dateColor(date);

  const handleClearDate = useCallback(
    (e: React.MouseEvent) => {
      e.stopPropagation();
      e.preventDefault();
      setDate(null);
      setTime(null);
    },
    [setDate, setTime],
  );

  const handleTimeChange = useCallback(
    (newTime: string) => {
      if (!date) {
        setDate(new Date());
      }
      setTime(newTime);
    },
    [date, setDate, setTime],
  );

  const handleDaySelect = useCallback(
    (day: Date | undefined) => {
      if (!day) return;
      setDate(day);
    },
    [setDate],
  );

  const selectedDate = date ? new Date(date) : undefined;
  const minDate = useMemo(() => startOfToday(), []);

  const handleClearTime = useCallback(() => {
    setTime("");
  }, [setTime]);

  const buttonColor = meta.color === "#ffffffd9" ? undefined : meta.color;
  const iconColorClass =
    meta.color === "#ffffffd9"
      ? "text-black/80 dark:text-white/80"
      : meta.color;

  return (
    <>
      {children ? (
        <div
          ref={refs.setReference}
          {...getReferenceProps()}
          className="inline-flex"
        >
          {children}
        </div>
      ) : (
        <button
          // eslint-disable-next-line react-hooks/refs
          ref={refs.setReference}
          {...getReferenceProps()}
          onMouseDown={(e) => e.preventDefault()}
          type="button"
          style={{ color: buttonColor }}
          className="focus:outline-none cursor-pointer bg-transparent min-h-[38px] flex justify-between items-center gap-2 bg-transparent border-[0.5px] border-black/20 dark:border-[#d0d0d05a]/60 rounded px-3 h-[35px] w-fit text-sm hover:border-black/40 dark:hover:border-[#888]"
        >
          <div className="truncate flex gap-2 items-center">
            <span
              className={`${meta.icon} text-[1.5em] opacity-70 ${iconColorClass}`}
              style={iconColorClass ? undefined : { color: meta.color }}
            />
            {(date || time) && `${t(label)} ${time || ""}`}
          </div>
          {date && (
            <div
              onClick={handleClearDate}
              className="icon-icons8-close bg-black/10 dark:bg-[#444] p-1.5 text-black dark:text-white rounded-md hover:bg-black/20 dark:hover:bg-[#555]"
            />
          )}
        </button>
      )}

      {!isMobile && open && (
        <FloatingPortal>
          <div
            // eslint-disable-next-line react-hooks/refs
            ref={refs.setFloating}
            style={{
              ...floatingStyles,
              visibility: isPositioned ? "visible" : "hidden",
              opacity: isPositioned ? 1 : 0,
            }}
            {...getFloatingProps()}
            className="z-[9999] flex flex-col gap-2 bg-white dark:bg-[#242424] border border-black/10 dark:border-[#d0d0d05a]/60 rounded-xl p-3 shadow-2xl max-w-[400px]"
          >
            <div className="flex justify-center overflow-hidden">
              <SharedDayPicker
                selected={selectedDate}
                onSelect={handleDaySelect}
                variant="desktop"
              />
            </div>

            <QuickDateButtons
              dates={dates}
              onTimeSelect={setTime}
              currentDate={date}
              onDateSelect={setDate}
              onClose={() => setOpen(false)}
              variant="grid"
            />

            <TimeSelector
              time={time}
              timeOptions={timeOptions}
              onTimeChange={handleTimeChange}
              onClearTime={handleClearTime}
              showClearButton={true}
            />
          </div>
        </FloatingPortal>
      )}

      {isMobile && (
        <MobileDrawer
          open={open}
          onClose={() => setOpen(false)}
          drawerTitle={t("calendar_editor")}
          drawerDescription={t("choose_date_and_time")}
        >
          <div className="flex flex-col gap-4">
            <QuickDateButtons
              dates={dates}
              currentDate={date}
              onDateSelect={setDate}
              onTimeSelect={setTime}
              onClose={() => setOpen(false)}
              variant="vertical"
            />

            <div className="overflow-y-auto flex justify-center items-center">
              <SharedDayPicker
                selected={selectedDate}
                onSelect={handleDaySelect}
                toDate={addDays(minDate, 59)}
                variant="mobile"
                hideCaption={true}
              />
            </div>

            <div className="flex flex-col gap-2">
              <span className="text-sm text-gray-500 dark:text-gray-400">
                {t("reminder")}
              </span>
              <TimeSelector
                onClearTime={() => setTime("")}
                showClearButton={Boolean(time)}
                time={time}
                timeOptions={timeOptions}
                onTimeChange={handleTimeChange}
              />
            </div>
            <button onClick={() => setOpen(false)}>{t("close")}</button>
          </div>
        </MobileDrawer>
      )}
    </>
  );
};

Calendar.displayName = "Calendar";import { useTranslation } from "react-i18next";
import { QuickBtn } from "@/components/QuickBtn";
import { format, isSameDay } from "date-fns";
import { localeMap } from "@/i18n";

interface QuickDateButtonsProps {
  dates: {
    today: Date;
    tomorrow: Date;
    weekend: Date;
    nextWeek: Date;
  };
  currentDate: Date | null;
  onDateSelect: (date: Date | null) => void;
  onTimeSelect: (time: string | null) => void;
  onClose?: () => void;

  variant?: "grid" | "vertical";
}

export const QuickDateButtons = ({
  dates,
  currentDate,
  onDateSelect,
  onTimeSelect,
  onClose,
  variant = "grid",
}: QuickDateButtonsProps) => {
  const { i18n, t } = useTranslation();
  const locale = localeMap[i18n.language];

  const dayName = format(new Date(dates.nextWeek), "EEEE", { locale });
  const nextWeekLabel = t("next_week_label", { day: dayName });
  const handleClick = (date: Date) => {
    onDateSelect(date);
    onClose?.();
  };

  const buttons = [
    {
      label: t("today"),
      icon: "icon-calendar-_2",
      color: "text-[#00c853]",
      value: dates.today,
    },
    {
      label: t("tomorrow"),
      icon: "icon-calendar-_5",
      color: "text-[#ffab00]",
      value: dates.tomorrow,
    },
    {
      label: t("this_weekend"),
      icon: "icon-calendar-_4",
      color: "text-blue-500",
      value: dates.weekend,
    },
    {
      label: nextWeekLabel,
      icon: "icon-calendar-_3",
      color: "text-[#673ab7]",
      value: dates.nextWeek,
    },
  ];

  const containerClass =
    variant === "grid"
      ? "grid grid-cols-2 gap-1"
      : "flex flex-col gap-2 overflow-x-auto px-1";

  return (
    <div className={containerClass}>
      {buttons.map((btn) => (
        <QuickBtn
          key={btn.label}
          label={btn.label}
          icon={btn.icon}
          color={btn.color}
          isActive={currentDate ? isSameDay(currentDate, btn.value) : false}
          onClick={() => handleClick(btn.value)}
        />
      ))}

      {currentDate && (
        <QuickBtn
          icon="icon-icons8-close"
          label={t("delete")}
          color="text-[#ff4444]"
          onClick={() => {
            onDateSelect(null);
            onTimeSelect(null);
            onClose?.();
          }}
        />
      )}
    </div>
  );
};import { useMemo } from "react";
import { DayPicker } from "react-day-picker";
import { startOfDay } from "date-fns";
import { useTranslation } from "react-i18next";
import { localeMap } from "@/i18n";
import { enUS } from "date-fns/locale";
import "react-day-picker/dist/style.css";

interface SharedDayPickerProps {
  selected: Date | undefined;
  onSelect: (day: Date | undefined) => void;
  toDate?: Date;
  variant?: "desktop" | "mobile";
  hideCaption?: boolean;
}

export const SharedDayPicker = ({
  selected,
  onSelect,
  toDate,
  variant = "desktop",
  hideCaption = false,
}: SharedDayPickerProps) => {
  const { i18n } = useTranslation();

  const currentLocale = useMemo(
    () => localeMap[i18n.language] || enUS,
    [i18n.language],
  );

  const desktopStyles = {
    day: {
      cursor: "pointer",
      borderRadius: "50%",
      fontSize: "0.7rem",
      margin: "2px",
    },
    caption_label: {
      borderColor: "#ec4899",
    },
    selected: {
      fontWeight: "bold",
      borderColor: "#ec4899",
      backgroundColor: "#ec4899",
      color: "white",
    },
    today: {
      fontWeight: "bold",
      border: "1px solid #ec4899",
      color: "#ec4899",
    },
    disabled: {
      color: "#727272",
      cursor: "not-allowed",
    },
    day_outside: {
      color: "#a0a0a0",
      cursor: "not-allowed",
    },
  };

  const mobileStyles = {
    caption: { display: hideCaption ? "none" : "block" },
    day: {
      cursor: "pointer",
      borderRadius: "0.5rem",
    },
    selected: {
      backgroundColor: "#673ab7",
      color: "white",
    },
    today: {
      fontWeight: "bold",
      color: "#ff5722",
    },
  };
  const today = startOfDay(new Date());
  const styles = variant === "desktop" ? desktopStyles : mobileStyles;

  return (
    <DayPicker
      locale={currentLocale}
      lang={i18n.language}
      mode="single"
      selected={selected}
      onSelect={onSelect}
      showOutsideDays
      disabled={{ before: today }}
      toDate={toDate}
      className={
        variant === "desktop" ? "w-full h-[300px] overflow-y-auto" : "w-fit"
      }
      styles={styles}
    />
  );
};import { useTranslation } from "react-i18next";

interface TimeSelectorProps {
  time: string | null | undefined;
  timeOptions: Array<{ value: string; label: string }>;
  onTimeChange: (time: string) => void;
  onClearTime: () => void;
  showClearButton: boolean;
}

export const TimeSelector = ({
  time,
  timeOptions,
  onTimeChange,
  onClearTime,
  showClearButton = true,
}: TimeSelectorProps) => {
  const { t } = useTranslation();

  return (
    <div className="mt-2 pt-3 border-t border-black/5 dark:border-white/5">
      <div className="flex items-center justify-between mb-2">
        <span className="text-[10px] uppercase font-bold tracking-widest text-black/40 dark:text-white/40">
          {t("reminder")}
        </span>

        {showClearButton && time && onClearTime && (
          <button
            type="button"
            onClick={onClearTime}
            className="text-[10px] text-[#9d174d] hover:underline"
          >
            {t("remove")}
          </button>
        )}
      </div>

      <select
        value={time ?? ""}
        onChange={(e) => onTimeChange(e.target.value)}
        className="
          w-full
          rounded-xl
          px-4 py-3
          bg-black/5 dark:bg-white/5
          text-black dark:text-white
          outline-none
        "
      >
        <option value="" disabled>
          {t("set_time")}
        </option>

        {timeOptions.map((opt) => (
          <option key={opt.value} value={opt.value}>
            {opt.label}
          </option>
        ))}
      </select>
    </div>
  );
};interface MenuItemProps {
  children: React.ReactNode;
  icon: string;
  onClick: () => void;
  variant?: string;
}

export const MenuItem = ({
  icon,
  onClick,
  children,
  variant = "default",
}: MenuItemProps) => {
  return (
    <li
      onClick={onClick}
      className={`w-full text-left p-2 cursor-pointer rounded transition-colors flex items-center gap-2 ${
        variant === "danger"
          ? "hover:bg-red-50 dark:hover:bg-red-900/20 text-red-500 dark:text-red-400"
          : "hover:bg-black/5 dark:hover:bg-[#333] text-gray-700 dark:text-white"
      }`}
    >
      <span className={`${icon} opacity-[0.7]`} />
      {children}
    </li>
  );
};import {
  useFloating,
  autoUpdate,
  offset,
  flip,
  shift,
  useDismiss,
  useRole,
  useInteractions,
  FloatingPortal,
  FloatingFocusManager,
} from "@floating-ui/react";
import { useTranslation } from "react-i18next";
import { useProjectsContext } from "@/context/ProjectsContext";
import { Select } from "@/components/Select";
import { MenuItem } from "@/components/Projects/Menu/MenuItem";
import { FILTER_OPTIONS } from "@/utils/userSettings";

interface ProjectMenuProps {
  anchorEl: HTMLElement | null;
  resetMenu: () => void;
  isFavorite: boolean | undefined;
  onToggleFavorite: () => void;
  onEdit: () => void;
  closeMenu: () => void;
  onDelete: () => void;
  additionalItems?: React.ReactNode;
}

export function ProjectMenu({
  anchorEl,
  resetMenu,
  closeMenu,
  isFavorite,
  onToggleFavorite,
  onEdit,
  onDelete,

  additionalItems,
}: ProjectMenuProps) {
  const { showAll, setShowAll } = useProjectsContext();

  const { t } = useTranslation();
  const { refs, floatingStyles, context, isPositioned } = useFloating({
    open: Boolean(anchorEl),
    onOpenChange: (open) => !open && resetMenu(),
    elements: { reference: anchorEl },
    whileElementsMounted: autoUpdate,
    placement: "right-start",
    middleware: [offset(4), flip(), shift()],
  });

  const dismiss = useDismiss(context, {
    outsidePressEvent: "click",
    outsidePress: (event) => {
      event.stopPropagation();
      event.preventDefault();
      return true;
    },
  });

  const role = useRole(context);

  const { getFloatingProps } = useInteractions([dismiss, role]);

  if (!anchorEl) return null;

  return (
    <FloatingPortal>
      <FloatingFocusManager context={context} modal={false}>
        <ul
          // eslint-disable-next-line react-hooks/refs
          ref={refs.setFloating}
          style={{
            ...floatingStyles,
            zIndex: 2000,
            opacity: isPositioned ? 1 : 0,
            visibility: isPositioned ? "visible" : "hidden",
          }}
          {...getFloatingProps()}
          className="transition-opacity duration-200 z-[999] pointer-events-auto min-w-[20em] max-w-[20em] bg-white dark:bg-[#232323] border border-black/10 dark:border-[#444] rounded-md p-1 shadow-xl outline-none shadow-black/5 dark:shadow-black/40"
        >
          <MenuItem
            icon="icon-pencil"
            onClick={() => {
              onEdit();
              closeMenu();
            }}
          >
            {t("edit")}
          </MenuItem>

          <MenuItem
            icon="icon-bookmark"
            onClick={() => {
              onToggleFavorite();
              resetMenu();
            }}
          >
            {isFavorite ? t("remove_from_favorites") : t("add_to_favorites")}
          </MenuItem>

          <div className="flex justify-center w-full">
            <Select
              position="right-start"
              border={false}
              symbol="icon-flag"
              value={showAll ? "all" : "active"}
              options={FILTER_OPTIONS}
              onChange={(val) => {
                const isAll = val === "all";
                setShowAll(isAll);
                closeMenu();
              }}
            />
          </div>

          <MenuItem icon="icon-stats-bars" onClick={resetMenu}>
            {t("activity_log")}
          </MenuItem>

          {additionalItems && (
            <div className="border-t border-black/5 dark:border-white/5 my-1 mx-1" />
          )}
          {additionalItems}

          <MenuItem
            icon="icon-bin"
            onClick={() => {
              onDelete();
              closeMenu();
            }}
            variant="danger"
          >
            {t("delete")}
          </MenuItem>
        </ul>
      </FloatingFocusManager>
    </FloatingPortal>
  );
}import { useState } from "react";
import type { Project } from "@/types/project";
import { useTranslation } from "react-i18next";
import { useProjectsContext } from "@/context/ProjectsContext";
import { ModalPortal } from "@/features/ModalPortal";
import { ConfirmModal } from "@/components/ConfirmModal";
import { ProjectForm } from "@/components/Projects/ProjectForm";
import { ProjectMenu } from "@/components/Projects/Menu/ProjectMenu";

type MenuState = {
  anchor: HTMLElement | null;
  projectId: string | null;
};

interface ProjectFormData {
  title?: string;
  description?: string;
  color?: string;
}

export function ProjectMenuController({
  anchor,
  projectId,
  setMenu,
  additionalItems,
  closeMenu,
}: {
  additionalItems?: React.ReactNode;
  anchor: HTMLElement | null;
  projectId: string | null;
  setMenu: React.Dispatch<React.SetStateAction<MenuState>>;
  closeMenu: () => void;
}) {
  const { projects, toggleFavorite, deleteProject, updateProject } =
    useProjectsContext();

  const [editing, setEditing] = useState(false);
  const [confirmDelete, setConfirmDelete] = useState(false);
  const { t } = useTranslation();

  const project = projects.find((p: Project) => p.id === projectId);
  const isFavorite = project?.favorites;

  const onClose = () => {
    setMenu({ anchor: null, projectId: null });
  };
  if (!projectId) return null;

  return (
    <>
      {anchor && projectId && (
        <ModalPortal>
          <ProjectMenu
            anchorEl={anchor}
            // onClose={onClose}
            resetMenu={onClose}
            isFavorite={isFavorite}
            onToggleFavorite={() =>
              project && toggleFavorite(projectId, !project.favorites)
            }
            onEdit={() => setEditing(true)}
            onDelete={() => setConfirmDelete(true)}
            closeMenu={closeMenu}
            additionalItems={additionalItems}
          />
        </ModalPortal>
      )}

      {confirmDelete && project && (
        <ModalPortal>
          <ConfirmModal
            title={t("delete_project_title")}
            variant="primary"
            cancelText={t("cancel")}
            confirmText={t("delete_now")}
            message={t("delete_project_confirm", { title: project.title })}
            onConfirm={() => {
              deleteProject(project.id);
              setConfirmDelete(false);
              onClose();
            }}
            onClose={() => setConfirmDelete(false)}
          />
        </ModalPortal>
      )}

      {project && (
        <ModalPortal>
          <ProjectForm
            mode="edit"
            initialProject={project}
            open={editing}
            onSubmit={(data: ProjectFormData) => {
              updateProject(project.id, data);
              setEditing(false);
              onClose();
            }}
            onClose={() => setEditing(false)}
          />
        </ModalPortal>
      )}
    </>
  );
}import { useState, useRef, useLayoutEffect, useMemo } from "react";
import { useTranslation } from "react-i18next";
import { useProjectsContext } from "@/context/ProjectsContext";
import { ProjectsList } from "@/components/Projects/ProjectsList";

export const FavoriteProjects = () => {
  const { t } = useTranslation();
  const { projects } = useProjectsContext();
  const [showProjects, setShowProjects] = useState(true);
  const wrapperRef = useRef<HTMLDivElement>(null);

  const favProjects = useMemo(
    () => projects.filter((p) => p.favorites),
    [projects],
  );

  useLayoutEffect(() => {
    if (!wrapperRef.current) return;
    if (favProjects.length === 0) {
      wrapperRef.current.style.maxHeight = "0px";
      return;
    }
    wrapperRef.current.style.maxHeight = showProjects
      ? `${wrapperRef.current.scrollHeight}px`
      : "0px";
  }, [showProjects, favProjects]);

  return (
    <div className="py-2">
      <div className="flex items-center justify-between mb-1 px-2">
        <div className=" text-gray-500">{t("favorite_projects")}</div>

        <div className="flex items-center">
          <div
            className="w-7 h-7 flex items-center justify-center rounded-md cursor-pointer transition-colors hover:bg-gray-200 dark:hover:bg-[#82828241] group"
            onClick={() => setShowProjects((p) => !p)}
          >
            <span
              className="icon-reshot-icon-arrow-chevron-right-WDGHUKQ634 text-[1.3em] transition-transform duration-250 ease-in-out text-gray-400 group-hover:text-black/70 dark:group-hover:text-white"
              style={{
                transform: showProjects ? "rotate(90deg)" : "rotate(0deg)",
              }}
            ></span>
          </div>
        </div>
      </div>

      <div
        ref={wrapperRef}
        className="overflow-hidden transition-[max-height] duration-300 ease-in-out"
      >
        <ProjectsList projects={favProjects} />
      </div>
    </div>
  );
};import { useCallback, useRef } from "react";
import type { Task } from "@/types/tasks";
import type { Project } from "@/types/project";
import { useProjectsContext } from "@/context/ProjectsContext";
import { useTasksState } from "@/context/TasksContext";

interface ProjectCardProps {
  project: Project;
  onOpenMenu: (el: HTMLDivElement) => void;
  isMenuOpen: boolean;
}
export function ProjectItem({
  project,
  onOpenMenu,
  isMenuOpen,
}: ProjectCardProps) {
  const { selectedProjectId, changeMode } = useProjectsContext();
  const btnRef = useRef<HTMLDivElement>(null);
  const handleMenuClick = useCallback(
    (e: React.MouseEvent) => {
      e.stopPropagation();
      if (btnRef.current) {
        onOpenMenu(btnRef.current);
      }
    },
    [onOpenMenu],
  );
  const color = project.color;
  const { tasks } = useTasksState();
  const safeTasks = tasks === null ? [] : tasks;
  const projectTasks = safeTasks.filter(
    (t: Task) => t.projectId === project.id && t.isDone === false,
  ).length;

  return (
    <div
      onClick={() => changeMode("project", project.id)}
      className={`
        group relative flex items-start justify-between w-full cursor-pointer
        transition-all duration-200
        p-2 md:p-0 rounded-lg
        bg-[#eee] dark:bg-[#232323]
        shadow-sm border border-gray-100/50 dark:border-none

        md:items-center
      md:mb-0 md:bg-transparent md:shadow-none md:border-none

        ${selectedProjectId === project.id ? "selected !bg-[#9d174d]/15 " : "dark:hover:bg-[#363636] hover:bg-[#dedede]"}
        ${isMenuOpen ? "menu-active bg-[#dedede] dark:bg-[#363636]" : ""} }
      `}
    >
      <div className="flex items-center gap-4 md:gap-2 truncate flex-1 mr-2">
        <div className="shrink-0 w-10 h-10 flex items-center justify-center">
          <span
            className="icon-heart-svgrepo-com text-xl md:text-base"
            style={{ color }}
          />
        </div>

        <div className="flex flex-col min-w-0">
          <span
            className="
              font-semibold md:font-normal
              text-black dark:text-[#dedede]

              break-words
              whitespace-normal

              md:truncate
            "
          >
            {project.title}
          </span>

          <span className="md:hidden text-xs text-gray-400">
            {projectTasks}
          </span>
        </div>
      </div>

      <div className="relative shrink-0 ml-2 flex items-start md:items-center">
        <span
          className={`
            hidden md:block md:absolute md:right-5 text-[0.8em] text-black/50 dark:text-white/40
            group-hover:opacity-0
            ${isMenuOpen ? "opacity-0" : "opacity-100"}
          `}
        >
          {projectTasks}
        </span>

        <span
          ref={btnRef}
          onClick={(e) => {
            e.stopPropagation();
            handleMenuClick(e);
          }}
          className={`
            icon-three-dots-punctuation-sign-svgrepo-com
            rotate-90
            flex items-center justify-center
            p-2 md:p-[0.3em]
            text-[1.4em] md:text-[1.2em]
            md:mr-2
            rounded-full md:rounded-lg
            cursor-pointer
            text-gray-600 dark:text-white
            bg-gray-100 dark:bg-[#2c2c2e] md:bg-transparent
            hover:bg-[#82828241]
            
            md:opacity-0 md:group-hover:opacity-100
            ${isMenuOpen ? "md:!opacity-100 md:bg-[#82828241]" : ""}
          `}
        />
      </div>
    </div>
  );
}import { useState } from "react";
import { useTranslation } from "react-i18next";
import type { Project } from "@/types/project";
import { MobileDrawer } from "@/features/MobileDrawer";
import { OPTIONS } from "@/utils/projectColor";
import { Select, type Option } from "@/components/Select";
import { useIsMobile } from "@/hooks/useIsMobile";

export interface ProjectFormProps {
  mode: "create" | "edit";
  initialProject?: Project;
  open: boolean;
  onSubmit: (data: { title: string; color: string }) => void | Promise<void>;
  onClose: () => void;
}

export const ProjectForm = ({
  mode,
  initialProject,
  onSubmit,
  onClose,
  open,
}: ProjectFormProps) => {
  const isMobile = useIsMobile();
  const [name, setName] = useState(initialProject?.title ?? "");
  const [color, setColor] = useState(
    initialProject?.color ?? OPTIONS[0]?.value ?? "#8c8c8c",
  );
  const [isSubmitting, setIsSubmitting] = useState(false);
  const { t } = useTranslation();
  // const inputRef = useRef<HTMLInputElement>(null);
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!name.trim() || isSubmitting) return;

    try {
      setIsSubmitting(true);
      await onSubmit({ title: name, color });
      onClose();
    } catch (error) {
      console.error("Failed to submit project:", error);
    } finally {
      setIsSubmitting(false);
    }
  };

  const count = name.length;

  return (
    <>
      <MobileDrawer
        open={open && isMobile}
        onClose={onClose}
        drawerDescription="Create or edit project"
        drawerTitle="Project editor"
      >
        <form onSubmit={handleSubmit} className="flex flex-col gap-6 pt-2">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-semibold text-black dark:text-white">
              {mode === "create" ? t("add_project") : t("edit_project")}
            </h2>
          </div>

          <div className="flex flex-col gap-1">
            <input
              className="
        w-full
        rounded-xl
        px-4 py-3
        bg-black/5 dark:bg-white/5
        text-black dark:text-white
        placeholder:text-gray-400
        outline-none
      "
              placeholder={t("project_name_placeholder")}
              value={name}
              maxLength={80}
              autoFocus
              onChange={(e) => setName(e.target.value)}
            />

            <span
              className="text-[11px]"
              style={{
                color:
                  name.length === 80
                    ? "#ff4d4f"
                    : name.length > 65
                      ? "#fa8c16"
                      : "#888",
              }}
            >
              {name.length}/80
            </span>
          </div>

          <div className="flex flex-col gap-2">
            <span className="text-sm text-gray-500 dark:text-gray-400">
              {t("color")}
            </span>

            <select
              value={color}
              onChange={(e) => setColor(e.target.value)}
              className="
        w-full
        rounded-xl
        px-4 py-3
        bg-black/5 dark:bg-white/5
        text-black dark:text-white
        outline-none
      "
            >
              {OPTIONS.map((o: Option) => (
                <option key={o.value} value={o.value || undefined}>
                  {t(o.label.toLowerCase())}
                </option>
              ))}
            </select>
          </div>

          <div className="flex gap-3 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="
        flex-1
        py-3
        rounded-xl
        text-gray-500 dark:text-gray-400
        bg-black/5 dark:bg-white/5
      "
            >
              {t("cancel")}
            </button>

            <button
              type="submit"
              disabled={!name.trim() || isSubmitting}
              className="
        flex-1
        py-3
        rounded-xl
        bg-[#9d174d]
        text-white
        disabled:opacity-50
      "
            >
              {isSubmitting
                ? "…"
                : mode === "create"
                  ? t("add_btn")
                  : t("save_btn")}
            </button>
          </div>
        </form>
      </MobileDrawer>

      {!isMobile && open && (
        <div
          className="fixed inset-0 z-[999] bg-black/60 flex items-center justify-center p-4"
          onClick={onClose}
        >
          <form
            onSubmit={handleSubmit}
            onClick={(e) => e.stopPropagation()}
            className="relative w-full w-fit !max-w-[40em] bg-[#eee] dark:bg-[#242424] p-5 rounded-lg shadow-xl"
          >
            <h2 className="text-2 text-black dark:text-white border-b border-black/10 dark:border-[#d0d0d05a]/60 mb-2 pb-2">
              {mode === "create" ? t("add_project") : t("edit_project")}
            </h2>

            <div
              className="absolute top-5 right-5 tip icon-icons8-close text-xl cursor-pointer text-gray-500 dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-md p-1"
              onClick={onClose}
            />

            <div className="flex flex-col gap-1">
              <div className="flex flex-col gap-1.5">
                <input
                  className="w-full bg-transparent p-2 h-auto border-[0.5px] border-black/20 dark:border-[#d0d0d05a]/60 outline-none rounded-lg text-black dark:text-white block box-border placeholder:text-black-60"
                  id="project-title"
                  placeholder={t("project_name_placeholder")}
                  autoFocus
                  value={name}
                  maxLength={80}
                  onChange={(e) => setName(e.target.value)}
                />
                <span
                  className="text-[11px] self-start"
                  style={{
                    color:
                      count === 80
                        ? "#ff4d4f"
                        : count > 65
                          ? "#fa8c16"
                          : "#888",
                  }}
                >
                  {count}/80
                </span>
              </div>

              <div className="flex flex-col gap-2 items-start text-sm text-gray-500 dark:text-[#888]">
                {t("color")}
                <Select
                  position="bottom-start"
                  symbol="dot"
                  value={color}
                  options={OPTIONS.map((o) => ({
                    value: o.value,
                    label: o.label.toLowerCase(),
                    color: o.value,
                  }))}
                  onChange={(value) => {
                    if (typeof value === "string") {
                      setColor(value);
                    }
                  }}
                />
              </div>

              <div className="flex justify-end gap-3 mt-2">
                <button
                  type="button"
                  onClick={onClose}
                  disabled={isSubmitting}
                  className="cursor-pointer px-5 py-2.5 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors"
                >
                  {t("cancel")}
                </button>
                <button
                  type="submit"
                  disabled={!name.trim() || isSubmitting}
                  className="cursor-pointer px-6 py-2 bg-[#9d174d] hover:shadow-[0_0_10px_#9d174d] disabled:opacity-50 disabled:hover:shadow-none rounded-lg text-white transition-all"
                >
                  {isSubmitting
                    ? "..."
                    : mode === "create"
                      ? t("add_btn")
                      : t("save_btn")}
                </button>
              </div>
            </div>
          </form>
        </div>
      )}
    </>
  );
};import { useState } from "react";
import { useIsMobile } from "@/hooks/useIsMobile";
import { ProjectsSection } from "@/components/Projects/ProjectSection";
import { FavoriteProjects } from "@/components/Projects/FavoriteProjectsSection";
import { UserInfo } from "@/components/User/UserInfo/UserInfo";
import { ModalPortal } from "@/features/ModalPortal";
import { UserBtn } from "@/components/User/UserBtn";

export const ProjectPage = () => {
  const isMobile = useIsMobile();
  const [showUserInfo, setShowUserInfo] = useState(false);
  return (
    <>
      {showUserInfo && (
        <ModalPortal>
          <UserInfo
            isOpen={showUserInfo}
            onClose={() => setShowUserInfo(false)}
          />
        </ModalPortal>
      )}

      <div className="py-5">
        <UserBtn onClick={() => setShowUserInfo(true)} />
        {isMobile && (
          <UserInfo
            onClose={() => setShowUserInfo(false)}
            isOpen={showUserInfo}
          />
        )}
        <div className="p-2 rounded-2xl bg-[#eee] dark:bg-[#232323] mb-5">
          <FavoriteProjects />
        </div>
        <div className="p-2 rounded-2xl bg-[#eee] dark:bg-[#232323]">
          <ProjectsSection />
        </div>
      </div>
    </>
  );
};import { useState, useRef, useEffect } from "react";
import { useTranslation } from "react-i18next";
import { ModalPortal } from "@/features/ModalPortal";
import { ProjectsList } from "@/components/Projects/ProjectsList";
import { ProjectForm } from "@/components/Projects/ProjectForm";
import { useProjectsContext } from "@/context/ProjectsContext";

export function ProjectsSection() {
  const { t } = useTranslation();
  const { projects, createProject, changeMode } = useProjectsContext();
  const [showProjects, setShowProjects] = useState(true);
  const [showForm, setShowForm] = useState(false);
  const wrapperRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (wrapperRef.current) {
      wrapperRef.current.style.maxHeight = showProjects
        ? `${wrapperRef.current.scrollHeight}px`
        : "0px";
    }
  }, [showProjects, projects.length]);

  return (
    <div className="py-2 z-999">
      <div className="flex items-center justify-between mb-1 px-2">
        <div className="text-gray-500">{t("projects_count")}</div>

        <div className="flex items-center gap-1">
          <div
            className="w-7 h-7 flex items-center justify-center rounded-md cursor-pointer transition-colors hover:bg-gray-200 dark:hover:bg-[#82828241] group"
            onClick={() => setShowProjects(!showProjects)}
          >
            <span
              className="icon-reshot-icon-arrow-chevron-right-WDGHUKQ634 text-[1.3em] transition-transform duration-250 ease-in-out text-gray-400 group-hover:text-black/70 dark:group-hover:text-white"
              style={{
                transform: showProjects ? "rotate(90deg)" : "rotate(0deg)",
              }}
            ></span>
          </div>

          <div
            className="w-7 h-7 flex items-center justify-center rounded-md cursor-pointer transition-colors hover:bg-gray-200 dark:hover:bg-[#82828241] group"
            onClick={() => setShowForm(true)}
          >
            <span className="icon-icons8-close text-lg rotate-45 text-gray-400 group-hover:text-black/70 dark:group-hover:text-white"></span>
          </div>
        </div>
      </div>

      <div
        ref={wrapperRef}
        className="overflow-hidden transition-[max-height] duration-300 ease-in-out"
      >
        <ProjectsList projects={projects} />
      </div>

      <ModalPortal>
        <ProjectForm
          mode="create"
          open={showForm}
          onClose={() => setShowForm(false)}
          onSubmit={async ({ title, color }) => {
            const newProject = await createProject(title, color, false);
            if (newProject) {
              changeMode("project", newProject.id);
            }
            setShowForm(false);
          }}
        />
      </ModalPortal>
    </div>
  );
}import { useState } from "react";
import type { Project } from "@/types/project";
import { ProjectItem } from "@/components/Projects/ProjectCard";
import { ProjectMenuController } from "@/components/Projects/Menu/ProjectMenuController";

export function ProjectsList({ projects }: { projects: Project[] }) {
  const [menu, setMenu] = useState<{
    anchor: HTMLElement | null;
    projectId: string | null;
  }>({ anchor: null, projectId: null });

  const openMenu = (el: HTMLElement, projectId: string) => {
    setMenu({ anchor: el, projectId });
  };

  return (
    <>
      <div className="flex flex-col items-start list-none m-0 p-0 w-full">
        {projects.map((p) => (
          <ProjectItem
            key={p.id}
            project={p}
            onOpenMenu={(el) => openMenu(el, p.id)}
            isMenuOpen={menu.projectId === p.id && !!menu.anchor}
          />
        ))}
      </div>

      <ProjectMenuController
        anchor={menu.anchor}
        projectId={menu.projectId}
        setMenu={setMenu}
        closeMenu={() => setMenu({ anchor: null, projectId: menu.projectId })}
      ></ProjectMenuController>
    </>
  );
}import { useState } from "react";
import { ModalPortal } from "@/features/ModalPortal";
import { useProjectsContext } from "@/context/ProjectsContext";
import { FavoriteProjects } from "@/components/Projects/FavoriteProjectsSection";
import { ProjectsSection } from "@/components/Projects/ProjectSection";
import { SidebarNavigation } from "@/components/Sidebar/SidebarNavigation";
import { AddTaskBtn } from "@/components/AddTaskBtn";
import { TaskForm } from "@/components/Tasks/TaskForm";
import { UserInfo } from "@/components/User/UserInfo/UserInfo";
import type { TaskMode } from "@/context/ProjectsContext";
import { useTasksActions } from "@/context/TasksContext";
import { UserBtn } from "@/components/User/UserBtn";

const menuItems: { id: TaskMode; icon: string }[] = [
  { id: "inbox", icon: "icon-inbox" },
  { id: "today", icon: "icon-calendar-_1" },
  { id: "completed", icon: "icon-checkmark" },
  { id: "overdue", icon: "icon-history" },
  { id: "projects", icon: "icon-heart-svgrepo-com" },
];
export function Sidebar({ collapsed }: { collapsed: boolean }) {
  const [showUserInfo, setShowUserInfo] = useState(false);
  const { mode, changeMode } = useProjectsContext();
  const { createTask } = useTasksActions();
  const [openForm, setOpenForm] = useState(false);

  return (
    <aside
      className={`
       max-h-[100dvh]
       overflow-y-auto
        relative shrink-0 transition-all duration-350 ease-in-out
        bg-[#eee] dark:bg-[#232323] hidden md:block
    relative shrink-0 transition-all duration-350 ease-in-out
    bg-[#eee] dark:bg-[#232323]
    w-[22em]
        ${collapsed ? "max-w-0" : "max-w-[22em]"}
      `}
    >
      <div
        className={`
          h-full w-full p-4  transition-all duration-350 ease-in-out
          ${
            collapsed
              ? "opacity-0 -translate-x-[200%]"
              : "opacity-100 translate-x-0"
          }
        `}
      >
        <UserBtn onClick={() => setShowUserInfo(true)} />

        {/* Add Task */}
        <div className="flex flex-col items-start justify-center pl-[5px] mb-2">
          <AddTaskBtn onOpenForm={() => setOpenForm(true)} />
        </div>

        {/* Navigation */}
        <div className="space-y-1">
          <SidebarNavigation
            onChangeMode={(id, n) => changeMode(id, n)}
            mode={mode}
          />
          <FavoriteProjects />
          <ProjectsSection />
        </div>
      </div>

      {/* Modals */}
      {openForm && (
        <ModalPortal>
          <div
            className="fixed inset-0 px-5 pt-[10%] pl-[20%] z-[999] "
            onClick={() => setOpenForm(false)}
          >
            <div onClick={(e) => e.stopPropagation()}>
              <TaskForm
                openForm={openForm}
                formMode="create"
                onClose={() => setOpenForm(false)}
                onSubmit={async (data: Record<string, unknown>) => {
                  await createTask(data);
                  setOpenForm(false);
                }}
              />
            </div>
          </div>
        </ModalPortal>
      )}

      {showUserInfo && (
        <ModalPortal>
          <UserInfo
            isOpen={showUserInfo}
            onClose={() => setShowUserInfo(false)}
          />
        </ModalPortal>
      )}
    </aside>
  );
}

import { AnimatePresence, motion } from "framer-motion";
import { Drawer } from "vaul";
import { ProjectPage } from "../Projects/ProjectPage";
import { VisuallyHidden } from "@radix-ui/react-visually-hidden";

export function MobileMenu() {
  const { mode, changeMode } = useProjectsContext();
  const [showProjects, setShowProjects] = useState(false);
  const [showUserInfo, setShowUserInfo] = useState(false);

  const handleClick = (item: (typeof menuItems)[number]) => {
    if (item.id === "projects") {
      setShowProjects(true);
      return;
    }
    changeMode(item.id);
    setShowProjects(false);
  };

  return (
    <>
      {/* BOTTOM NAV */}
      <nav
        className="
    absolute bottom-0 left-1/2 -translate-x-1/2
    w-[90%] z-50 md:hidden
    rounded-2xl
    bg-white/70 dark:bg-[#1f1f1f]/70
    backdrop-blur-2xl
    border-t border-black/5 dark:border-white/10
    pb-[env(safe-area-inset-bottom)]
  "
      >
        <div className="flex h-14 items-center">
          {menuItems.map((item) => {
            const isActive =
              mode === item.id ||
              (mode === "project" && item.id === "projects");

            return (
              <button
                key={item.id}
                onClick={() => handleClick(item)}
                className="relative flex-1 h-full flex items-center justify-center"
              >
                <AnimatePresence>
                  {isActive && (
                    <motion.span
                      layoutId="ios-glass"
                      initial={{ scale: 0.85, opacity: 0 }}
                      animate={{ scale: 1, opacity: 1 }}
                      exit={{ scale: 0.9, opacity: 0 }}
                      transition={{
                        type: "spring",
                        stiffness: 500,
                        damping: 35,
                      }}
                      className="
                        absolute w-[90%] h-12 rounded-2xl
                        backdrop-blur-xl
                        shadow-[0_8px_20px_rgba(0,0,0,0.12)]
                      "
                    >
                      <span
                        className="
                          absolute inset-0 rounded-2xl
                          dark:bg-[#272727] bg-gray/20
                        "
                      />
                    </motion.span>
                  )}
                </AnimatePresence>

                <motion.span
                  animate={{ scale: isActive ? 1.15 : 1 }}
                  transition={{ type: "spring", stiffness: 400, damping: 30 }}
                  className={`
                    relative text-xl
                    ${item.icon}
                    ${isActive ? "text-[#9d174d]" : "text-black dark:text-white"}
                  `}
                />
              </button>
            );
          })}
        </div>
      </nav>

      <Drawer.Root
        open={showProjects}
        onOpenChange={setShowProjects}
        shouldScaleBackground
      >
        <Drawer.Portal>
          <Drawer.Overlay className="absolute inset-0 z-40 bg-black/30 " />

          <Drawer.Content
            className="
        absolute inset-x-0 bottom-0 z-50
        bg-white dark:bg-[#1f1f1f]
        rounded-t-3xl
        max-h-[90vh]
        flex flex-col
      "
          >
            <VisuallyHidden>
              <Drawer.Title>Projects Navigation</Drawer.Title>
              <Drawer.Description>
                Select a project to view tasks
              </Drawer.Description>
            </VisuallyHidden>

            <Drawer.Handle className="mx-auto my-3 h-1.5 w-14 rounded-full bg-black/20 dark:bg-white/20" />

            <div className="flex-1 overflow-y-auto overscroll-contain px-4 pb-6">
              <ProjectPage />
            </div>
          </Drawer.Content>
        </Drawer.Portal>
      </Drawer.Root>

      {showUserInfo && (
        <ModalPortal>
          <UserInfo
            isOpen={showUserInfo}
            onClose={() => setShowUserInfo(false)}
          />
        </ModalPortal>
      )}
    </>
  );
}import { useTranslation } from "react-i18next";
import type { TaskMode } from "@/context/ProjectsContext";

interface SidebarNavigationProps {
  onChangeMode: (id: TaskMode, n: null) => void;
  mode: string;
}

export const SidebarNavigation = ({
  onChangeMode,
  mode,
}: SidebarNavigationProps) => {
  const { t } = useTranslation();

  const NAV_ITEMS = [
    { id: "inbox", label: t("inbox"), icon: "icon-inbox" },
    { id: "today", label: t("today"), icon: "icon-calendar-_1" },
    { id: "completed", label: t("completed"), icon: "icon-checkmark" },
    { id: "overdue", label: t("overdue"), icon: "icon-history" },
  ] as const;

  return NAV_ITEMS.map((i) => {
    return (
      <div
        key={i.id}
        onClick={() => onChangeMode(i.id as TaskMode, null)}
        className={`${
          mode === i.id
            ? "bg-[#9d174d]/15 text-[#9d174d] dark:text-white"
            : "text-gray-700 dark:text-white/70"
        } flex items-center gap-3 p-2 cursor-pointer hover:bg-black/5 dark:hover:bg-[#363636] w-full rounded-lg m-0`}
      >
        <span className={i.icon}> </span>
        {i.label}
      </div>
    );
  });
};import { memo } from "react";

interface SubtaskToggleProps {
  subCount: number | null;
  showSubTasks?: boolean;
  mode: string;
  onToggle?: () => void;
}

export const SubtaskToggle = memo(function SubtaskToggle({
  subCount,
  showSubTasks,
  onToggle,
}: SubtaskToggleProps) {
  if (subCount === 0 || !onToggle) return null;

  return (
    <div
      className="absolute md:right-[6em] md:opacity-0 md:group-hover:opacity-100 text-gray-800 dark:text-white p-2 rounded-md cursor-pointer 
              hover:bg-black/5 dark:hover:bg-[#82828241] z-[10]
              transition-all right-[-0.2em] top-1/2 -translate-y-1/2 flex items-center justify-center w-8 h-8 group/arrow"
      onClick={(e) => {
        e.stopPropagation();
        onToggle();
      }}
    >
      <span
        className="transition-all duration-200 cursor-pointer p-1.5 rounded-md icon-reshot-icon-arrow-chevron-right-WDGHUKQ634  "
        style={{
          transform: showSubTasks ? "rotate(90deg)" : "rotate(0deg)",
        }}
      />
    </div>
  );
});import { memo } from "react";
import { Calendar } from "@/components/Calendar/Calendar";

interface TaskActionsProps {
  isSelectionMode?: boolean;
  isMobile?: boolean;
  isMenuOpen: boolean;
  isCalOpen: boolean;
  currentDeadlineStr: Date | null;
  reminderAt?: string | null;
  onEdit: () => void;
  onMenuClick: (e: React.MouseEvent<HTMLButtonElement>) => void;
  onDateUpdate: (date: Date | null) => void;
  onTimeUpdate: (time: string | null) => void;
  setIsCalOpen: (val: boolean) => void;
}

export const TaskActions = memo(function TaskActions({
  isSelectionMode,
  isMobile,
  isMenuOpen,
  isCalOpen,
  currentDeadlineStr,
  reminderAt,

  onEdit,
  onMenuClick,
  onDateUpdate,
  onTimeUpdate,
  setIsCalOpen,
}: TaskActionsProps) {
  if (isMobile) return null;

  return (
    <div className="flex items-center">
      <button
        onClick={onEdit}
        className={`
          opacity-0 group-hover:opacity-100 
          text-gray-800 dark:text-white icon-pencil 
          p-2 rounded-md cursor-pointer 
          hover:bg-black/5 dark:hover:bg-[#82828241]
          transition-opacity
          ${isSelectionMode ? "!opacity-0 pointer-events-none" : ""}
        `}
      />

      <div
        className={`${isSelectionMode ? "opacity-0 pointer-events-none" : ""}`}
        onClick={(e) => e.stopPropagation()}
      >
        <Calendar
          date={currentDeadlineStr}
          setDate={onDateUpdate}
          time={reminderAt || null}
          setIsCalOpen={setIsCalOpen}
          setTime={onTimeUpdate}
        >
          <button
            onClick={() => setIsCalOpen(true)}
            className={`
              ${
                isCalOpen
                  ? "opacity-100 bg-black/5 dark:bg-[#82828241]"
                  : "opacity-0 group-hover:opacity-100"
              }
              text-gray-800 dark:text-white icon-calendar-_1 
              p-2 rounded-md cursor-pointer 
              hover:bg-black/5 dark:hover:bg-[#82828241]
              transition-all
            `}
          />
        </Calendar>
      </div>

      <button
        onClick={(e) => {
          onMenuClick(e);
          setIsCalOpen(false);
        }}
        className={`
          ${
            isMenuOpen
              ? "opacity-100 bg-black/5 dark:bg-[#82828241]"
              : "opacity-0 group-hover:opacity-100"
          }
          ${isSelectionMode ? "!opacity-0 pointer-events-none" : ""}
          text-gray-800 dark:text-white 
          icon-three-dots-punctuation-sign-svgrepo-com 
          p-2 rounded-md cursor-pointer 
          hover:bg-black/5 dark:hover:bg-[#82828241]
          transition-all
        `}
      />
    </div>
  );
});import React, { memo, useCallback, useState, useMemo } from "react";

import type { Task } from "@/types/tasks";
import { ModalPortal } from "@/features/ModalPortal";
import { formatDateLabel, dateColor } from "@/utils/dateFormatters";
import { PRIORITY_OPTIONS } from "@/utils/priorities";
import { useTasksActions } from "@/context/TasksContext";
import { GlobalDropdown } from "@/components/Tasks/TaskMenu";
import { useProjectsContext } from "@/context/ProjectsContext";
import { TaskInfo } from "@/components/Tasks/TaskInfo";
import { TaskCheckbox } from "@/components/Tasks/TaskCheckbox";
import { TaskMetadata } from "@/components/Tasks/Taskmetadata";
import { TaskActions } from "@/components/Tasks/Taskactions";
import { SubtaskToggle } from "@/components/Tasks/Subtasktoggle";

interface TaskCardProps {
  task: Task;
  onEdit: () => void;
  isEditing: boolean;
  onDeleteRequest: () => void;
  onAddSubtask?: () => void;
  selectionMode?: boolean;
  selected?: boolean;
  onSelect?: () => void;
  isMobile?: boolean;
  setShowSubTasks?: () => void;
  showSubTasks?: boolean;
}

export const TaskCard = memo(
  ({
    task,
    onEdit,
    isEditing,
    isMobile,
    onDeleteRequest,
    onAddSubtask,
    selected,
    selectionMode,
    onSelect,
    setShowSubTasks,
    showSubTasks,
  }: TaskCardProps) => {
    const { updateDone, updateTask } = useTasksActions();
    const { mode, projects, changeMode } = useProjectsContext();

    const [openTaskInfo, setOpenTaskInfo] = useState(false);
    const [isMenuOpen, setIsMenuOpen] = useState(false);
    const [isCalOpen, setIsCalOpen] = useState(false);

    const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | null>(null);

    const handleToggle = useCallback(
      (e: React.MouseEvent) => {
        e.stopPropagation();

        if (task.subtasks && task.subtasks.length > 0 && !task.isDone) {
          task.subtasks.forEach((s) => {
            updateDone(s.id, true);
          });
        }

        updateDone(task.id, !task.isDone);
      },
      [task.id, task.isDone, task.subtasks, updateDone],
    );

    const handleDate = useCallback(
      (newDate: Date | null) => {
        updateTask(task.id, { deadline: newDate });
      },
      [task.id, updateTask],
    );

    const currentDeadlineStr = task.deadline ? new Date(task.deadline) : null;

    const handleCardClick = (e: React.MouseEvent) => {
      if (selectionMode) {
        handleSelectClick?.(e);
        return;
      }

      if (isMobile) {
        onEdit();
        return;
      }

      setOpenTaskInfo(true);
    };

    const handleTime = useCallback(
      (newTime: string | null) => {
        updateTask(task.id, { reminderAt: newTime });
      },
      [task.id, updateTask],
    );

    const handleMenuClick = useCallback(
      (e: React.MouseEvent<HTMLButtonElement>) => {
        e.stopPropagation();
        setAnchorEl(e.currentTarget);
        setIsMenuOpen(true);
      },
      [],
    );

    const handleSelectClick = useCallback(
      (e: React.MouseEvent) => {
        if (!selectionMode) return;
        e.stopPropagation();
        onSelect?.();
      },
      [selectionMode, onSelect],
    );

    const handleProjectChange = useCallback(
      (prodId: string | null) => {
        changeMode(prodId === null ? "inbox" : "project", prodId);
      },
      [changeMode],
    );

    const priorityStyle = useMemo(() => {
      const option = PRIORITY_OPTIONS.find(
        (opt) => opt.value === task.priority,
      );
      return {
        bg: option?.bg,
        color: option?.color,
      };
    }, [task.priority]);

    const subtasksStats = useMemo(() => {
      const subCount = task.subtasks?.length || 0;
      const subDone = task.subtasks?.filter((t) => t.isDone).length || 0;
      return { subCount, subDone };
    }, [task.subtasks]);

    if (isEditing) return null;

    return (
      <>
        <div
          onClick={handleCardClick}
          className={`
                ${selected ? "!text-[#9d174d]" : "text-black dark:text-white"}
                group flex items-center 
                w-full transition-colors relative cursor-pointer
                ${
                  task.isDone
                    ? "opacity-80 text-gray-400 dark:text-gray-500"
                    : "text-black dark:text-white"
                }
              `}
        >
          <SubtaskToggle
            subCount={subtasksStats.subCount}
            showSubTasks={showSubTasks}
            mode={mode}
            onToggle={setShowSubTasks}
          />

          <div className="flex items-center gap-2 text-[16px] md:text-[15px] flex-1 py-0.3">
            <TaskCheckbox
              isDone={task.isDone}
              isSelectionMode={!!selectionMode}
              isSelected={!!selected}
              priorityColor={priorityStyle.color}
              priorityBg={priorityStyle.bg}
              onToggle={handleToggle}
              onSelect={onSelect}
            />

            <div className="flex items-center justify-between flex-1 border-b border-black/10 dark:border-[#88888846] py-3 md:py-2 pl-1">
              <div className="flex flex-col flex-wrap min-w-0 flex-1">
                <div
                  className={`${
                    task.isDone ? "line-through text-gray-400" : ""
                  } font-normal leading-tight `}
                >
                  {task.title}
                </div>

                {task.comment && (
                  <div className="text-[13px] md:text-[15px] opacity-90 leading-normal text-gray-600 dark:text-gray-300 ">
                    {task.comment}
                  </div>
                )}

                <TaskMetadata
                  deadline={task.deadline}
                  reminderAt={task.reminderAt}
                  completedAt={task.completedAt}
                  subCount={subtasksStats.subCount}
                  subDone={subtasksStats.subDone}
                  projectId={task.projectId}
                  projects={projects}
                  mode={mode}
                  isDone={task.isDone}
                  isSelectionMode={selectionMode}
                  dateColor={dateColor}
                  formatDateLabel={formatDateLabel}
                  onDateUpdate={handleDate}
                  onTimeUpdate={handleTime}
                  onProjectClick={handleProjectChange}
                />
              </div>

              <TaskActions
                isSelectionMode={selectionMode}
                isMobile={isMobile}
                isMenuOpen={!!isMenuOpen}
                isCalOpen={isCalOpen}
                currentDeadlineStr={currentDeadlineStr}
                reminderAt={task.reminderAt}
                onEdit={onEdit}
                onMenuClick={handleMenuClick}
                onDateUpdate={handleDate}
                onTimeUpdate={handleTime}
                setIsCalOpen={setIsCalOpen}
              />
            </div>
          </div>
        </div>

        {openTaskInfo && (
          <ModalPortal>
            <TaskInfo
              isOpen={openTaskInfo}
              task={task}
              projects={projects}
              onClose={() => setOpenTaskInfo(false)}
            />
          </ModalPortal>
        )}

        {isMenuOpen && anchorEl && (
          <GlobalDropdown
            isCalOpen={isCalOpen}
            setIsCalOpen={setIsCalOpen}
            updateDate={handleDate}
            updateTime={handleTime}
            task={task}
            isOpen={isMenuOpen}
            anchorEl={anchorEl}
            onClose={() => setIsMenuOpen(false)}
            onEdit={() => {
              onEdit();
              setIsMenuOpen(false);
            }}
            onDelete={() => {
              onDeleteRequest();
              setIsMenuOpen(false);
            }}
            onAddSubtask={onAddSubtask}
          />
        )}
      </>
    );
  },
);

TaskCard.displayName = "TaskCard";import { memo } from "react";

interface TaskCheckboxProps {
  isDone: boolean;
  isSelectionMode: boolean;
  isSelected: boolean;
  priorityColor?: string;
  priorityBg?: string;
  onToggle: (e: React.MouseEvent) => void;
  onSelect?: (e: React.MouseEvent) => void;
}

export const TaskCheckbox = memo(function TaskCheckboxAnimated({
  isDone,
  isSelectionMode,
  isSelected,
  priorityColor,
  priorityBg,
  onToggle,
  onSelect,
}: TaskCheckboxProps) {
  if (isSelectionMode) {
    return (
      <div
        onClick={onSelect}
        className={`
          min-w-5 h-5 rounded-lg border flex items-center justify-center cursor-pointer 
          transition-all duration-200
          ${
            isSelected
              ? "bg-[#9d174d] border-[#610c2e] text-white scale-95"
              : "border-black/30 dark:border-white/30 hover:border-[#9d174d] dark:hover:border-[#9d174d] hover:scale-105"
          }
        `}
      >
        {isSelected && (
          <svg
            viewBox="0 0 24 24"
            className="w-5 h-5"
            style={{
              animation: "checkmark 0.3s ease-in-out",
            }}
          >
            <path
              fill="none"
              stroke="currentColor"
              strokeWidth="3"
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M5 13l4 4L19 7"
              style={{
                strokeDasharray: 20,
                strokeDashoffset: 20,
                animation: "checkmark-stroke 0.3s ease-in-out forwards",
              }}
            />
          </svg>
        )}
      </div>
    );
  }

  return (
    <span
      onClick={onToggle}
      className={`
        relative min-w-[1.2em] min-h-[1.2em] border rounded-full cursor-pointer 
        flex items-center justify-center 
        transition-all duration-200
        active:scale-90
        hover:scale-110
        ${isDone ? "shadow-md" : ""}
      `}
      style={{
        borderColor: isDone ? priorityColor : priorityColor,
        borderWidth: isDone ? "2px" : "1.2px",
        backgroundColor: isDone ? priorityColor : priorityBg,
        transform: isDone ? "rotate(0deg)" : "rotate(0deg)",
      }}
    >
      {isDone && (
        <svg
          viewBox="0 0 24 24"
          className="w-[0.9em] h-[0.9em] text-white"
          style={{
            filter: "drop-shadow(0 1px 2px rgba(0,0,0,0.3))",
          }}
        >
          <path
            fill="none"
            stroke="currentColor"
            strokeWidth="3"
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M5 13l4 4L19 7"
            style={{
              strokeDasharray: 20,
              strokeDashoffset: isDone ? 0 : 20,
              transition: "stroke-dashoffset 0.3s ease-in-out",
            }}
          />
        </svg>
      )}
    </span>
  );
});

export const checkboxAnimationStyles = `
@keyframes checkmark-stroke {
  to {
    stroke-dashoffset: 0;
  }
}

@keyframes checkmark {
  0% {
    transform: scale(0) rotate(0deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.2) rotate(180deg);
  }
  100% {
    transform: scale(1) rotate(360deg);
    opacity: 1;
  }
}
`;import { useState, useEffect, useRef } from "react";
import TextareaAutosize from "react-textarea-autosize";
import { Trans, useTranslation } from "react-i18next";
import type { Task } from "@/types/tasks";
import { PRIORITY_OPTIONS } from "@/utils/priorities";
import { MobileDrawer } from "@/features/MobileDrawer";
import { useIsMobile } from "@/hooks/useIsMobile";
import { useProjectsContext } from "@/context/ProjectsContext";
import { Select } from "@/components/Select";
import { Calendar } from "@/components/Calendar/Calendar";
import { useTasksActions } from "@/context/TasksContext";
import { ConfirmModal } from "@/components/ConfirmModal";
import { TaskCard } from "@/components/Tasks/TaskCard";

export interface TaskFormProps {
  formMode: "create" | "edit";
  initiaTask?: Task;
  parentId?: string | null;
  openForm: boolean;
  onSubmit: (data: {
    title: string;
    projectId: string | null;
    deadline?: Date | null;
    reminderAt?: string | null;
    comment?: string | null;
    priority?: number;
    parentId?: string | null;
  }) => void | Promise<void>;
  onClose: () => void;
  onStartAddSubtask?: (parentId: string | null) => void;
}

export const TaskForm = ({
  formMode,
  initiaTask,
  openForm,
  parentId = null,
  onSubmit,
  onStartAddSubtask,
  onClose,
}: TaskFormProps) => {
  const { t } = useTranslation();
  const isMobile = useIsMobile();
  const { mode } = useProjectsContext();

  const { selectedProjectId, projects } = useProjectsContext();
  const [name, setName] = useState(initiaTask?.title ?? "");
  const [date, setDate] = useState(initiaTask?.deadline ?? null);
  const [time, setTime] = useState(initiaTask?.reminderAt ?? null);
  const [comment, setComment] = useState(initiaTask?.comment ?? "");
  const { deleteTask } = useTasksActions();
  const [openComfirm, setOpenConfirm] = useState(false);
  const [priority, setPriority] = useState(initiaTask?.priority ?? 1);
  const [projectId, setProjectId] = useState(selectedProjectId);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const containerRef = useRef<HTMLFormElement>(null);
  const initialSelectedId = useRef(selectedProjectId);

  useEffect(() => {
    if (selectedProjectId !== initialSelectedId.current) {
      onClose();
    }
  }, [selectedProjectId, onClose]);

  useEffect(() => {
    if (mode === "today" && formMode === "create") {
      setDate(new Date());
    }
  }, [mode, formMode]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!name.trim() || isSubmitting) return;

    try {
      setIsSubmitting(true);
      const finalDeadline = date;

      await onSubmit({
        title: name,
        projectId,
        priority,
        deadline: finalDeadline,
        reminderAt: time,
        comment: comment,
        parentId: initiaTask?.parentId || parentId,
      });

      if (formMode !== "edit") {
        setName("");
        setComment("");
        setPriority(1);
        setTime(null);

        if (mode === "today") {
          setDate(new Date());
        } else {
          setDate(null);
        }
      }
    } catch (error) {
      console.error("Failed to submit task:", error);
    } finally {
      setIsSubmitting(false);
    }
  };

  const isSubTask = Boolean(initiaTask?.parentId || parentId);

  return (
    <>
      {isMobile && (
        <MobileDrawer
          open={openForm}
          onClose={onClose}
          drawerDescription="Create or edit task"
          drawerTitle="Task editor"
        >
          <>
            <form
              ref={containerRef}
              onSubmit={handleSubmit}
              className="flex flex-col px-3 pt-2 pb-safe"
            >
              <div className="flex items-center justify-between mb-2">
                <p className="font-medium text-black dark:text-white flex items-center gap-4">
                  {formMode === "edit" ? t("edit_task") : t("add_task")}
                  {initiaTask?.isDone ? (
                    <span className="icon-checkmark p-2 border-[1px] rounded-full text-green-900"></span>
                  ) : (
                    ""
                  )}
                </p>
              </div>

              <div className="flex-1 ">
                <input
                  // ref={titleRef}
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  placeholder={t("task_title_placeholder")}
                  autoFocus
                  className="
        w-full text-sm py-1.5 mb-1
        bg-transparent outline-none
        text-black dark:text-white
      "
                />

                <TextareaAutosize
                  minRows={2}
                  maxRows={5}
                  value={comment}
                  onChange={(e) => setComment(e.target.value)}
                  placeholder={t("comment_placeholder")}
                  className=" w-full text-xs py-1.5 mb-2 resize-none bg-transparent outline-none text-black dark:text-white"
                />
                <div className=" flex gap-2 items-center flex-wrap pb-1">
                  <div
                    className="w-fit shrink-0"
                    onMouseDown={(e) => e.preventDefault()}
                  >
                    <Select
                      mobile={isMobile}
                      position="bottom-start"
                      key="priority-select"
                      symbol={"icon-flag"}
                      value={priority}
                      options={PRIORITY_OPTIONS.map((opt) => ({
                        ...opt,
                        label: t(opt.label.toLowerCase()),
                      }))}
                      onChange={(value) => {
                        if (typeof value === "number") {
                          setPriority(value);
                        }
                      }}
                    />
                  </div>

                  <div
                    className="w-fit shrink-0"
                    onMouseDown={(e) => e.preventDefault()}
                  >
                    <Calendar
                      time={time}
                      setTime={setTime}
                      date={date}
                      setDate={setDate}
                    />
                  </div>

                  {!isSubTask && (
                    <div
                      className="w-fit shrink-0"
                      onMouseDown={(e) => e.preventDefault()}
                    >
                      <Select
                        mobile={isMobile}
                        position="bottom-start"
                        key="project-select"
                        symbol={"icon-heart-svgrepo-com"}
                        value={projectId}
                        placeholder={t("inbox")}
                        options={[
                          {
                            value: null,
                            label: t("inbox"),
                            icon: "icon-inbox",
                          },
                          ...projects.map((p) => ({
                            value: p.id,
                            label: p.title,
                            color: p.color,
                          })),
                        ]}
                        onChange={(value) => {
                          if (typeof value === "string") {
                            setProjectId(value);
                          }
                        }}
                      />
                    </div>
                  )}
                </div>
              </div>

              <div className="flex gap-3 py-4">
                <button
                  type="button"
                  onClick={onClose}
                  className="
        flex-1
        py-3
        rounded-xl
        text-gray-500 dark:text-gray-400
        bg-black/5 dark:bg-white/5"
                >
                  {t("cancel")}
                </button>

                <button
                  type="submit"
                  disabled={!name.trim() || isSubmitting}
                  onMouseDown={(e) => e.preventDefault()}
                  className="
        flex-1
        py-3
        rounded-xl
        bg-[#9d174d]
        text-white
        disabled:opacity-50"
                >
                  {isSubmitting
                    ? "…"
                    : formMode === "create"
                      ? t("add_btn")
                      : t("save_btn")}
                </button>
              </div>
            </form>
            {formMode === "edit" && (
              <>
                <button
                  onClick={() => {
                    setOpenConfirm(true);
                  }}
                  className="w-full text-left p-2 hover:bg-red-50 dark:hover:bg-[#333] cursor-pointer text-red-500 dark:text-red-400 rounded"
                >
                  <span className="icon-bin"> </span>
                  {t("delete")}
                </button>

                {formMode === "edit" &&
                  !isSubTask &&
                  initiaTask?.subtasks &&
                  initiaTask.subtasks.length > 0 && (
                    <div className="p-4 mt-1 bg-[#1a1a1a] dark:bg-[#1a1a1a] rounded-xl overflow-hidden border border-white/5">
                      <ul className="flex flex-col">
                        {initiaTask.subtasks.map((sub, index) => (
                          <li
                            key={sub.id}
                            className={`
            relative flex items-center
            ${index !== 0 ? "" : ""}
          `}
                          >
                            <TaskCard
                              task={sub}
                              isMobile={isMobile}
                              isEditing={false}
                              onEdit={() => {}}
                              onDeleteRequest={() => {}}
                            />
                          </li>
                        ))}
                      </ul>

                      {!isSubTask && (
                        <button
                          onClick={() =>
                            onStartAddSubtask?.(initiaTask?.id || null)
                          }
                          className="w-full flex items-center gap-3 p-4 text-white/70 hover:bg-white/5 transition-colors border-t border-white/5"
                        >
                          <span className="icon-plus-svgrepo-com-1 text-lg"></span>
                          <span className="text-[15px] font-medium">
                            {t("add_subtask")}
                          </span>
                        </button>
                      )}
                    </div>
                  )}

                {formMode === "edit" &&
                  !isSubTask &&
                  (!initiaTask?.subtasks ||
                    initiaTask.subtasks.length === 0) && (
                    <button
                      onClick={() =>
                        onStartAddSubtask?.(initiaTask?.id || null)
                      }
                      className="mx-3 mt-4 flex items-center gap-3 p-3 text-black dark:text-white/70 hover:bg-black/5 dark:hover:bg-white/5 rounded-xl transition-colors"
                    >
                      <span className="icon-plus-svgrepo-com-1 text-lg"></span>
                      <span className="text-[15px] font-medium">
                        {t("add_subtask")}
                      </span>
                    </button>
                  )}
              </>
            )}
          </>
        </MobileDrawer>
      )}

      {openForm && !isMobile && (
        <form
          ref={containerRef}
          className="bg-white dark:bg-[#1f1f1f] mt-1 relative p-5 border-[0.5px] border-black/10 dark:border-[#d0d0d05a]/60 rounded-lg shadow-xl max-w-[864px] max-h-[90vh] overflow-y-auto"
          id="task-form"
          onSubmit={handleSubmit}
        >
          <p className="text-2 text-black dark:text-white border-b border-black/10 dark:border-[#d0d0d05a]/60 mb-2 pb-2">
            {formMode === "edit" ? t("edit_task") : t("add_task")}
          </p>

          <div
            className="absolute top-4 right-4 icon-icons8-close flex items-center justify-center leading-none bg-transparent p-[0.3em] rounded-[8px] cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white transition-colors"
            onClick={onClose}
          ></div>

          <div>
            <label>
              <input
                // ref={titleRef}
                className="w-full bg-transparent outline-none text-black dark:text-white"
                id="task-title"
                placeholder={t("task_title_placeholder")}
                autoFocus
                value={name}
                maxLength={170}
                onChange={(e) => setName(e.target.value)}
              />
            </label>

            <label>
              <TextareaAutosize
                name="comment"
                placeholder={t("comment_placeholder")}
                minRows={1}
                maxRows={10}
                value={comment}
                onChange={(e) => {
                  setComment(e.target.value);
                }}
                className="resize-none w-full bg-transparent outline-none text-black dark:text-[#fff] text-[0.9em]"
              />
            </label>

            <div className="flex gap-2 text-[#888] text-[0.8rem] max-w-[100%] sm:max-w-[50%]">
              <div className="flex flex-col items-center gap-2">
                <Select
                  position="bottom-start"
                  key="priority-select"
                  symbol={"icon-flag"}
                  value={priority}
                  options={PRIORITY_OPTIONS.map((opt) => ({
                    ...opt,
                    label: opt.label.toLowerCase(),
                  }))}
                  onChange={(value) => {
                    if (typeof value === "number") {
                      setPriority(value);
                    }
                  }}
                />
              </div>

              <div className="flex flex-col items-center gap-2">
                <Calendar
                  time={time}
                  setTime={setTime}
                  date={date}
                  setDate={setDate}
                />
              </div>

              {!isSubTask && (
                <div className="flex flex-col gap-2">
                  <Select
                    position="bottom-start"
                    key="project-select"
                    symbol={"icon-heart-svgrepo-com"}
                    value={projectId}
                    placeholder={t("inbox")}
                    options={[
                      { value: null, label: t("inbox"), icon: "icon-inbox" },
                      ...projects.map((p) => ({
                        value: p.id,
                        label: p.title,
                        color: p.color,
                      })),
                    ]}
                    onChange={(value) => {
                      if (typeof value === "string") {
                        setProjectId(value);
                      }
                    }}
                  />
                </div>
              )}
            </div>

            <div className="flex gap-3 justify-end mt-4">
              <button
                className="cursor-pointer px-5 py-2.5 text-sm font-medium text-gray-500 hover:text-black dark:hover:text-white transition-colors"
                type="button"
                onClick={onClose}
                disabled={isSubmitting}
              >
                {t("cancel")}
              </button>
              <button
                className="focus:outline-none focus:border-[#888] focus:ring-1 focus:ring-white/20 cursor-pointer px-5 py-2 bg-[#9d174d] hover:shadow-[0_0_10px_#9d174d] disabled:opacity-50 disabled:hover:shadow-none rounded-lg text-white font-medium"
                type="submit"
                disabled={!name.trim() || isSubmitting}
              >
                {isSubmitting
                  ? "..."
                  : formMode === "create"
                    ? t("add_btn")
                    : t("save_btn")}
              </button>
            </div>
          </div>
        </form>
      )}

      {openComfirm && (
        <ConfirmModal
          title={t("delete_task_title")}
          variant="primary"
          message={
            <Trans
              i18nKey="delete_task_message"
              values={{ title: initiaTask?.title }}
              components={{
                b: <b className="font-bold text-black dark:text-white" />,
              }}
            />
          }
          onConfirm={async () => {
            if (initiaTask?.id) {
              await deleteTask(initiaTask.id);
            }
            setOpenConfirm(false);
          }}
          onClose={() => setOpenConfirm(false)}
          confirmText={t("delete_now")}
          cancelText={t("cancel")}
        />
      )}
    </>
  );
};import type { Project } from "@/types/project";
import type { Task } from "@/types/tasks";
import { format } from "date-fns";
import { useTranslation } from "react-i18next";
import { enUS, uk, ru, es, fr, pl, de } from "date-fns/locale";

import { useTasksState } from "../../context/TasksContext";
import type { Locale } from "react-day-picker";
const localeMap: Record<string, Locale> = {
  en: enUS,
  uk: uk,
  ru: ru,
  es: es,
  fr: fr,
  pl: pl,
  de: de,
};

export const TaskInfo = ({
  task,
  projects,
  onClose,
  isOpen,
}: {
  task: Task;
  projects: Project[] | null;
  onClose: () => void;
  isOpen: boolean;
}) => {
  const { tasks } = useTasksState();
  const project = projects?.find((p) => p.id === task.projectId);
  const { t, i18n } = useTranslation();
  const safeTasks = tasks === null ? [] : tasks;
  const parentTask = task.parentId
    ? safeTasks.find((t: Task) => t.id === task.parentId)
    : null;
  const formattedDeadline = task.deadline
    ? format(new Date(task.deadline), "d MMMM yyyy", {
        locale: localeMap[i18n.language] ?? enUS,
      })
    : null;
  const subtasks = task.subtasks;
  const safeSubTasks = subtasks === null ? [] : subtasks;
  const subtasksCount = safeSubTasks?.length;
  const subtasksDone = safeSubTasks?.filter((s: Task) => s.isDone).length;

  return (
    <div
      className={`fixed inset-0 z-[1000] flex items-center justify-center transition-all duration-300 ease-in-out ${
        isOpen
          ? "opacity-100 visible backdrop-blur-sm bg-black/20"
          : "opacity-0 invisible backdrop-blur-0 bg-black/0"
      }`}
      onClick={onClose}
    >
      <div
        className={`relative z-[100] bg-white dark:bg-[#242424] w-full max-w-[450px] rounded-lg border border-black/10 dark:border-white/5 
        transform transition-all duration-300 ease-out p-2 shadow-2xl
        ${isOpen ? "scale-100 opacity-100" : "scale-95 opacity-0"}`}
        onClick={(e) => e.stopPropagation()}
      >
        <span
          onClick={onClose}
          className="icon-icons8-close absolute top-2 right-2 flex items-center justify-center leading-none bg-transparent p-[0.3em] rounded-[8px] cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white transition-all opacity-50 hover:opacity-100"
        />

        <div className="px-6 pb-6 pt-8">
          {parentTask && (
            <div className="mb-2 flex items-center gap-2 text-gray-500 dark:text-[#777] text-[11px] uppercase tracking-wider font-bold">
              <span className="icon-flow-branch rotate-180" />
              <span>{t("parent_task")}:</span>
              <span className="text-[#4270d1] truncate max-w-[200px]">
                {parentTask.title}
              </span>
            </div>
          )}

          <div className="flex items-start mb-6">
            <div
              className={`w-14 h-14 rounded-lg flex items-center justify-center text-2xl border border-black/5 dark:border-white/5 shadow-xl transition-colors
                ${
                  task.isDone
                    ? "bg-green-500/10 text-green-500"
                    : "bg-gray-100 dark:bg-[#333] text-gray-400 dark:text-gray-400"
                }`}
            >
              <span
                className={task.isDone ? "icon-checkmark" : "icon-pushpin"}
              />
            </div>
            <div className="ml-4 flex-1">
              <h3
                className={`text-xl font-bold leading-tight ${
                  task.isDone
                    ? "text-gray-400 line-through"
                    : "text-black dark:text-white"
                }`}
              >
                {task.title}
              </h3>
              <p className="text-gray-500 text-xs uppercase tracking-widest font-bold mt-1">
                {task.isDone ? t("completed") : t("active_task")}
              </p>
            </div>
          </div>

          <div className="space-y-4">
            {task.comment && (
              <div className="bg-gray-50 dark:bg-[#2a2a2a]/50 p-4 rounded-lg border border-black/5 dark:border-white/5">
                <span className="text-[10px] text-gray-500 uppercase tracking-wider font-bold block mb-1">
                  {t("description")}
                </span>
                <p className="text-sm text-gray-700 dark:text-gray-300 leading-relaxed">
                  {task.comment}
                </p>
              </div>
            )}

            <div className="grid grid-cols-2 gap-3">
              <div className="bg-gray-50 dark:bg-[#2a2a2a] p-4 rounded-lg border border-black/5 dark:border-white/5 flex flex-col items-start">
                <span
                  className="icon-heart-svgrepo-com text-lg mb-2"
                  style={{ color: project?.color || "#777" }}
                />
                <span className="text-lg font-bold text-black dark:text-white truncate w-full">
                  {project?.title || t("inbox")}
                </span>
                <span className="text-[10px] text-gray-500 uppercase tracking-wider font-semibold">
                  {t("project")}
                </span>
              </div>

              <div className="bg-gray-50 dark:bg-[#2a2a2a] p-4 rounded-lg border border-black/5 dark:border-white/5 flex flex-col items-start">
                <span className="icon-pie-chart text-[#9d174d] text-lg mb-2" />
                <span className="text-lg font-bold text-black dark:text-white">
                  {subtasksDone} / {subtasksCount}
                </span>
                <span className="text-[10px] text-gray-500 uppercase tracking-wider font-semibold">
                  {t("subtasks")}
                </span>
              </div>
            </div>

            {subtasksCount ||
              (0 > 0 && (
                <div className="bg-gray-50/50 dark:bg-[#2a2a2a]/30 rounded-lg border border-black/5 dark:border-white/5 p-3 space-y-2">
                  <span className="text-[10px] text-gray-500 uppercase tracking-wider font-bold block px-1">
                    {t("subtasks_list")}
                  </span>
                  <div className="max-h-[120px] overflow-y-auto space-y-1 pr-1 custom-scrollbar">
                    {safeSubTasks?.map((sub: Task) => (
                      <div
                        key={sub.id}
                        className="flex items-center gap-3 p-2 bg-white dark:bg-white/5 rounded-md border border-black/5 dark:border-white/5"
                      >
                        <span
                          className={`w-2 h-2 rounded-full ${
                            sub.isDone
                              ? "bg-green-500"
                              : "bg-gray-300 dark:bg-[#555]"
                          }`}
                        />
                        <span
                          className={`text-sm flex-1 truncate ${
                            sub.isDone
                              ? "text-gray-400 line-through"
                              : "text-gray-700 dark:text-gray-300"
                          }`}
                        >
                          {sub.title}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}

            {task.deadline && (
              <div className="bg-gray-50 dark:bg-[#2a2a2a]/50 p-4 rounded-lg border border-black/5 dark:border-white/5 flex items-center space-x-4">
                <div className="bg-blue-500/10 p-2 rounded-lg">
                  <span className="icon-calendar text-[#4270d1]" />
                </div>
                <div className="flex flex-col">
                  <span className="text-[11px] text-gray-500 uppercase font-bold tracking-tight">
                    {t("due_date")}
                  </span>
                  <span className="text-sm text-gray-800 dark:text-gray-300 font-medium">
                    {formattedDeadline}
                  </span>
                  {task.reminderAt && (
                    <span className="text-[10px] text-gray-400 dark:text-gray-600">
                      {t("reminder_at", { time: task.reminderAt })}
                    </span>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};import { useState, useCallback, useMemo, Fragment } from "react";
import { Trans, useTranslation } from "react-i18next";
import type { Task } from "@/types/tasks";
import { useTasksActions, useTasksState } from "@/context/TasksContext";
import { useProjectsContext } from "@/context/ProjectsContext";
import { useFilteredTasks } from "@/hooks/useFilteredTasks";
import { useTaskSelection } from "@/hooks/useTaskSelection";
import { useIsMobile } from "@/hooks/useIsMobile";
import { TaskForm } from "@/components/Tasks/TaskForm";
import { TaskCard } from "@/components/Tasks/TaskCard";
import { ConfirmModal } from "@/components/ConfirmModal";
import { AddTaskBtn } from "@/components/AddTaskBtn";
import { EmptyState } from "@/components/EmptyPage";
import { Selector } from "@/components/Selector";
import { TaskListMenu } from "@/components/Tasks/TaskListMenu";
import { TaskLoader } from "@/components/Tasks/TaskLoader";

export const TaskList = () => {
  const isMobile = useIsMobile();
  const { t } = useTranslation();
  const { tasks, ready } = useFilteredTasks();
  const saveTasks = tasks === null ? [] : tasks;
  const { loading } = useTasksState();
  const { mode, selectedProjectId } = useProjectsContext();
  const { deleteTask, updateTask, createTask } = useTasksActions();

  const [editingTaskId, setEditingTaskId] = useState<string | null>(null);
  const [taskToDelete, setTaskToDelete] = useState<Task | null>(null);
  const [activeParentId, setActiveParentId] = useState<string | null>(null);
  const [openForm, setOpenForm] = useState(false);
  const [expandedTasks, setExpandedTasks] = useState<Record<string, boolean>>(
    {},
  );

  const showContent = ready && !loading;

  const toggleTask = useCallback((taskId: string) => {
    setExpandedTasks((prev) => {
      const current = prev[taskId] ?? true;
      return { ...prev, [taskId]: !current };
    });
  }, []);

  const handleStartEditing = useCallback((id: string) => {
    setEditingTaskId(id);
    setActiveParentId(null);
    setOpenForm(false);
  }, []);

  const handleStartAddSubtask = useCallback((parentId: string | null) => {
    setActiveParentId(parentId);
    setEditingTaskId(null);
    setOpenForm(false);
  }, []);

  const handleDeleteRequest = useCallback((task: Task) => {
    setTaskToDelete(task);
  }, []);
  const selection = useTaskSelection(saveTasks, () => {
    setOpenForm(false);
    setActiveParentId(null);
    setEditingTaskId(null);
  });
  const handleStartSelection = () => {
    selection.startSelection();
  };
  const shouldShowAddButton = useMemo(
    () =>
      !openForm &&
      mode !== "completed" &&
      mode !== "overdue" &&
      (isMobile || saveTasks.length > 0),
    [openForm, mode, isMobile, saveTasks.length],
  );

  const transComponents = useMemo(
    () => ({
      b: <b className="font-bold text-black dark:text-white" />,
    }),
    [],
  );

  const renderTaskItem = (task: Task) => {
    if (!isMobile && editingTaskId === task.id) {
      return (
        <TaskForm
          key={task.id}
          openForm
          initiaTask={task}
          formMode="edit"
          onClose={() => setEditingTaskId(null)}
          onSubmit={async (data) => {
            await updateTask(task.id, data);
            setEditingTaskId(null);
          }}
        />
      );
    }

    return (
      <Fragment key={task.id}>
        <TaskCard
          key={task.id}
          task={task}
          isMobile={isMobile}
          isEditing={false}
          showSubTasks={expandedTasks[task.id] !== false}
          selectionMode={selection.selectionMode}
          selected={selection.selectedIds.has(task.id)}
          onSelect={() => selection.toggleSelect(task.id)}
          setShowSubTasks={() => toggleTask(task.id)}
          onEdit={() => handleStartEditing(task.id)}
          onDeleteRequest={() => handleDeleteRequest(task)}
          onAddSubtask={() => handleStartAddSubtask(task.id)}
        />
        {isMobile && (
          <TaskForm
            key={`edit-${task.id}`}
            openForm={editingTaskId === task.id}
            initiaTask={task}
            onStartAddSubtask={handleStartAddSubtask}
            formMode="edit"
            onClose={() => setEditingTaskId(null)}
            onSubmit={async (data) => {
              await updateTask(task.id, data);
              setEditingTaskId(null);
            }}
          />
        )}
      </Fragment>
    );
  };

  if (!ready) {
    return (
      <div className="w-full max-w-[58rem] mx-auto pt-20 opacity-100 transition-opacity duration-300">
        <TaskLoader />
      </div>
    );
  }

  return (
    <>
      <TaskListMenu
        mode={mode}
        selectedProjectId={selectedProjectId}
        onStartSelection={handleStartSelection}
      />

      <div
        className={`w-full max-w-[58rem] mx-auto pt-20 transition-opacity duration-500 ${
          showContent ? "opacity-100" : "opacity-0"
        }`}
      >
        {saveTasks.map((task: Task) => (
          <div key={task.id} className="task-group flex flex-col">
            {renderTaskItem(task)}

            {mode !== "today" && expandedTasks[task.id] !== false && (
              <div
                key={`subtasks-container-${task.id}`}
                className="subtasks-container pl-9 flex flex-col"
              >
                {task.subtasks?.map((sub: Task) => renderTaskItem(sub))}

                <TaskForm
                  openForm={activeParentId === task.id}
                  formMode="create"
                  parentId={task.id}
                  onClose={() => setActiveParentId(null)}
                  onSubmit={async (data) => {
                    await createTask({ ...data, parentId: task.id });
                  }}
                />
              </div>
            )}
          </div>
        ))}
        {shouldShowAddButton && (
          <div className="fixed bottom-[10%] md:static">
            <AddTaskBtn
              showText={!isMobile}
              onOpenForm={() => setOpenForm(true)}
            />
          </div>
        )}
        {!isMobile && openForm && (
          <TaskForm
            openForm={openForm}
            formMode="create"
            onClose={() => setOpenForm(false)}
            onSubmit={async (data) => {
              await createTask(data);
            }}
          />
        )}

        {isMobile && (
          <TaskForm
            openForm={openForm}
            formMode="create"
            onClose={() => setOpenForm(false)}
            onSubmit={async (data) => {
              await createTask(data);
            }}
          />
        )}
      </div>

      {taskToDelete && (
        <ConfirmModal
          title={t("delete_task_title")}
          variant="primary"
          message={
            <Trans
              i18nKey="delete_task_message"
              values={{ title: taskToDelete.title }}
              components={transComponents}
            />
          }
          onConfirm={async () => {
            await deleteTask(taskToDelete.id);
            setTaskToDelete(null);
          }}
          onClose={() => setTaskToDelete(null)}
          confirmText={t("delete_now")}
          cancelText={t("cancel")}
        />
      )}

      {!openForm && saveTasks.length === 0 && (
        <EmptyState mode={mode} onOpenForm={() => setOpenForm(true)} />
      )}

      <Selector
        visible={selection.selectionMode}
        total={selection.total}
        selectedIds={selection.selectedIds}
        toggleSelectAll={selection.toggleSelectAll}
        onClear={selection.clearSelection}
        onComplete={() => selection.bulkComplete([...selection.selectedIds])}
        onDelete={() => selection.bulkDelete([...selection.selectedIds])}
        onUpdateDeadline={(date: Date | null, time: string | null) =>
          selection.bulkUpdateDeadline([...selection.selectedIds], date, time)
        }
        onSetPriority={(p: number) =>
          selection.openPrioritySheet([...selection.selectedIds], p)
        }
      />
    </>
  );
};import { useRef, useState } from "react";
import { useTranslation } from "react-i18next";
import { ProjectMenuController } from "@/components/Projects/Menu/ProjectMenuController";
import { MenuItem } from "@/components/Projects/Menu/MenuItem";

interface TaskListMenuProps {
  mode: string;
  selectedProjectId: string | null;
  onStartSelection: () => void;
}

export const TaskListMenu = ({
  mode,
  selectedProjectId,
  onStartSelection,
}: TaskListMenuProps) => {
  const { t } = useTranslation();
  const btnRef = useRef<HTMLButtonElement | null>(null);

  const [menu, setMenu] = useState<{
    anchor: HTMLElement | null;
    projectId: string | null;
  }>({ anchor: null, projectId: null });

  const openMenu = (el: HTMLButtonElement | null, projectId: string) => {
    setMenu({ anchor: el, projectId });
  };

  if (mode !== "project") return;

  return (
    <div className="mx-auto max-w-[870px]">
      <button
        ref={btnRef}
        onClick={(e) => {
          if (selectedProjectId) {
            e.stopPropagation();
            openMenu(btnRef.current, selectedProjectId);
          }
        }}
        className="fixed top-5 right-5 z-111 flex items-center justify-center
             bg-transparent p-[0.3em] rounded-[8px]
             hover:bg-black/5 dark:hover:bg-[#82828241]
             text-black dark:text-white transition-colors"
      >
        <span className="icon-three-dots-punctuation-sign-svgrepo-com rotate-[90deg] text-[1.3em]" />
      </button>

      <ProjectMenuController
        anchor={menu.anchor}
        projectId={menu.projectId}
        setMenu={setMenu}
        closeMenu={() => setMenu({ anchor: null, projectId: menu.projectId })}
        additionalItems={
          <>
            <MenuItem icon="icon-books" onClick={() => console.log("k")}>
              {t("add_section")}
            </MenuItem>

            {menu.anchor && (
              <MenuItem
                icon="icon-bookmarks"
                onClick={() => {
                  onStartSelection();
                  setMenu({ anchor: null, projectId: null });
                }}
              >
                {t("start_selection")}
              </MenuItem>
            )}

            <div className="border-t border-black/5 dark:border-white/5 my-1 mx-1" />
          </>
        }
      />
    </div>
  );
};import { memo } from "react";

export const TaskLoader = memo(() => {
  return (
    <div className="w-full flex justify-center pt-24">
      <div className="w-10 h-10 border-4 border-black/20 dark:border-white/20 border-t-black dark:border-t-white rounded-full animate-spin" />
    </div>
  );
});import { useMemo } from "react";
import { useTranslation } from "react-i18next";
import {
  useFloating,
  autoUpdate,
  offset,
  flip,
  shift,
  useDismiss,
  useRole,
  useInteractions,
  FloatingPortal,
  FloatingFocusManager,
} from "@floating-ui/react";

import type { Task } from "@/types/tasks";
import { PRIORITY_OPTIONS } from "@/utils/priorities";
import { generateDatePresets } from "@/utils/dateFormatters";
import { QuickBtn } from "@/components/QuickBtn";
import { useTasksActions } from "@/context/TasksContext";
import { Calendar } from "@/components/Calendar/Calendar";
import { isSameDay } from "date-fns";

interface GlobalMenuProps {
  anchorEl: HTMLElement | null;
  isOpen: boolean;
  onClose: () => void;
  task: Task;
  onEdit: () => void;
  onDelete: () => void;
  isCalOpen: boolean;
  setIsCalOpen: (val: boolean) => void;
  updateDate: (newDate: Date | null) => void;
  updateTime: (newTime: string | null) => void;
  onAddSubtask?: () => void;
}

export const GlobalDropdown = ({
  anchorEl,
  isOpen,
  onClose,
  task,
  onEdit,
  onDelete,
  isCalOpen,
  setIsCalOpen,
  updateDate,
  updateTime,
  onAddSubtask,
}: GlobalMenuProps) => {
  const { refs, floatingStyles, context, isPositioned } = useFloating({
    open: isOpen,
    onOpenChange: (open) => !open && onClose(),
    elements: {
      reference: anchorEl,
    },
    whileElementsMounted: autoUpdate,
    placement: "left-end",
    middleware: [offset(4), flip(), shift()],
  });
  const { updateTask } = useTasksActions();
  const { t } = useTranslation();
  const dismiss = useDismiss(context, {
    outsidePressEvent: "click",
    outsidePress: (event) => {
      event.stopPropagation();
      event.preventDefault();
      return true;
    },
  });

  const role = useRole(context);
  const { getFloatingProps } = useInteractions([dismiss, role]);
  const currentDeadlineStr = task.deadline || null;
  const dates = useMemo(() => generateDatePresets(), []);

  if (!isOpen) return null;

  return (
    <FloatingPortal>
      <FloatingFocusManager context={context} modal={false}>
        <div
          // eslint-disable-next-line react-hooks/refs
          ref={refs.setFloating}
          style={{
            ...floatingStyles,
            zIndex: 2000,
            opacity: isPositioned ? 1 : 0,
            visibility: isPositioned ? "visible" : "hidden",
          }}
          {...getFloatingProps()}
          className="transition-opacity duration-200 z-[100] min-w-[20em] min-h-[fit-content] max-w-[20em] bg-white dark:bg-[#232323] border border-black/10 dark:border-[#444] rounded-md p-1 shadow-xl outline-none"
        >
          <div
            onClick={() => onEdit()}
            className="w-full text-left p-2 cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white rounded"
          >
            <span className="icon-pencil"> </span>
            {t("edit")}
          </div>
          {onAddSubtask && (
            <div
              onClick={() => {
                onAddSubtask();
                onClose();
              }}
              className="w-full text-left p-2 cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white rounded"
            >
              <span className="icon-plus-svgrepo-com-1"> </span>
              {t("add_subtask")}
            </div>
          )}
          <div className="border-[0.5px] border-black/10 dark:border-[#444]/80 my-1"></div>

          <div className="my-3 px-2 font-semibold text-black dark:text-white">
            {t("due_date")}
            <div className="flex gap-2 outline-none mt-1">
              <QuickBtn
                icon="icon-calendar-_2"
                color="text-[#00c853]"
                isActive={
                  currentDeadlineStr
                    ? isSameDay(currentDeadlineStr, dates.today)
                    : false
                }
                onClick={() => {
                  updateDate(dates.today);
                  setIsCalOpen(false);
                  onClose();
                }}
              />
              <QuickBtn
                icon="icon-calendar-_5"
                color="text-[#ffab00]"
                isActive={
                  currentDeadlineStr
                    ? isSameDay(currentDeadlineStr, dates.tomorrow)
                    : false
                }
                onClick={() => {
                  updateDate(dates.tomorrow);
                  setIsCalOpen(false);
                  onClose();
                }}
              />
              <QuickBtn
                icon="icon-calendar-_4"
                color="text-blue-500"
                isActive={
                  currentDeadlineStr
                    ? isSameDay(currentDeadlineStr, dates.weekend)
                    : false
                }
                onClick={() => {
                  updateDate(dates.weekend);
                  setIsCalOpen(false);
                  onClose();
                }}
              />
              <QuickBtn
                icon="icon-calendar-_3"
                color="text-[#673ab7]"
                isActive={
                  currentDeadlineStr
                    ? isSameDay(currentDeadlineStr, dates.nextWeek)
                    : false
                }
                onClick={() => {
                  updateDate(dates.nextWeek);
                  setIsCalOpen(false);
                  onClose();
                }}
              />
              {task.deadline && (
                <QuickBtn
                  icon="icon-icons8-close"
                  color="text-[#ff4444]"
                  onClick={() => {
                    updateDate(null);
                    updateTime("");
                    onClose();
                  }}
                />
              )}
              <Calendar
                date={task.deadline}
                setDate={updateDate}
                time={task.reminderAt || null}
                setIsCalOpen={setIsCalOpen}
                setTime={updateTime}
              >
                <span
                  onClick={() => setIsCalOpen(true)}
                  className={`${
                    isCalOpen ? "bg-black/5 dark:bg-[#82828241] " : ""
                  }
                 icon-three-dots-punctuation-sign-svgrepo-com text-[1.2em] flex items-center gap-2 p-2 text-left rounded-lg cursor-pointer transition-all 
      hover:bg-black/5 dark:hover:bg-white/5`}
                />
              </Calendar>
            </div>
          </div>

          <div className="my-3 px-2 font-semibold text-black dark:text-white">
            {t("priority")}
            <div className="flex mt-1 gap-2">
              {PRIORITY_OPTIONS.map((p) => {
                return (
                  <div
                    onClick={() => {
                      updateTask(task.id, { priority: p.value });
                      onClose();
                    }}
                    key={p.value}
                    className={`
                      flex items-center gap-2 p-2 rounded-lg cursor-pointer text-xs
                      ${
                        p.value === task.priority
                          ? "bg-black/5 dark:bg-white/10 text-black dark:text-white"
                          : "text-gray-500 dark:text-white/60 hover:bg-black/5 dark:hover:bg-white/10"
                      }
                    `}
                    style={{
                      background:
                        p.value === task.priority && p.bg !== "transparent"
                          ? p.bg
                          : undefined,
                    }}
                  >
                    <span
                      className="icon-flag text-lg"
                      style={{ color: p.color }}
                    ></span>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="border-[0.5px] border-black/10 dark:border-[#444]/80 my-1"></div>
          <div
            onClick={() => onDelete()}
            className="w-full text-left p-2 hover:bg-red-50 dark:hover:bg-[#333] cursor-pointer text-red-500 dark:text-red-400 rounded"
          >
            <span className="icon-bin"> </span>
            {t("delete")}
          </div>
        </div>
      </FloatingFocusManager>
    </FloatingPortal>
  );
};import { memo } from "react";
import { useTranslation } from "react-i18next";

import type { Project } from "@/types/project";
import { formatFullDate } from "@/utils/dateFormatters";
import { Calendar } from "@/components/Calendar/Calendar";
import type { Locale } from "react-day-picker";
import { localeMap } from "@/i18n";
import { enUS } from "date-fns/locale";

interface TaskMetadataProps {
  deadline?: Date | null;
  reminderAt?: string | null;
  completedAt?: Date | null;
  subCount: number | null;
  subDone: number | null;
  projectId?: string | null;
  projects: Project[] | null;
  mode: string;
  isDone: boolean;
  isSelectionMode?: boolean;
  dateColor: (
    dateInput: Date | null,
    reminderAt?: string | null,
  ) => { color: string; icon: string };

  formatDateLabel: (
    dateInput: Date | null,
    locale: Pick<Locale, "options" | "localize" | "formatLong">,
  ) => string;
  onDateUpdate: (date: Date | null) => void;
  onTimeUpdate: (time: string | null) => void;
  onProjectClick: (projectId: string | null) => void;
}

export const TaskMetadata = memo(function TaskMetadata({
  deadline,
  reminderAt,
  completedAt,
  subCount,
  subDone,
  projectId,
  projects,
  mode,
  isDone,
  isSelectionMode,
  dateColor,
  formatDateLabel,
  onDateUpdate,
  onTimeUpdate,
  onProjectClick,
}: TaskMetadataProps) {
  const { t, i18n } = useTranslation();
  const langKey = i18n.language.split("-")[0];
  const locale = localeMap[langKey] ?? enUS;

  const projectOfTask = projects?.find((p) => p.id === projectId);
  const isCompletedMode = mode === "completed";
  const currentDeadlineStr = deadline ? new Date(deadline) : null;

  const dateLabel = formatDateLabel(currentDeadlineStr, locale);

  const meta = dateColor(currentDeadlineStr, reminderAt);
  const isDefaultColor = meta.color === "currentColor";
  const { label, time } = formatFullDate(completedAt || null, locale);

  const title = ["today", "tomorrow", "yesterday"].includes(label)
    ? t(label)
    : label;

  const shouldShowMetadata =
    subCount !== 0 ||
    currentDeadlineStr ||
    (isCompletedMode && completedAt) ||
    mode === "today" ||
    mode === "overdue";

  if (!shouldShowMetadata) return null;

  return (
    <div className="flex items-center text-[12px] md:text-[15px] gap-2 w-full flex-wrap">
      {subCount !== 0 && (
        <div className="text-gray-500 dark:text-[#777] flex items-center gap-1">
          <span className="icon-pie-chart" />
          {subDone}/{subCount}
        </div>
      )}

      {currentDeadlineStr && !isCompletedMode && (
        <button
          style={{
            color: isDone || isDefaultColor ? undefined : meta.color,
            pointerEvents: isDone ? "none" : "all",
          }}
          className={`flex items-center gap-1 ${
            isDone
              ? "text-gray-400 dark:text-gray-500"
              : isDefaultColor
                ? "text-gray-600 dark:text-gray-400"
                : ""
          }`}
          onClick={(e) => e.stopPropagation()}
          disabled={isSelectionMode}
        >
          <Calendar
            date={currentDeadlineStr}
            setDate={onDateUpdate}
            time={reminderAt || null}
            setTime={onTimeUpdate}
          >
            <span className="flex items-center gap-1 cursor-pointer">
              <span className={meta.icon} />
              {t(dateLabel)}
              {reminderAt && (
                <span className="ml-1 opacity-80">{reminderAt}</span>
              )}
            </span>
          </Calendar>
        </button>
      )}

      {isCompletedMode && completedAt && (
        <span className="text-[10px] opacity-60 text-gray-500 dark:text-gray-400">
          {t("completed")}: {title} - {time}
        </span>
      )}

      {(mode === "today" || isCompletedMode || mode === "overdue") && (
        <span
          onClick={(e) => {
            e.stopPropagation();
            onProjectClick(projectId || null);
          }}
          className="px-1.5 py-0.5 text-[8px] md:text-[10px] flex items-center gap-1 hover:bg-black/5 dark:hover:bg-white/10 cursor-pointer rounded-md transition-colors"
        >
          <span
            style={{ color: projectOfTask?.color || "#888" }}
            className={`icon-${
              projectOfTask?.title ? "heart-svgrepo-com" : "price-tag"
            }`}
          />
          <span className="opacity-60 text-gray-600 dark:text-gray-300">
            {projectOfTask?.title || "Inbox"}
          </span>
        </span>
      )}
    </div>
  );
});import { useState } from "react";
import { useTranslation } from "react-i18next";
import { useAuthActions, useAuthState } from "@/context/AuthProvider";
import { useIsMobile } from "@/hooks/useIsMobile";

export const UpdateUserInfoForm = ({ onClose }: { onClose: () => void }) => {
  const { t } = useTranslation();
  const { updateUserInfo } = useAuthActions();
  const { user } = useAuthState();
  const isMobile = useIsMobile();

  const [userName, setUserName] = useState(user?.userName || "");
  const [userEmail, setUserEmail] = useState(user?.email || "");

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    await updateUserInfo({ userName, email: userEmail });
    onClose();
  };

  return (
    <form onSubmit={handleSubmit} onClick={(e) => e.stopPropagation()}>
      <h2 className="text-2 text-black dark:text-white border-b border-black/10 dark:border-[#d0d0d05a]/60 mb-2 pb-2 ">
        {t("update_profile")}{" "}
      </h2>

      <div className="flex flex-col gap-4 mt-4">
        <div className="flex flex-col gap-1.5">
          <label className="relative block">
            <input
              minLength={3}
              maxLength={30}
              placeholder=" "
              required
              autoFocus
              autoComplete="username"
              type="text"
              value={userName}
              className="peer w-full p-[0.9em] text-[0.8em] rounded-[10px] bg-transparent text-black dark:text-white outline outline-1 outline-black/20 dark:outline-white/10 focus:outline-2 focus:outline-[#4270d1] transition-all"
              onChange={(e) => setUserName(e.target.value)}
            />
            <span className="absolute top-[0.55em] left-[0.5em] px-[0.5em] bg-white dark:bg-[#242424] text-gray-500 transition-all pointer-events-none peer-focus:-top-[0.7em] peer-focus:text-[0.75em] peer-focus:text-[#4270d1] peer-[:not(:placeholder-shown)]:-top-[0.7em] peer-[:not(:placeholder-shown)]:text-[0.75em]">
              {t("your_name")}
            </span>
          </label>
        </div>

        <div className="flex flex-col gap-1.5">
          <label className="relative block">
            <input
              minLength={3}
              maxLength={30}
              placeholder=" "
              required
              autoComplete="email"
              type="email"
              value={userEmail}
              onChange={(e) => setUserEmail(e.target.value)}
              className="peer w-full p-[0.9em] text-[0.8em] rounded-[10px] bg-transparent text-black dark:text-white outline outline-1 outline-black/20 dark:outline-white/10 focus:outline-2 focus:outline-[#4270d1] transition-all"
            />
            <span className="absolute top-[0.55em] left-[0.5em] px-[0.5em] bg-white dark:bg-[#242424] text-gray-500 transition-all pointer-events-none peer-focus:-top-[0.7em] peer-focus:text-[0.75em] peer-focus:text-[#4270d1] peer-[:not(:placeholder-shown)]:-top-[0.7em] peer-[:not(:placeholder-shown)]:text-[0.75em]">
              {t("email_label")}
            </span>
          </label>
        </div>
      </div>
      <div
        className={`flex gap-3 ${isMobile ? "flex-col" : "justify-end"} mt-6`}
      >
        <button type="button" onClick={onClose} className="...">
          {t("cancel")}
        </button>
        <button type="submit" className="...">
          {t("save_changes")}
        </button>
      </div>
    </form>
  );
};import { useIsMobile } from "@/hooks/useIsMobile";
import type { UpdateUserInfoProps } from "@/types/updateUserInfo";
import { UpdateUserInfoDesktop } from "@/components/User/UpdateUserInfo/UpdateUserInfoDesktop";
import { UpdateUserInfoMobile } from "@/components/User/UpdateUserInfo/UpdateUserInfoMobile";

export const UpdateUserInfo = (props: UpdateUserInfoProps) => {
  const isMobile = useIsMobile();

  return isMobile ? (
    <UpdateUserInfoMobile {...props} />
  ) : (
    <UpdateUserInfoDesktop {...props} />
  );
};import { useEffect } from "react";
import {
  useFloating,
  autoUpdate,
  offset,
  flip,
  shift,
  useDismiss,
  useRole,
  useInteractions,
} from "@floating-ui/react";
import { FloatingFocusManager, FloatingPortal } from "@floating-ui/react";
import type { UpdateUserInfoProps } from "@/types/updateUserInfo";
import { UpdateUserInfoForm } from "@/components/User/UpdateUserInfo/UpdateUserForm";

export const UpdateUserInfoDesktop = ({
  isOpen,
  onClose,
  anchorRef,
}: UpdateUserInfoProps) => {
  const { refs, floatingStyles, context, isPositioned } = useFloating({
    open: isOpen,
    onOpenChange: (open) => {
      if (!open) onClose();
    },
    whileElementsMounted: autoUpdate,
    placement: "bottom",
    middleware: [offset(4), flip(), shift()],
  });

  const dismiss = useDismiss(context, {
    outsidePressEvent: "click",
    outsidePress: (event) => {
      event.stopPropagation();
      event.preventDefault();
      return true;
    },
  });

  const role = useRole(context);
  const { getFloatingProps } = useInteractions([dismiss, role]);
  useEffect(() => {
    if (anchorRef.current) {
      refs.setReference(anchorRef.current);
    }
  }, [anchorRef, refs]);
  return (
    <FloatingPortal>
      {isOpen && (
        <FloatingFocusManager context={context} modal={false}>
          <div
            // eslint-disable-next-line react-hooks/refs
            ref={refs.setFloating}
            style={{
              ...floatingStyles,
              zIndex: 2000,
              opacity: isPositioned ? 1 : 0,
              visibility: isPositioned ? "visible" : "hidden",
            }}
            {...getFloatingProps()}
            className="transition-opacity duration-200"
          >
            <div className="bg-white dark:bg-[#242424] w-full min-w-[320px] max-w-[400px] p-6 rounded-lg border border-black/10 dark:border-white/5 shadow-2xl flex flex-col gap-5 animate-in fade-in zoom-in duration-200">
              <UpdateUserInfoForm onClose={onClose} />
            </div>
          </div>
        </FloatingFocusManager>
      )}
    </FloatingPortal>
  );
};import type { UpdateUserInfoProps } from "@/types/updateUserInfo";
import { MobileDrawer } from "@/features/MobileDrawer";
import { UpdateUserInfoForm } from "@/components/User/UpdateUserInfo/UpdateUserForm";

export const UpdateUserInfoMobile = ({
  isOpen,
  onClose,
}: UpdateUserInfoProps) => {
  return (
    <MobileDrawer
      onClose={onClose}
      open={isOpen}
      drawerDescription="Edit profile"
      drawerTitle="Update your name, email, and personal details."
    >
      <div className="px-3 pt-2 pb-safe flex flex-col gap-4">
        <UpdateUserInfoForm onClose={onClose} />
      </div>
    </MobileDrawer>
  );
};import { useState, useRef, useMemo } from "react";
import { useTranslation } from "react-i18next";
import { localeMap } from "@/i18n";
import { formatDistanceToNow } from "date-fns";
import { enUS } from "date-fns/locale";
import type { Task } from "@/types/tasks";
import { ModalPortal } from "@/features/ModalPortal";
import { applyTheme } from "@/utils/userSettings";
import { useAuthState, useAuthActions } from "@/context/AuthProvider";
import { useProjectsContext } from "@/context/ProjectsContext";
import { useTasksState } from "@/context/TasksContext";
import { useIsMobile } from "@/hooks/useIsMobile";
import { ConfirmModal } from "@/components/ConfirmModal";
import { UpdateUserInfo } from "@/components/User/UpdateUserInfo/UpdateUserInfo";
import { UserInfoMobile } from "@/components/User/UserInfo/UserInfoMobile";
import { UserInfoDesktop } from "@/components/User/UserInfo/UserInfoDesktop";

export const UserInfo = ({
  onClose,
  isOpen,
}: {
  onClose: () => void;
  isOpen: boolean;
}) => {
  const isMobile = useIsMobile();
  const { t, i18n: i18nInstance } = useTranslation();
  const { logoutUser, deleteUser } = useAuthActions();
  const { user } = useAuthState();
  const { projects } = useProjectsContext();
  const { tasks } = useTasksState();

  const anchorRef = useRef<HTMLButtonElement>(null);

  const [currentTheme, setCurrentTheme] = useState(
    localStorage.getItem("theme") || "system",
  );
  const [openComfirm, setOpenConfirm] = useState(false);
  const [openForm, setOpenForm] = useState(false);
  const [openComfirmDelete, setOpenConfirmDelete] = useState(false);

  const currentLocale = useMemo(
    () => localeMap[i18nInstance.language] || enUS,
    [i18nInstance.language],
  );

  const projectsCount = projects.length || 0;
  const isSubModalOpen = openComfirm || openComfirmDelete || openForm;
  const safeTasks = tasks === null ? [] : tasks;
  const undoneTasksCount = useMemo(
    () => safeTasks.filter((t: Task) => !t.isDone).length,
    [tasks],
  );

  const timeAgo = useMemo(
    () =>
      user?.createdAt
        ? formatDistanceToNow(new Date(user.createdAt), {
            addSuffix: true,
            locale: currentLocale,
          })
        : "",
    [user, currentLocale],
  );

  const formattedDate = useMemo(
    () =>
      user?.createdAt
        ? new Date(user.createdAt).toLocaleDateString(i18nInstance.language)
        : "",
    [user, i18nInstance.language],
  );

  const handleLangChange = (langValue: string | number | null) => {
    if (typeof langValue === "string") i18nInstance.changeLanguage(langValue);
  };

  const handleThemeChange = (newTheme: string | number | null) => {
    if (typeof newTheme === "string") {
      setCurrentTheme(newTheme);
      applyTheme(newTheme);
    }
  };

  const props = {
    onClose,
    isOpen,
    isSubModalOpen,
    openComfirmDelete,
    setOpenConfirm,
    setOpenForm,
    setOpenConfirmDelete,
    anchorRef,
    projectsCount,
    undoneTasksCount,
    timeAgo,
    formattedDate,
    handleThemeChange,
    handleLangChange,
    currentTheme,
  };

  if (!user) return null;
  return (
    <>
      {isMobile ? (
        <UserInfoMobile {...props} />
      ) : (
        <UserInfoDesktop {...props} />
      )}
      {openComfirm && (
        <ModalPortal>
          <ConfirmModal
            title={t("logout_confirm_title")}
            message={t("logout_confirm_msg")}
            variant="warning"
            cancelText={t("cancel")}
            confirmText={t("logout")}
            onConfirm={logoutUser}
            onClose={() => setOpenConfirm(false)}
          />
        </ModalPortal>
      )}

      {openComfirmDelete && (
        <ModalPortal>
          <ConfirmModal
            title={t("delete_confirm_title")}
            message={t("delete_confirm_msg")}
            variant="danger"
            cancelText={t("cancel")}
            confirmText={t("confirm_delete_btn")}
            onConfirm={() => deleteUser()}
            onClose={() => setOpenConfirmDelete(false)}
          />
        </ModalPortal>
      )}

      <ModalPortal>
        <UpdateUserInfo
          anchorRef={anchorRef}
          isOpen={openForm}
          onClose={() => setOpenForm(false)}
        />
      </ModalPortal>
    </>
  );
};import { useMemo } from "react";
import { useTranslation } from "react-i18next";
import type { UserInfoBaseProps } from "@/types/UserInfo";
import { THEME_OPTIONS, LANG_OPTIONS } from "@/utils/userSettings";
import { useAuthState } from "@/context/AuthProvider";
import { Select } from "@/components/Select";

export const UserInfoBase = ({
  anchorRef,
  setOpenConfirm,
  setOpenConfirmDelete,
  setOpenForm,
  projectsCount,
  undoneTasksCount,
  timeAgo,
  formattedDate,
  handleThemeChange,
  currentTheme,
  handleLangChange,
}: UserInfoBaseProps) => {
  const { user } = useAuthState();
  const { t, i18n } = useTranslation();

  const themeOptions = useMemo(
    () =>
      THEME_OPTIONS.map((opt) => ({
        ...opt,
        label: t(opt.label),
      })),
    [t],
  );
  if (!user) return null;
  return (
    <>
      <div className="flex items-center justify-between p-4 border-b border-black/10 dark:border-white/10">
        <div className="flex items-center">
          <div className="w-14 h-14 bg-gray-100 dark:bg-[#333] rounded-lg flex items-center justify-center text-2xl font-bold text-black dark:text-white">
            {user.userName?.charAt(0).toUpperCase() ||
              user.email.charAt(0).toUpperCase()}
          </div>
          <div className="ml-3">
            <h3 className="text-lg font-bold text-black dark:text-white">
              {user.userName || "User"}
            </h3>
            <p className="text-gray-500 dark:text-gray-400 text-sm">
              {user.email}
            </p>
          </div>
        </div>
        <div className="flex items-center">
          <button
            type="button"
            ref={anchorRef}
            onClick={() => setOpenForm(true)}
            className="icon-pencil text-gray-400 p-3 rounded-lg cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] transition-colors"
          />
        </div>
      </div>

      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        <div className="grid grid-cols-2 gap-3">
          <div className="bg-gray-50 dark:bg-[#2a2a2a] p-3 rounded-lg flex flex-col items-center">
            <span className="icon-folder-open text-[#4270d1] text-lg mb-1" />
            <span className="text-xl font-bold text-black dark:text-white">
              {projectsCount}
            </span>
            <span className="text-[10px] text-gray-500 uppercase font-semibold">
              {t("projects_count")}
            </span>
          </div>
          <div className="bg-gray-50 dark:bg-[#2a2a2a] p-3 rounded-lg flex flex-col items-center">
            <span className="icon-pushpin text-[#9d174d] text-lg mb-1" />
            <span className="text-xl font-bold text-black dark:text-white">
              {undoneTasksCount}
            </span>
            <span className="text-[10px] text-gray-500 uppercase font-semibold">
              {t("active_tasks_count")}
            </span>
          </div>
        </div>

        <div className="bg-gray-50 dark:bg-[#2a2a2a] p-3 rounded-lg flex items-center space-x-3">
          <div className="bg-blue-500/10 p-2 rounded-lg">
            <span className="icon-calendar text-[#4270d1]" />
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] text-gray-500 uppercase font-bold">
              {t("joined")}
            </span>
            <span className="text-sm text-gray-800 dark:text-gray-300">
              {timeAgo}
            </span>
            <span className="text-[10px] text-gray-400 dark:text-gray-500">
              {formattedDate}
            </span>
          </div>
        </div>

        <div className="space-y-2">
          <Select
            position="bottom-start"
            symbol={currentTheme === "dark" ? "icon-night" : "icon-sun"}
            value={currentTheme}
            options={themeOptions}
            onChange={handleThemeChange}
            border={false}
          />
          <Select
            position="bottom-start"
            symbol="icon-language"
            value={i18n.resolvedLanguage || null}
            options={LANG_OPTIONS}
            onChange={handleLangChange}
            border={false}
          />
        </div>

        <div className="space-y-2 mt-4">
          <button className="w-full p-3 flex items-center justify-center bg-gray-100 dark:bg-[#333] rounded-lg font-semibold hover:bg-gray-200 dark:hover:bg-[#444] transition">
            <span className="icon-prize mr-2" />
            {t("statistics")}
          </button>

          <button
            onClick={() => setOpenConfirm(true)}
            className="w-full p-3 flex items-center justify-center bg-[#4270d1]/10 text-[#4270d1] rounded-lg font-bold hover:bg-[#4270d1] hover:text-white transition"
          >
            <span className="icon-user-minus mr-2" />
            {t("logout")}
          </button>

          <button
            onClick={() => setOpenConfirmDelete(true)}
            className="w-full p-3 flex items-center justify-center bg-[#9d174d]/10 text-[#9d174d] rounded-lg font-bold hover:bg-[#9d174d] hover:text-white transition"
          >
            <span className="icon-bin2 mr-2" />
            {t("delete_account")}
          </button>
        </div>
      </div>
    </>
  );
};import type { UserInfoProps } from "@/types/UserInfo";
import { UserInfoBase } from "@/components/User/UserInfo/UserInfoBase";

export const UserInfoDesktop = (props: UserInfoProps) => {
  const { onClose, isOpen, isSubModalOpen } = props;

  return (
    <div
      className={`fixed inset-0 pointer-events-auto z-[1000] flex items-center justify-center transition-all duration-300 ease-in-out ${
        isOpen
          ? "opacity-100 visible backdrop-blur-sm bg-black/20"
          : "opacity-0 invisible backdrop-blur-0 bg-black/0"
      }`}
      onClick={() => {
        if (!isSubModalOpen) onClose();
      }}
    >
      <div
        className={`relative z-[100] bg-white dark:bg-[#242424] w-full max-w-[450px] rounded-lg border border-black/5 dark:border-white/5 transform transition-all duration-300 ease-out p-2 shadow-2xl ${
          isOpen ? "scale-100 opacity-100" : "scale-95 opacity-0"
        }`}
        onClick={(e) => e.stopPropagation()}
      >
        <span
          onClick={onClose}
          className="icon-icons8-close absolute top-3 right-3 flex items-center justify-center leading-none bg-transparent p-[0.3em] rounded-[8px] cursor-pointer hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white transition-colors"
        />

        <UserInfoBase
          anchorRef={props.anchorRef}
          setOpenConfirm={props.setOpenConfirm}
          setOpenConfirmDelete={props.setOpenConfirmDelete}
          setOpenForm={props.setOpenForm}
          projectsCount={props.projectsCount}
          undoneTasksCount={props.undoneTasksCount}
          timeAgo={props.timeAgo}
          formattedDate={props.formattedDate}
          handleThemeChange={props.handleThemeChange}
          currentTheme={props.currentTheme}
          handleLangChange={props.handleLangChange}
        />
      </div>
    </div>
  );
};import type { UserInfoProps } from "@/types/UserInfo";
import { MobileDrawer } from "@/features/MobileDrawer";
import { UserInfoBase } from "@/components/User/UserInfo/UserInfoBase";

export const UserInfoMobile = ({ ...props }: UserInfoProps) => {
  return (
    <MobileDrawer
      onClose={props.onClose}
      open={props.isOpen}
      drawerTitle="Profile"
      drawerDescription="Manage your account, preferences, and view your activity."
    >
      <UserInfoBase
        anchorRef={props.anchorRef}
        setOpenConfirm={props.setOpenConfirm}
        setOpenConfirmDelete={props.setOpenConfirmDelete}
        setOpenForm={props.setOpenForm}
        projectsCount={props.projectsCount}
        undoneTasksCount={props.undoneTasksCount}
        timeAgo={props.timeAgo}
        formattedDate={props.formattedDate}
        handleThemeChange={props.handleThemeChange}
        currentTheme={props.currentTheme}
        handleLangChange={props.handleLangChange}
      />
    </MobileDrawer>
  );
};import { useAuthState } from "@/context/AuthProvider";

export const UserBtn = ({ onClick }: { onClick: () => void }) => {
  const { user } = useAuthState();
  return (
    <div className="mb-6 font-semibold">
      <span
        className="w-full flex items-center gap-2 cursor-pointer group"
        onClick={onClick}
      >
        <div className="w-10 h-10 bg-[#999] dark:bg-[#333] border border-[#888] dark:border-[#222] rounded-lg flex items-center justify-center text-xl font-bold text-white shadow-md transition-transform group-hover:scale-105">
          {user?.userName?.charAt(0).toUpperCase() ||
            user?.email.charAt(0).toUpperCase()}
        </div>
        <span className="text-[#4270d1] truncate">
          {user?.userName || user?.email.split("@")[0]}
        </span>
      </span>
    </div>
  );
};import { useTranslation } from "react-i18next";

interface AddTaskBtnProps {
  onOpenForm: () => void;
  showText?: boolean;
}

export const AddTaskBtn = ({
  onOpenForm,
  showText = true,
}: AddTaskBtnProps) => {
  const { t } = useTranslation();
  return (
    <button
      onClick={onOpenForm}
      className="group w-full flex items-center gap-3 py-2  cursor-pointer transition-all focus:outline-none "
    >
      <div
        className="flex items-center justify-center w-[55px] h-[55px] md:w-[22px] md:h-[22px] rounded-full 
                    border border-[#9d174d] text-[#9d174d] bg-[#9d174d] md:bg-transparent
                    md:group-hover:bg-[#9d174d] transition-all duration-200"
      >
        <svg
          width={showText ? "12" : "30"}
          height={showText ? "12" : "30"}
          viewBox="0 0 12 12"
          fill="none"
          stroke="currentColor"
          strokeWidth="1"
          strokeLinecap="round"
          className="md:group-hover:text-white text-white md:text-[#9d174d] transition-colors"
        >
          <line x1="6" y1="2" x2="6" y2="10" />
          <line x1="2" y1="6" x2="10" y2="6" />
        </svg>
      </div>

      <span className="text-[14px] font-medium dark:text-white/50 text-black/70 md:group-hover:text-[#9d174d] transition-colors">
        {showText && t("add_task")}
      </span>
    </button>
  );
};import { useState } from "react";
import { useTranslation } from "react-i18next";
import { MobileMenu, Sidebar } from "@/components/Sidebar/Sidebar";
import { useProjectsContext } from "@/context/ProjectsContext";

interface AppLayoutProps {
  children: React.ReactNode;
}

export function AppLayout({ children }: AppLayoutProps) {
  const [collapsed, setCollapsed] = useState(false);
  const { t } = useTranslation();
  const { mode, selectedProject } = useProjectsContext();

  return (
    <div className="flex w-full bg-white dark:bg-[#1f1f1f] transition-colors duration-300 overflow-hidden">
      <div
        className={`absolute top-2 z-[999] cursor-pointer hidden md:block 
          flex items-center justify-center leading-none bg-transparent p-[0.3em] rounded-[8px] 
          hover:bg-black/5 dark:hover:bg-[#82828241] text-black dark:text-white
          transition-all duration-300 ease-in-out
          ${collapsed ? "left-2" : "left-[calc(100%-3rem)] sm:left-[19.5em]"}
        `}
        onClick={() => setCollapsed((v) => !v)}
      >
        <span
          className={`text-[1.3em] ${
            collapsed ? "icon-icons8-menu-bar" : "icon-icons8-close"
          }`}
        />
      </div>

      <Sidebar collapsed={collapsed} />
      <MobileMenu />
      <main className="flex-1 h-[100dvh] overflow-y-auto overflow-x-hidden p-4 !pt-0 sm:p-[24px] bg-white dark:bg-[#1f1f1f] text-black dark:text-white pb-15">
        {children}

        <div className="w-full top-0 p-4 bg-gradient-to-b from-white/90 to-white/0 dark:from-[#1f1f1f]/90 dark:to-[#1f1f1f]/0 absolute">
          <div className="p-3 font-bold">
            {selectedProject?.toUpperCase() ||
              t(mode.toLowerCase()).toUpperCase()}
          </div>
        </div>
      </main>
    </div>
  );
}import React, {
  useState,
  useRef,
  useEffect,
  useMemo,
  useCallback,
} from "react";
import { useNavigate, useSearchParams, useLocation } from "react-router-dom";
import { useTranslation } from "react-i18next";
import { useAuthActions } from "@/context/AuthProvider";
import img from "@/assets/form.png";

interface AuthPageProps {
  isLoginMode: boolean;
}

export const AuthPage = ({ isLoginMode }: AuthPageProps) => {
  const { t } = useTranslation();
  const [searchParams] = useSearchParams();
  const location = useLocation();
  const navigate = useNavigate();
  const locationState = location.state as {
    from?: { pathname: string };
  } | null;

  const from = locationState?.from?.pathname || searchParams.get("from") || "/";
  const { loginUser, registerUser } = useAuthActions();
  const [confirmPassword, setConfirmPassword] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [userName, setUserName] = useState("");
  const [error, setError] = useState<string | null>(null);
  const [showPass, setShowPass] = useState(false);
  const spotlightRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const container = spotlightRef.current;
    if (!container) return;

    const handleMouseMove = (event: MouseEvent) => {
      const rect = container.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      container.style.setProperty("--x", `${x}px`);
      container.style.setProperty("--y", `${y}px`);
    };

    window.addEventListener("mousemove", handleMouseMove);
    return () => window.removeEventListener("mousemove", handleMouseMove);
  }, []);

  const isMatching = useMemo(
    () => password === confirmPassword,
    [password, confirmPassword],
  );

  const handleSubmit = useCallback(
    async (e: React.FormEvent) => {
      e.preventDefault();
      e.stopPropagation();

      setError(null);

      if (!isLoginMode) {
        if (password.length < 8) {
          setError(t("password_min_length"));
          return;
        }
        if (password !== confirmPassword) {
          setError(t("passwords_not_match"));
          return;
        }
        if (!userName.trim()) {
          setError(t("name_required"));
          return;
        }
      }

      if (email && password) {
        try {
          if (isLoginMode) {
            await loginUser({ email, password });
          } else {
            await registerUser({ userName, email, password });
          }

          navigate(from, { replace: true });
        } catch (err) {
          const error = err as Error;
          const serverMessage = error.message;

          const errorMapping: Record<string, string> = {
            "Invalid credentials": "auth_error_invalid",
            "User already exists": "user_already_exists",
            "Internal server error": "server_error",
            "No token provided": "token_missing_error",
            "Failed to fetch": "connection_error",
          };

          const translationKey =
            errorMapping[serverMessage] || "connection_error";

          setError(t(translationKey));
        }
      }
    },
    [
      isLoginMode,
      email,
      password,
      confirmPassword,
      userName,
      loginUser,
      registerUser,
      navigate,
      from,
      t,
    ],
  );

  return (
    <div
      style={
        {
          "--x": "50%",
          "--y": "50%",
          backgroundImage: `radial-gradient(circle at var(--x) var(--y), rgba(255, 255, 255, 0.15) 0%, rgba(0, 0, 0, 0.95) 25%), url(${img})`,
          backgroundSize: "cover",
          backgroundPosition: "center",
        } as React.CSSProperties
      }
      ref={spotlightRef}
      className="flex h-screen overflow-hidden"
    >
      <div className="flex flex-1 md:max-w-[40em] flex-col items-center justify-center p-6  ">
        <form
          className="flex flex-col gap-[1.2em] p-[2em] rounded-[10px] shadow-[0_0_15px_rgb(27,27,27)] w-full max-w-[35em] bg-transparent backdrop-blur-md border border-white/10"
          onSubmit={handleSubmit}
        >
          <legend className="md:text-[2em] text-[1.5em] font-bold bg-gradient-to-r from-[#4270d1] via-[#9d174d] to-[#9d174d] bg-clip-text text-transparent mb-4">
            {isLoginMode ? t("login_title") : t("register_title")}
          </legend>

          {error && (
            <div className="py-3 rounded-lg text-red-500 text-sm animate-shake">
              {error}
            </div>
          )}

          {!isLoginMode && (
            <label className="relative block">
              <input
                minLength={3}
                maxLength={30}
                placeholder=" "
                required
                autoComplete="username"
                type="text"
                value={userName}
                className="peer w-full p-[1em] rounded-[10px] bg-transparent text-white outline outline-1 outline-gray-500 focus:outline-2 focus:outline-[#4270d1] transition-all"
                onChange={(e) => setUserName(e.target.value)}
              />
              <span
                className="absolute left-[1em] transition-all pointer-events-none bg-transparent top-[1em] text-white/50 peer-focus:-top-[1.5em] peer-focus:left-[0.2em] peer-focus:text-[0.8em] peer-focus:text-[#4270d1]
              peer-[:not(:placeholder-shown)]:-top-[1.4em] peer-[:not(:placeholder-shown)]:left-[0.2em] 
              peer-[:not(:placeholder-shown)]:text-[0.8em]"
              >
                {t("your_name")}
              </span>
            </label>
          )}

          <label className="relative block">
            <input
              minLength={8}
              maxLength={150}
              placeholder=" "
              required
              type="email"
              autoComplete="email"
              value={email}
              className={`peer w-full p-[1em] rounded-[10px] bg-transparent text-white outline transition-all outline-1 focus:outline-2 outline-gray-500 focus:outline-[#4270d1]
     `}
              onChange={(e) => {
                setEmail(e.target.value);
                if (error) setError(null);
              }}
            />
            <span
              className={`
   
      absolute left-[1em] top-[1em] transition-all duration-200 pointer-events-none bg-transparent
      peer-focus:-top-[1.5em] peer-focus:left-[0.2em] peer-focus:text-[0.8em]
      peer-[:not(:placeholder-shown)]:-top-[1.5em] 
      peer-[:not(:placeholder-shown)]:left-[0.2em] 
      peer-[:not(:placeholder-shown)]:text-[0.8em]
      text-white/50 peer-focus:text-[#4270d1] peer-[:not(:placeholder-shown)]:text-[#4270d1]
      `}
            >
              {t("email_label")}
            </span>
          </label>

          <label className="relative block">
            <input
              placeholder=" "
              minLength={8}
              maxLength={30}
              required
              autoComplete={isLoginMode ? "current-password" : "new-password"}
              type={showPass ? "text" : "password"}
              value={password}
              className={`peer w-full p-[1em] rounded-[10px] bg-transparent text-white outline transition-all focus:outline-2 
                ${
                  password.length > 0 && password.length < 8 && !isLoginMode
                    ? "outline-2 outline-red-500 focus:outline-red-500"
                    : "outline-1 outline-gray-500 focus:outline-[#4270d1]"
                }`}
              onChange={(e) => setPassword(e.target.value)}
            />

            <span
              className={`
    absolute left-[1em] transition-all pointer-events-none bg-transparent
    top-[1em] 
    peer-focus:-top-[1.5em] peer-focus:left-[0.2em] peer-focus:text-[0.8em] peer-focus:text-[#4270d1]
    peer-[:not(:placeholder-shown)]:-top-[1.5em] peer-[:not(:placeholder-shown)]:left-[0.2em] peer-[:not(:placeholder-shown)]:text-[0.8em]
   ${
     password.length > 0 && password.length < 8 && !isLoginMode
       ? "!text-red-500"
       : "text-white/50 peer-focus:text-[#4270d1]"
   }`}
            >
              {t("password_label")}
            </span>
            {password.length > 0 && password.length < 8 && !isLoginMode && (
              <span className="text-[0.7em] text-red-500 mt-1 block">
                {t("password_min_length")}
              </span>
            )}
            {!isLoginMode && (
              <button
                type="button"
                onClick={() => {
                  const pass = Math.random().toString(36).slice(-10);
                  setPassword(pass);
                  setConfirmPassword(pass);
                }}
                className="text-[#4270d1] pt-3 cursor-pointer text-sm flex items-center gap-2 hover:underline w-fit"
              >
                <span className="icon-key2"></span> {t("generate_password")}
              </button>
            )}
          </label>

          {!isLoginMode && (
            <label className="relative block">
              <input
                placeholder=" "
                required
                autoComplete={isLoginMode ? "current-password" : "new-password"}
                type={showPass ? "text" : "password"}
                value={confirmPassword}
                className={`peer w-full p-[1em] rounded-[10px] bg-transparent text-white outline transition-all focus:outline-2 
                  ${
                    confirmPassword.length > 0 && !isMatching
                      ? "outline-2 outline-red-500 focus:outline-red-500"
                      : "outline-1 outline-gray-500 focus:outline-[#4270d1]"
                  }`}
                onChange={(e) => setConfirmPassword(e.target.value)}
              />

              <span
                className={`
    absolute left-[1em] transition-all pointer-events-none bg-transparent
    top-[1em] 
    peer-focus:-top-[1.5em] peer-focus:left-[0.2em] peer-focus:text-[0.8em] peer-focus:text-[#4270d1]
    peer-[:not(:placeholder-shown)]:-top-[1.5em] peer-[:not(:placeholder-shown)]:left-[0.2em] peer-[:not(:placeholder-shown)]:text-[0.8em]
  ${
    confirmPassword.length > 0 && !isMatching
      ? "!text-red-500"
      : "text-white/50 peer-focus:text-[#4270d1]"
  }`}
              >
                {t("confirm_password_label")}
              </span>
              {!isMatching && confirmPassword.length > 0 && (
                <span className="text-[0.7em] text-red-500 mt-1 block">
                  {t("passwords_not_match")}
                </span>
              )}
            </label>
          )}

          <div className="flex items-center gap-2 text-white text-sm">
            <input
              type="checkbox"
              className="accent-[#4270d1]"
              checked={showPass}
              onChange={() => setShowPass(!showPass)}
            />
            <label
              className="cursor-pointer"
              onClick={() => setShowPass(!showPass)}
            >
              {t("show_password_label")}
            </label>
          </div>

          <button
            type="submit"
            className="w-full py-3 bg-[#4270d1] cursor-pointer text-white font-bold rounded-lg hover:bg-[#4270d9] transition-all shadow-lg active:scale-95"
          >
            {isLoginMode ? t("login_btn") : t("create_btn")}
          </button>

          <div className="text-center mt-2 border-t border-gray-700 pt-4">
            <button
              type="button"
              onClick={() => {
                navigate(isLoginMode ? "/register" : "/login");
                if (error) {
                  setError(null);
                  setEmail("");
                  setPassword("");
                  setConfirmPassword("");
                  setUserName("");
                }
              }}
              className="text-[#4270d1] cursor-pointer text-sm hover:underline"
            >
              {isLoginMode
                ? t("auth_switch_to_register")
                : t("auth_switch_to_login")}
            </button>
          </div>
        </form>
      </div>
      <div className="md:w-[40%] h-full"></div>
    </div>
  );
};import { useTranslation } from "react-i18next";

interface ConfirmModalProps {
  onConfirm: () => void | Promise<void>;
  onClose: () => void;
  title: string;
  message?: React.ReactNode;
  confirmText?: string;
  cancelText?: string;
  variant?: "danger" | "primary" | "warning";
  isLoading?: boolean;
}
const variantStyles = {
  danger: "bg-[#9d174d] hover:shadow-[0_0_15px_rgba(157,23,77,0.4)]",
  primary: "bg-[#4270d1] hover:shadow-[0_0_15px_rgba(37,99,235,0.4)]",
  warning: "bg-orange-500 hover:shadow-[0_0_15px_rgba(249,115,22,0.4)]",
};
export const ConfirmModal = ({
  onConfirm,
  onClose,
  title,
  message,
  confirmText,
  cancelText,
  variant = "danger",
  isLoading = false,
}: ConfirmModalProps) => {
  const { t } = useTranslation();

  return (
    <div
      className="absolute inset-0 bg-black/40 backdrop-blur-sm flex justify-center items-start pt-[15%] z-[1000] pointer-events-auto p-4"
      onClick={onClose}
    >
      <div
        className="bg-white dark:bg-[#222] w-full max-w-[400px] p-6 rounded-lg border border-black/5 dark:border-white/5 shadow-2xl flex flex-col gap-4 animate-in fade-in zoom-in duration-200"
        onClick={(e) => e.stopPropagation()}
      >
        <h2 className="text-xl font-bold text-black dark:text-white border-b border-black/5 dark:border-white/10 pb-3">
          {title}
        </h2>

        <div className="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
          {message ||
            t("confirm_proceed_msg", "Are you sure you want to proceed?")}
        </div>

        <div className="flex gap-3 justify-end mt-2">
          <button
            disabled={isLoading}
            className="cursor-pointer px-5 py-2.5 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors"
            onClick={onClose}
          >
            {cancelText || t("cancel")}
          </button>

          <button
            disabled={isLoading}
            onClick={async () => {
              await onConfirm();
              onClose();
            }}
            className={`
              cursor-pointer px-6 py-2.5 text-sm font-bold rounded-lg text-white transition-all 
              active:scale-95 disabled:opacity-50 disabled:pointer-events-none
              ${variantStyles[variant]}
            `}
          >
            {isLoading
              ? t("processing", "...")
              : confirmText || t("confirm", "Confirm")}
          </button>
        </div>
      </div>
    </div>
  );
};import { useTranslation } from "react-i18next";

const EMPTY_STATES_CONFIG = {
  inbox: {
    titleKey: "empty_states.inbox_title",
    descKey: "empty_states.inbox_desc",
    icon: "icon-price-tag",
  },
  today: {
    titleKey: "empty_states.today_title",
    descKey: "empty_states.today_desc",
    icon: "icon-calendar-_1",
  },
  overdue: {
    titleKey: "empty_states.overdue_title",
    descKey: "empty_states.overdue_desc",
    icon: "icon-history",
  },
  completed: {
    titleKey: "empty_states.completed_title",
    descKey: "empty_states.completed_desc",
    icon: "icon-checkmark",
  },
  default: {
    titleKey: "empty_states.default_title",
    descKey: "empty_states.default_desc",
    icon: "icon-heart-svgrepo-com",
  },
} as const;

export const EmptyState = ({
  mode,
  onOpenForm,
}: {
  mode: string;
  onOpenForm: () => void;
}) => {
  const { t } = useTranslation();

  const config =
    EMPTY_STATES_CONFIG[mode as keyof typeof EMPTY_STATES_CONFIG] ||
    EMPTY_STATES_CONFIG.default;

  return (
    <div className="flex flex-col items-center justify-center py-20 px-4 text-center select-none animate-in fade-in duration-500">
      <div className="bg-black/5 dark:bg-white/5 p-6 rounded-full mb-4">
        <span
          className={`${config.icon} text-[3em] text-[#9d174d] opacity-50`}
        />
      </div>

      <h3 className="text-xl font-semibold text-black/90 dark:text-white/90 mb-1">
        {t(config.titleKey)}
      </h3>

      <p className="text-sm text-black/40 dark:text-white/40 max-w-[200px] leading-relaxed">
        {t(config.descKey)}
      </p>

      {mode !== "completed" && mode !== "overdue" && (
        <button
          onClick={onOpenForm}
          className="flex items-center gap-2 px-4 py-2 rounded-full border border-black/10 dark:border-white/5 mt-3 
                   hover:border-[#9d174d]/50 hover:bg-[#9d174d]/5 transition-all duration-200
                   text-[13px] text-black/40 dark:text-white/40 hover:text-[#9d174d] cursor-pointer"
        >
          <svg
            width="10"
            height="10"
            viewBox="0 0 12 12"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
          >
            <line x1="6" y1="2" x2="6" y2="10" />
            <line x1="2" y1="6" x2="10" y2="6" />
          </svg>
          {t("empty_states.add_first_btn")}
        </button>
      )}
    </div>
  );
};interface QuickBtnProps {
  icon: React.ReactNode;
  label?: string;
  color?: string;
  isActive?: boolean;
  onClick: () => void;
}

export const QuickBtn = ({
  icon,
  label,
  color,
  isActive,
  onClick,
}: QuickBtnProps) => (
  <button
    type="button"
    onClick={onClick}
    className={`
      flex items-center gap-2 p-2 text-left rounded-lg cursor-pointer text-xs transition-all 
      hover:bg-black/5 dark:hover:bg-white/5 
      ${
        isActive
          ? "bg-black/10 dark:bg-white/10 ring-1 ring-black/5 dark:ring-white/10 opacity-100"
          : "bg-transparent opacity-80 hover:opacity-100"
      } 
      ${color}
    `}
  >
    <span className={`${icon} text-[1.8em]`} />
    {label && <span className="font-semibold">{label}</span>}
  </button>
);import { useState, useEffect, useRef, useMemo } from "react";
import type { Placement } from "@floating-ui/react";
import {
  useFloating,
  autoUpdate,
  offset,
  flip,
  shift,
  useInteractions,
  useClick,
  useDismiss,
  useRole,
  size,
  useListNavigation,
  useTypeahead,
  FloatingPortal,
} from "@floating-ui/react";
import { useTranslation } from "react-i18next";

export type Option = {
  value: string | number | null;
  label: string;
  color?: string;
  icon?: string;
};

interface SelectProps {
  symbol?: string;
  value: string | number | null;
  options: Option[];
  onChange: (value: string | number | null) => void;
  placeholder?: string;
  border?: boolean;
  mobile?: boolean;
  position: Placement | undefined;
}

export function Select({
  symbol,
  value,
  options,
  onChange,
  placeholder,
  border,
  mobile = false,
  position,
}: SelectProps) {
  const { t } = useTranslation();
  const [open, setOpen] = useState(false);
  const { refs, floatingStyles, context } = useFloating({
    open,
    onOpenChange: setOpen,
    placement: position,
    whileElementsMounted: autoUpdate,
    middleware: [
      offset(5),
      flip({ fallbackPlacements: ["top-start", "bottom-end"] }),
      shift({ padding: 10 }),
      size({
        apply({ rects, elements }) {
          Object.assign(elements.floating.style, {
            width: `${rects.reference.width}px`,
          });
        },
      }),
    ],
  });
  const [activeIndex, setActiveIndex] = useState<number | null>(null);
  const listItemsRef = useRef<(HTMLLIElement | null)[]>([]);

  const labels = useMemo(() => options.map((o) => o.label), [options]);
  const labelsRef = useRef(labels);

  useEffect(() => {
    labelsRef.current = labels;
  }, [labels]);

  const selectedIndex = options.findIndex((o) => o.value === value);

  const listNav = useListNavigation(context, {
    listRef: listItemsRef,
    activeIndex,
    onNavigate: setActiveIndex,
    selectedIndex: selectedIndex !== -1 ? selectedIndex : null,
    loop: true,
    virtual: true,
  });

  const typeahead = useTypeahead(context, {
    listRef: labelsRef,
    activeIndex,
    onMatch: setActiveIndex,
  });

  const click = useClick(context);
  const dismiss = useDismiss(context, {
    outsidePressEvent: "click",
    outsidePress: (event) => {
      event.stopPropagation();
      event.preventDefault();
      return true;
    },
  });

  const role = useRole(context, { role: "listbox" });

  const { getReferenceProps, getFloatingProps, getItemProps } = useInteractions(
    [click, dismiss, role, listNav, typeahead],
  );

  const handleKeyDown = (event: React.KeyboardEvent) => {
    if (event.key === "Enter" && activeIndex !== null && open) {
      event.preventDefault();
      onChange(options[activeIndex].value);
      setOpen(false);
    }
  };

  useEffect(() => {
    if (open && activeIndex !== null && listItemsRef.current[activeIndex]) {
      listItemsRef.current[activeIndex]?.scrollIntoView({
        block: "nearest",
      });
    }
  }, [activeIndex, open]);

  const current = options.find((o) => o.value === value) || null;

  return (
    <>
      <button
        ref={refs.setReference}
        {...getReferenceProps({
          onKeyDown: handleKeyDown,
          onMouseDown: (e) => e.preventDefault(),
        })}
        type="button"
        className={`
          focus:outline-none relative w-full min-h-[38px]
          flex items-center justify-between gap-2 p-2 pr-7
          rounded cursor-pointer box-border 
          bg-transparent text-gray-700
          hover:bg-black/5 dark:hover:bg-[#333] m-0
          ${
            border !== false
              ? "border-[0.5px] border-black/20 dark:border-[#444] hover:border-gray-400 dark:hover:border-[#555]"
              : "border-none"
          }
          ${open ? "ring-1 ring-[#ff648b]/30 bg-black/5 dark:bg-[#333]" : ""}
        `}
      >
        <div className="flex items-center justify-start gap-2 overflow-hidden">
          {current ? (
            <>
              {current.icon ? (
                <span
                  className={`${current.icon} shrink-0 opacity-70 text-gray-700 dark:text-white`}
                />
              ) : current.color ? (
                <span
                  className={
                    symbol === "dot"
                      ? "w-2.5 h-2.5 rounded-full shrink-0"
                      : `${symbol} shrink-0 text-xs`
                  }
                  style={{
                    [symbol === "dot" ? "backgroundColor" : "color"]:
                      current.color,
                  }}
                />
              ) : null}
            </>
          ) : null}

          {!mobile && (
            <span className="truncate text-gray-700 dark:text-white">
              {current ? t(current.label) : placeholder}
            </span>
          )}
        </div>
        <span
          className={`absolute top-[35%] right-[10px] transition-transform duration-200 text-[10px] text-gray-700 dark:text-white ${
            open ? "rotate-180" : ""
          }`}
        >
          ▼
        </span>
      </button>

      {open && (
        <FloatingPortal>
          <ul
            // eslint-disable-next-line react-hooks/refs
            ref={refs.setFloating}
            style={{
              ...floatingStyles,

              zIndex: 9999,
            }}
            {...getFloatingProps()}
            className="bg-white dark:!bg-[#232323] border border-black/10 dark:border-[#444] rounded-md list-none p-1 z-[999] pointer-events-auto shadow-2xl overflow-y-auto box-border outline-none min-w-[12em] max-h-[15rem]"
          >
            {options.map((o, index) => (
              <li
                key={String(o.value)}
                ref={(el) => {
                  listItemsRef.current[index] = el;
                }}
                {...getItemProps({
                  onClick() {
                    onChange(o.value);
                    setOpen(false);
                  },
                })}
                className={`py-2 px-3 flex items-center gap-2 rounded cursor-pointer text-sm outline-none transition-colors
                  ${
                    activeIndex === index
                      ? "bg-black/5 dark:bg-[#333] text-black dark:text-white"
                      : "text-gray-700 dark:text-white"
                  }
                  hover:bg-black/5 dark:hover:bg-[#333]
                  ${value === o.value ? "!text-[#9d174d] font-bold" : ""}
                `}
              >
                {o.icon ? (
                  <span className={`${o.icon} shrink-0 text-xs opacity-70`} />
                ) : (
                  o.color && (
                    <span
                      className={
                        symbol === "dot"
                          ? "w-2 h-2 rounded-full shrink-0"
                          : `${symbol} shrink-0`
                      }
                      style={{
                        [symbol === "dot" ? "backgroundColor" : "color"]:
                          o.color,
                      }}
                    />
                  )
                )}
                <span className="truncate">{t(o.label)}</span>
              </li>
            ))}
          </ul>
        </FloatingPortal>
      )}
    </>
  );
}import { useState } from "react";
import { useTranslation } from "react-i18next";
import { PRIORITY_OPTIONS } from "@/utils/priorities";
import { useProjectsContext } from "@/context/ProjectsContext";
import { useTasksActions } from "@/context/TasksContext";
import { useIsMobile } from "@/hooks/useIsMobile";
import { Select } from "@/components/Select";
import { Calendar } from "@/components/Calendar/Calendar";
import { ConfirmModal } from "@/components/ConfirmModal";

type SelectorProps = {
  visible: boolean;
  selectedIds: Set<string>;
  total: number;
  toggleSelectAll: () => void;
  onClear: () => void;
  onComplete: () => void;
  onDelete: () => void;
  onUpdateDeadline: (date: Date | null, time: string | null) => void;
  onSetPriority: (priority: number) => void;
};

export const Selector = ({
  visible,
  total,
  selectedIds,
  toggleSelectAll,
  onClear,
  onComplete,
  onDelete,
  onUpdateDeadline,
  onSetPriority,
}: SelectorProps) => {
  const { t } = useTranslation();
  const isMobile = useIsMobile();
  const { selectedProjectId, projects } = useProjectsContext();
  const { updateTask } = useTasksActions();
  const [bulkProjectId, setBulkProjectId] = useState<string | null>(
    selectedProjectId,
  );
  const [bulkDate, setBulkDate] = useState<Date | null>(null);
  const [bulkTime, setBulkTime] = useState<string | null>(null);
  const [bulkPriority, setBulkPriority] = useState(1);
  const [confirmDelete, setConfirmDelete] = useState(false);
  const [confirmDone, setConfirmDone] = useState(false);

  if (!visible) return null;

  return (
    <>
      <div
        className="
          fixed bottom-4 left-1/2 -translate-x-1/2
          z-[999]
          w-[calc(100%-2rem)] max-w-5xl
          rounded-2xl
          bg-[#eee] dark:bg-[#232323] backdrop-blur
          border border-white/10
          shadow-2xl
          px-4 py-3
          flex flex-col gap-3
        "
      >
        <div className="flex items-center justify-between gap-3">
          <div className="flex items-center gap-3 text-sm text-black/80 dark:text-white/80">
            {selectedIds.size > 0 && (
              <span className="font-medium">
                {t("selected_count", { count: selectedIds.size })}
              </span>
            )}

            <button
              onClick={toggleSelectAll}
              className="text-blue-400 hover:text-blue-300 transition cursor-pointer"
            >
              {selectedIds.size === total ? t("deselect_all") : t("select_all")}
            </button>
          </div>

          <button
            onClick={onClear}
            className="text-sm text-black/50 dark:text-white/50 hover:text-white transition cursor-pointer"
          >
            {t("cancel")}
          </button>
        </div>

        {selectedIds.size > 0 && (
          <div className="flex gap-2 items-center gap-2 justify-start">
            <button
              onClick={() => setConfirmDone(true)}
              className="
          h-10 w-10 rounded-xl
          bg-emerald-500/15 text-emerald-400
          hover:bg-emerald-500/25
          transition
        "
            >
              <span className="icon-checkmark" />
            </button>
            <button
              onClick={() => setConfirmDelete(true)}
              className="
          h-10 w-10 rounded-xl
          bg-red-500/15 text-red-400
          hover:bg-red-500/25
          transition
        "
            >
              <span className="icon-bin" />
            </button>
            <div className="h-10 ">
              <Select
                position="top-end"
                symbol="icon-flag"
                mobile={isMobile}
                value={bulkPriority}
                options={PRIORITY_OPTIONS.map((o) => ({
                  ...o,
                  label: t(o.label.toLowerCase()),
                }))}
                onChange={(p) => setBulkPriority(typeof p === "number" ? p : 1)}
              />
            </div>

            <div className="h-10 ">
              <Calendar
                date={bulkDate}
                time={bulkTime}
                setDate={setBulkDate}
                setTime={setBulkTime}
              />
            </div>

            <div className="h-10">
              <Select
                position="bottom-start"
                symbol="icon-heart-svgrepo-com"
                mobile={isMobile}
                value={bulkProjectId}
                placeholder={t("inbox")}
                options={[
                  { value: null, label: t("inbox"), icon: "icon-inbox" },
                  ...projects.map((p) => ({
                    value: p.id,
                    label: p.title,
                    color: p.color,
                  })),
                ]}
                onChange={(val) =>
                  setBulkProjectId(typeof val === "string" ? val : null)
                }
              />
            </div>

            {(bulkDate || bulkTime || bulkPriority) && (
              <button
                onClick={async () => {
                  if (bulkProjectId !== null) {
                    await Promise.all(
                      [...selectedIds].map((id) =>
                        updateTask(id, {
                          projectId: bulkProjectId,
                          sectionId: null,
                        }),
                      ),
                    );
                  }
                  onUpdateDeadline(bulkDate, bulkTime);
                  onSetPriority(bulkPriority);
                  setBulkPriority(1);
                }}
                className="
            h-10 px-4 rounded-xl 
            bg-blue-500 text-white
            hover:bg-blue-400
            text-sm font-medium
            transition
          "
              >
                <span className="icon-checkmark" />
              </button>
            )}
          </div>
        )}
      </div>

      {confirmDelete && (
        <ConfirmModal
          title={t("delete_task_title")}
          confirmText={t("delete_now")}
          message={t("delete_tasks_message")}
          cancelText={t("cancel")}
          onConfirm={() => {
            onDelete();
            setConfirmDelete(false);
          }}
          onClose={() => setConfirmDelete(false)}
        />
      )}

      {confirmDone && (
        <ConfirmModal
          title={t("complete_tasks_title")}
          message={t("complete_tasks_message")}
          confirmText={t("confirm")}
          cancelText={t("cancel")}
          onConfirm={() => {
            onComplete();
            setConfirmDone(false);
          }}
          onClose={() => setConfirmDone(false)}
        />
      )}
    </>
  );
};import { createContext, useMemo } from "react";
import type { User } from "@/types/user";
import { useAuth } from "@/hooks/useAuth";

type AuthState = {
  user: User | null;
  loading: boolean;
  isAuthenticated: boolean;
};

type AuthActions = {
  loginUser: ReturnType<typeof useAuth>["loginUser"];
  logoutUser: ReturnType<typeof useAuth>["logoutUser"];
  registerUser: ReturnType<typeof useAuth>["registerUser"];
  deleteUser: ReturnType<typeof useAuth>["deleteUser"];
  updateUserInfo: ReturnType<typeof useAuth>["updateUserInfo"];
  getMe: ReturnType<typeof useAuth>["getMe"];
};

export const AuthStateContext = createContext<AuthState | null>(null);
export const AuthActionsContext = createContext<AuthActions | null>(null);

interface AuthProviderProps {
  children: React.ReactNode;
}

export function AuthProvider({ children }: AuthProviderProps) {
  const {
    user,
    loading,
    isAuthenticated,
    loginUser,
    logoutUser,
    registerUser,
    deleteUser,
    updateUserInfo,
    getMe,
  } = useAuth();

  const actions = useMemo(
    () => ({
      loginUser,
      logoutUser,
      registerUser,
      deleteUser,
      updateUserInfo,
      getMe,
    }),
    [loginUser, logoutUser, registerUser, deleteUser, updateUserInfo, getMe],
  );

  const state = useMemo(
    () => ({ user, loading, isAuthenticated }),
    [user, loading, isAuthenticated],
  );

  return (
    <AuthStateContext.Provider value={state}>
      <AuthActionsContext.Provider value={actions}>
        {children}
      </AuthActionsContext.Provider>
    </AuthStateContext.Provider>
  );
}мimport { useContext } from "react";
import { AuthStateContext, AuthActionsContext } from "@/context/AuthContext";

export const useAuthState = () => {
  const context = useContext(AuthStateContext);
  if (!context)
    throw new Error("useAuthState must be used within AuthProvider");
  return context;
};

export const useAuthActions = () => {
  const context = useContext(AuthActionsContext);
  if (!context)
    throw new Error("useAuthActions must be used within AuthProvider");
  return context;
};import { createContext, useContext, useEffect, useState } from "react";
import type { ReactNode } from "react";
import { useProjects } from "@/hooks/useProjects";

export type TaskMode =
  | "project"
  | "inbox"
  | "today"
  | "completed"
  | "overdue"
  | "projects";

type ProjectsContextType = ReturnType<typeof useProjects> & {
  selectedProjectId: string | null;
  selectedProject: string | null;
  mode: TaskMode;
  setMode: (mode: TaskMode) => void;
  showAll: boolean;
  setShowAll: (val: boolean) => void;
  changeMode: (newMode: TaskMode, projectId?: string | null) => void;
};

const ProjectsContext = createContext<ProjectsContextType | null>(null);

export function ProjectsProvider({ children }: { children: ReactNode }) {
  const projectsData = useProjects();

  const [mode, setMode] = useState<TaskMode>(() => {
    const v = localStorage.getItem("mode") as TaskMode | null;
    return v ?? "inbox";
  });

  const [selectedProjectId, setSelectedProjectId] = useState<string | null>(
    () => {
      const val = localStorage.getItem("selectedProjectId");
      return val === "null" ? null : val;
    },
  );
  const selectedProject =
    projectsData.projects.find((p) => p.id === selectedProjectId)?.title ||
    null;
  const [showAll, setShowAll] = useState<boolean>(() => {
    return localStorage.getItem("showAll") === "true";
  });
  const changeMode = (newMode: TaskMode, projectId: string | null = null) => {
    setMode(newMode);
    setSelectedProjectId(projectId);
  };

  useEffect(() => {
    localStorage.setItem("selectedProjectId", selectedProjectId ?? "null");
  }, [selectedProjectId]);

  useEffect(() => {
    localStorage.setItem("showAll", String(showAll));
  }, [showAll]);
  useEffect(() => {
    localStorage.setItem("mode", mode);
  }, [mode]);

  return (
    <ProjectsContext.Provider
      value={{
        ...projectsData,
        selectedProjectId,
        selectedProject,
        mode,
        setMode,
        showAll,
        setShowAll,
        changeMode,
      }}
    >
      {children}
    </ProjectsContext.Provider>
  );
}

export const useProjectsContext = () => {
  const context = useContext(ProjectsContext);
  if (!context)
    throw new Error("useProjectsContext must be used within ProjectsProvider");
  return context;
};import { createContext, useContext, useMemo } from "react";
import { useTasks } from "@/hooks/useTasks";
import { useAuth } from "@/hooks/useAuth";

type UseTasksReturn = ReturnType<typeof useTasks>;
interface TasksState {
  tasks: UseTasksReturn["tasks"];
  loading: UseTasksReturn["loading"];
}
interface TasksProviderProps {
  children: React.ReactNode;
  mode?: string;
  selectedProjectId?: string | null;
}
interface TasksActions {
  createTask: UseTasksReturn["createTask"];
  deleteTask: UseTasksReturn["deleteTask"];
  updateTask: UseTasksReturn["updateTask"];
  updateDone: UseTasksReturn["updateDone"];
}
const TasksStateContext = createContext<TasksState | null>(null);
const TasksActionsContext = createContext<TasksActions | null>(null);

export const useTasksState = () => {
  const context = useContext(TasksStateContext);
  if (!context)
    throw new Error("useTasksState must be used within TasksProvider");
  return context;
};

export const useTasksActions = () => {
  const context = useContext(TasksActionsContext);
  if (!context)
    throw new Error("useTasksActions must be used within TasksProvider");
  return context;
};

export function TasksProvider({ children }: TasksProviderProps) {
  const { user } = useAuth();
  const { tasks, loading, createTask, deleteTask, updateTask, updateDone } =
    useTasks(user?.id || "");

  const actions = useMemo(
    () => ({
      createTask,
      deleteTask,
      updateTask,
      updateDone,
    }),
    [createTask, deleteTask, updateTask, updateDone],
  );

  const state = useMemo(() => ({ tasks, loading }), [tasks, loading]);

  return (
    <TasksStateContext.Provider value={state}>
      <TasksActionsContext.Provider value={actions}>
        {children}
      </TasksActionsContext.Provider>
    </TasksStateContext.Provider>
  );
}import { Drawer } from "vaul";
import { VisuallyHidden } from "@radix-ui/react-visually-hidden";

export function MobileDrawer({
  open,
  onClose,
  children,
  drawerTitle,

  drawerDescription,
}: {
  open: boolean;
  onClose: () => void;
  children: React.ReactNode;
  drawerTitle: string;
  drawerDescription: string;
}) {
  return (
    <Drawer.Root open={open} onOpenChange={onClose} shouldScaleBackground>
      <Drawer.Portal>
        <Drawer.Overlay className="fixed inset-0 bg-black/60 z-[998]" />

        <Drawer.Content
          data-drawer-content
          className="
            fixed inset-x-0 bottom-0 z-[999]
            bg-white dark:bg-[#1f1f1f]
            rounded-t-[32px]
            max-h-[90dvh]
            flex flex-col
            focus:outline-none
          "
        >
          <VisuallyHidden>
            <Drawer.Title>{drawerTitle}</Drawer.Title>
            <Drawer.Description>{drawerDescription}</Drawer.Description>
          </VisuallyHidden>

          <Drawer.Handle className="mx-auto my-3 h-1.5 w-14 rounded-full bg-black/20 dark:bg-white/20" />

          <div className="flex-1 overflow-y-auto px-6 pb-12 overscroll-contain">
            {children}
          </div>
        </Drawer.Content>
      </Drawer.Portal>
    </Drawer.Root>
  );
}import { useEffect, useMemo } from "react";
import { createPortal } from "react-dom";
export const ModalPortal = ({ children }: { children: React.ReactNode }) => {
  const el = useMemo(() => document.createElement("div"), []);

  useEffect(() => {
    document.body.appendChild(el);

    return () => {
      if (document.body.contains(el)) {
        document.body.removeChild(el);
      }
    };
  }, [el]);

  return createPortal(children, el);
};import { useEffect, useState } from "react";
import type { User } from "@/types/user";
import { authApi } from "@/api/auth";

type UpdateMeDto = {
  userName?: string;
  email?: string;
};

export function useAuth() {
  const [loading, setLoading] = useState(true);
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    const initAuth = async () => {
      try {
        const userData = await authApi.getMe();
        setUser(userData);
      } catch {
        setUser(null);
      } finally {
        setLoading(false);
      }
    };

    initAuth();
  }, []);

  const login = async (data: { email: string; password: string }) => {
    const { user } = await authApi.login(data);
    setUser(user);
  };

  const register = async (data: {
    userName: string;
    email: string;
    password: string;
  }) => {
    const { user } = await authApi.register(data);
    setUser(user);
  };

  const logout = async () => {
    await authApi.logout();
    setUser(null);
  };

  const remove = async () => {
    await authApi.deleteMe();
    await logout();
  };

  const update = async (data: UpdateMeDto) => {
    const oldUser = user;

    if (user) setUser({ ...user, ...data });

    try {
      const updatedUser = await authApi.updateMe(data);
      setUser(updatedUser);
    } catch (err) {
      setUser(oldUser);
      throw err;
    }
  };

  const getMe = async () => {
    try {
      const userData = await authApi.getMe();
      setUser(userData);
      return userData;
    } catch (err) {
      console.error("Fetch user failed", err);
      throw err;
    }
  };

  return {
    user,
    loading,
    registerUser: register,
    loginUser: login,
    deleteUser: remove,
    updateUserInfo: update,
    logoutUser: logout,
    getMe: getMe,
    isAuthenticated: !!user,
  };
}import { useMemo } from "react";
import { isToday } from "date-fns";
import type { Task } from "@/types/tasks";
import { useTasksState } from "@/context/TasksContext";
import { useProjectsContext } from "@/context/ProjectsContext";

export function useFilteredTasks() {
  const { tasks, loading } = useTasksState();
  const { mode, selectedProjectId, showAll } = useProjectsContext();

  const filteredTasks = useMemo(() => {
    if (!tasks) return null;

    const now = new Date();
    if (mode === "projects") return [];

    const checkDeadline = (task: Task) => {
      if (!task.deadline) return false;
      const d = new Date(task.deadline);

      if (task.reminderAt) {
        const [h, m] = task.reminderAt.split(":").map(Number);
        d.setHours(h, m, 0, 0);
      } else {
        d.setHours(23, 59, 59, 999);
      }

      if (mode === "today") return isToday(new Date(task.deadline));
      if (mode === "overdue") return d < now && !task.isDone;
      return false;
    };

    const matchesPage = (t: Task) => {
      if (mode === "inbox") return !t.projectId;
      if (mode === "project") return t.projectId === selectedProjectId;
      return true;
    };

    if (mode === "today" || mode === "overdue" || mode === "completed") {
      type FlatTask = Task & {
        isFlat: boolean;
        isStandaloneSubtask: boolean;
        parentName: string | null;
      };
      const allItems: FlatTask[] = [];

      const processTask = (task: Task, parentName?: string) => {
        let isMatch = false;

        if (mode === "completed") {
          isMatch = task.isDone;
        } else {
          isMatch = checkDeadline(task) && (showAll || !task.isDone);
        }

        if (isMatch) {
          allItems.push({
            ...task,
            subtasks: [],
            isFlat: true,
            isStandaloneSubtask: !!parentName,
            parentName: parentName || null,
          });
        }
      };

      tasks.forEach((parent: Task) => {
        processTask(parent);
        parent.subtasks?.forEach((sub: Task) => processTask(sub, parent.title));
      });

      return allItems.sort(
        (a: Task, b: Task) => Number(a.isDone) - Number(b.isDone),
      );
    }

    const filtered = tasks.filter((t: Task) => {
      if (!matchesPage(t)) return false;
      return showAll ? true : !t.isDone;
    });

    return filtered.sort(
      (a: Task, b: Task) => Number(a.isDone) - Number(b.isDone),
    );
  }, [tasks, mode, selectedProjectId, loading, showAll]);
  // const ready =
  //   !loading && (tasks.length > 0 ? filteredTasks.length > 0 : true);

  return { tasks: filteredTasks, ready: tasks !== null };
}import { useEffect, useState } from "react";

export function useIsMobile(breakpoint = 768) {
  const [isMobile, setIsMobile] = useState(
    typeof window !== "undefined" ? window.innerWidth < breakpoint : false,
  );

  useEffect(() => {
    const onResize = () => {
      setIsMobile(window.innerWidth < breakpoint);
    };

    window.addEventListener("resize", onResize);
    return () => window.removeEventListener("resize", onResize);
  }, [breakpoint]);

  return isMobile;
}import { useState, useCallback } from "react";

export function useMenuComponent() {
  const [open, setOpen] = useState(false);

  const openMenu = useCallback(() => setOpen(true), []);

  const closeMenu = useCallback(() => setOpen(false), []);

  const toggleMenu = useCallback(() => setOpen((prev) => !prev), []);

  return {
    open,
    setOpen,
    openMenu,
    closeMenu,
    toggleMenu,
  };
}import { useEffect, useState } from "react";
import type { Project } from "@/types/project";
import { projectsApi } from "@/api/projects";

export function useProjects() {
  const [projects, setProjects] = useState<Project[]>([]);

  useEffect(() => {
    projectsApi.fetchProjects().then(setProjects).catch(console.error);
  }, []);

  const create = async (title: string, color: string, favorites: boolean) => {
    const temp: Project = {
      id: "temp-" + Date.now(),
      title,
      color,
      favorites,
      order: projects.length + 1,
    };

    setProjects((p) => [...p, temp]);

    try {
      const real = await projectsApi.createProject({ title, color, favorites });
      setProjects((p) => p.map((x) => (x.id === temp.id ? real : x)));
      return real;
    } catch {
      setProjects((p) => p.filter((x) => x.id !== temp.id));
      throw new Error("Failed to create");
    }
  };

  const remove = async (id: string) => {
    const snapshot = projects;
    setProjects((p) => p.filter((x) => x.id !== id));

    try {
      await projectsApi.deleteProject(id);
    } catch {
      setProjects(snapshot);
    }
  };

  const toggleFavorite = async (id: string, favorites: boolean) => {
    const snapshot = projects;
    setProjects((p) => p.map((x) => (x.id === id ? { ...x, favorites } : x)));

    try {
      await projectsApi.updateProject(id, { favorites });
    } catch {
      setProjects(snapshot);
    }
  };

  const update = async (id: string, data: Partial<Project>) => {
    const snapshot = projects;
    setProjects((p) => p.map((x) => (x.id === id ? { ...x, ...data } : x)));

    try {
      await projectsApi.updateProject(id, data);
    } catch {
      setProjects(snapshot);
    }
  };

  return {
    projects,

    createProject: create,
    deleteProject: remove,
    updateProject: update,
    toggleFavorite,
  };
}import { useState } from "react";
import type { Section } from "@/types/section";
import { sectionApi } from "@/api/section";

export function useSections(initialSections: Section[] = []) {
  const [sections, setSections] = useState<Section[]>(initialSections);

  const createSection = async (title: string, projectId: string) => {
    const tempId = `temp-${Date.now()}`;
    const tempSection: Section = {
      id: tempId,
      title: title.trim(),
      order: sections.length,
      projectId,
    };

    setSections((prev) => [...prev, tempSection]);

    try {
      const real = await sectionApi.createSection({
        title,
        projectId,
        order: tempSection.order,
      });

      setSections((prev) => prev.map((s) => (s.id === tempId ? real : s)));
    } catch (error) {
      setSections((prev) => prev.filter((s) => s.id !== tempId));
      console.error("Failed to create section:", error);
    }
  };

  const updateSection = async (id: string, data: Partial<Section>) => {
    const snapshot = sections;
    setSections((prev) =>
      prev.map((s) => (s.id === id ? { ...s, ...data } : s)),
    );

    try {
      await sectionApi.updateSection(id, data);
    } catch (error) {
      setSections(snapshot);
      console.error("Failed to update section:", error);
    }
  };

  const deleteSection = async (id: string) => {
    const snapshot = sections;
    setSections((prev) => prev.filter((s) => s.id !== id));

    try {
      await sectionApi.deleteSection(id);
    } catch (error) {
      setSections(snapshot);
      console.error("Failed to delete section:", error);
    }
  };

  return {
    sections,
    setSections,
    createSection,
    updateSection,
    deleteSection,
  };
}import { useEffect, useState } from "react";
import type { Task } from "@/types/tasks";
import { tasksApi } from "@/api/tasks";

const sortTasks = (list: Task[]): Task[] => {
  return [...list]
    .sort((a, b) => {
      if (a.isDone && b.isDone) {
        return (
          new Date(b.completedAt!).getTime() -
          new Date(a.completedAt!).getTime()
        );
      }
      if (a.isDone !== b.isDone) return a.isDone ? 1 : -1;
      return (a.order ?? 0) - (b.order ?? 0);
    })
    .map((node) => ({
      ...node,
      subtasks: node.subtasks ? sortTasks(node.subtasks) : [],
    }));
};

const updateNode = (
  list: Task[],
  id: string,
  patch: Partial<Task> | null,
): Task[] => {
  return list
    .filter((node) => (patch === null ? node.id !== id : true))
    .map((node) => {
      if (node.id === id) return { ...node, ...patch };
      if (node.subtasks?.length) {
        return { ...node, subtasks: updateNode(node.subtasks, id, patch) };
      }
      return node;
    });
};

const addSubtaskNode = (
  list: Task[],
  parentId: string,
  newNode: Task,
): Task[] => {
  return list.map((node) => {
    if (node.id === parentId) {
      return { ...node, subtasks: [...(node.subtasks || []), newNode] };
    }
    if (node.subtasks?.length) {
      return {
        ...node,
        subtasks: addSubtaskNode(node.subtasks, parentId, newNode),
      };
    }
    return node;
  });
};

export function useTasks(userId: string) {
  const [tasks, setTasks] = useState<Task[] | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!userId) return;

    setLoading(true);

    tasksApi.fetchTasks({ userId }).then((data) => {
      setTasks(sortTasks(data));
      setLoading(false);
    });
  }, [userId]);

  const create = async (data: Partial<Task> & { parentId?: string | null }) => {
    const tempId = `temp-${Date.now()}`;

    const tempNode: Task = {
      id: tempId,
      title: data.title || "",
      isDone: false,

      order: (tasks?.length || 0) + 1,
      subtasks: [],
      completedAt: null,
      priority: data.priority ?? 1,
      projectId: data.projectId ?? null,
      sectionId: data.sectionId ?? null,
      parentId: data.parentId ?? null,
      deadline: data.deadline ?? null,
      reminderAt: data.reminderAt ?? null,
      comment: data.comment ?? null,
    };

    setTasks((prev) => {
      const newList = data.parentId
        ? addSubtaskNode(prev || [], data.parentId, tempNode)
        : [...(prev || []), tempNode];
      return sortTasks(newList);
    });

    try {
      const { order, ...restData } = data;
      const real = await tasksApi.createTask({
        ...restData,
      });

      setTasks((prev) => sortTasks(updateNode(prev || [], tempId, real)));
    } catch {
      setTasks((prev) => updateNode(prev || [], tempId, null));
    }
  };

  const update = async (id: string, data: Partial<Task>) => {
    const snapshot = tasks;
    setTasks((prev) => updateNode(prev || [], id, data));

    try {
      await tasksApi.updateInfo(id, data);
    } catch {
      setTasks(snapshot);
    }
  };

  const updateDone = async (id: string, isDone: boolean) => {
    const snapshot = tasks;
    const patch: Partial<Task> = {
      isDone,
      completedAt: isDone ? new Date() : null,
    };

    setTasks((prev) => sortTasks(updateNode(prev || [], id, patch)));

    try {
      await tasksApi.updateStatus(id, isDone);
    } catch {
      setTasks(snapshot);
    }
  };
  const remove = async (id: string) => {
    const snapshot = tasks;

    setTasks((prev) => updateNode(prev || [], id, null));

    try {
      await tasksApi.deleteTask(id);
    } catch {
      setTasks(snapshot);
    }
  };

  return {
    tasks,
    loading,
    createTask: create,
    updateTask: update,
    updateDone,
    deleteTask: remove,
  };
}import { useMemo, useState } from "react";
import type { Task } from "@/types/tasks";
import { useTasksActions } from "@/context/TasksContext";

export function useTaskSelection(
  filteredTasks: Task[],
  onSelectionStart?: () => void,
) {
  const { updateTask, deleteTask } = useTasksActions();
  const [selectionMode, setSelectionMode] = useState(false);
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());

  const currentIds = useMemo(() => {
    const set = new Set<string>();
    filteredTasks.forEach((t: Task) => {
      set.add(t.id);
      t.subtasks?.forEach((s: Task) => set.add(s.id));
    });
    return set;
  }, [filteredTasks]);

  const total = useMemo(() => {
    return filteredTasks.reduce(
      (acc: number, t: Task) => acc + 1 + (t.subtasks?.length || 0),
      0,
    );
  }, [filteredTasks]);

  const startSelection = () => {
    setSelectionMode(true);
    onSelectionStart?.();
  };

  const toggleSelect = (id: string) => {
    setSelectedIds((prev) => {
      const next = new Set(prev);
      if (next.has(id)) {
        next.delete(id);
      } else {
        next.add(id);
      }
      return next;
    });
  };

  const toggleSelectAll = () => {
    setSelectedIds((prev) => {
      const isAllSelected = prev.size === currentIds.size;
      return isAllSelected ? new Set() : currentIds;
    });
  };

  const clearSelection = () => {
    setSelectedIds(new Set());
    setSelectionMode(false);
  };

  const buildDeadline = (date: Date, time?: string | null) => {
    const d = new Date(date);

    if (time) {
      const [h, m] = time.split(":").map(Number);
      d.setHours(h, m, 0, 0);
    } else {
      d.setHours(23, 59, 59, 999);
    }

    return d;
  };

  const bulkComplete = async (ids: string[]) => {
    await Promise.all(ids.map((id) => updateTask(id, { isDone: true })));
    clearSelection();
  };

  const bulkUpdateDeadline = async (
    ids: string[],
    newDate: Date | null,
    newTime: string | null,
  ) => {
    const deadline = newDate ? buildDeadline(newDate, newTime) : null;
    const reminderAt = newDate ? newTime : null;

    await Promise.all(
      ids.map((id) =>
        updateTask(id, {
          deadline,
          reminderAt,
        }),
      ),
    );

    clearSelection();
  };

  const bulkDelete = async (ids: string[]) => {
    await Promise.all(ids.map((id) => deleteTask(id)));
    clearSelection();
  };

  const openPrioritySheet = async (ids: string[], priority: number) => {
    await Promise.all(ids.map((id) => updateTask(id, { priority })));
    clearSelection();
  };

  return {
    selectionMode,
    startSelection,
    selectedIds,
    total,
    toggleSelect,
    toggleSelectAll,
    clearSelection,
    bulkComplete,
    bulkUpdateDeadline,
    bulkDelete,
    openPrioritySheet,
  };
}import type { Section } from "./section";
export interface Project {
  id: string;
  title: string;
  color: string;
  order: number;
  favorites: boolean;
  sections?: Section[];
}export interface Section {
  id: string;
  title: string;
  order: number;
  projectId?: string | null;
}export interface Task {
  id: string;
  title: string;
  isDone: boolean;
  order: number;
  priority: number;

  parentId?: string | null;
  comment: string | null;
  deadline: Date | null;
  reminderAt?: string | null;
  projectId?: string | null;
  completedAt: Date | null;
  subtasks?: Task[];
  sectionId?: string | null;
  _count?: { tasks: number };
}export interface UpdateUserInfoProps {
  anchorRef: React.RefObject<HTMLButtonElement | null>;
  isOpen: boolean;
  onClose: () => void;
}export interface User {
  id: string;
  email: string;
  userName?: string;
  createdAt: string;
  _count: { tasks: number; projects: number };
}export interface UserInfoBaseProps {
  anchorRef: React.RefObject<HTMLButtonElement | null>;
  setOpenConfirm: (value: boolean) => void;
  setOpenConfirmDelete: (value: boolean) => void;
  setOpenForm: (value: boolean) => void;
  projectsCount: number;
  undoneTasksCount: number;
  timeAgo: string;
  formattedDate: string;
  handleThemeChange: (theme: string | number | null) => void;
  currentTheme: string;
  handleLangChange: (lang: string | number | null) => void;
}

export interface UserInfoProps extends UserInfoBaseProps {
  onClose: () => void;
  isOpen: boolean;
  isSubModalOpen: boolean;
}import { addDays, differenceInCalendarDays, isWeekend } from "date-fns";
import { nextSaturday, format } from "date-fns";
import type { Locale } from "date-fns";

export const formatDateLabel = (
  dateInput: Date | null,
  locale: Pick<Locale, "options" | "localize" | "formatLong">,
): string => {
  if (!dateInput) return "";

  const date = dateInput instanceof Date ? dateInput : new Date(dateInput);
  const now = new Date();
  const diff = differenceInCalendarDays(date, now);

  if (diff === 0) return "today";
  if (diff === 1) return "tomorrow";
  if (diff === -1) return "yesterday";

  if (diff > 1 && diff <= 7) {
    return format(date, "EEEE", { locale });
  }

  return format(date, "d MMMM", { locale });
};

export type DateMeta = {
  color: string;
  icon: string;
};

type SpecialLabel =
  | "today"
  | "tomorrow"
  | "yesterday"
  | "weekend"
  | "next_week";

export const SPECIAL_COLORS: Record<SpecialLabel, DateMeta> = {
  today: {
    color: "rgb(0, 200, 83)",
    icon: "icon-calendar-_2",
  },
  tomorrow: {
    color: "rgb(255, 171, 0)",
    icon: "icon-calendar-_5",
  },
  yesterday: {
    color: "rgb(229, 57, 53)",
    icon: "icon-yesterday",
  },
  weekend: {
    color: "#3b82f6",
    icon: "icon-calendar-_4",
  },

  next_week: {
    color: "rgba(148, 86, 255, 1)",
    icon: "icon-calendar-_3",
  },
};

const DEFAULT_META: DateMeta = {
  color: "#ffffffd9",
  icon: "icon-calendar-_1",
};

export const dateColor = (deadline: Date | null): DateMeta => {
  if (!deadline) return DEFAULT_META;

  const now = new Date();
  const diff = differenceInCalendarDays(deadline, now);

  if (diff === 0) return SPECIAL_COLORS.today;
  if (diff === 1) return SPECIAL_COLORS.tomorrow;
  if (diff === -1) return SPECIAL_COLORS.yesterday;
  if (diff >= 0 && diff <= 8 && isWeekend(deadline)) {
    return SPECIAL_COLORS.weekend;
  }
  if (diff < 0) return SPECIAL_COLORS.yesterday;

  if (diff > 1 && diff <= 7) {
    return SPECIAL_COLORS.next_week;
  }

  return DEFAULT_META;
};

export const formatFullDate = (date: Date | null, locale: Locale) => {
  if (!date) return { label: "", time: "" };
  const diff = differenceInCalendarDays(date, new Date());

  if (diff === 0) return { label: "today", time: format(date, "HH:mm") };
  if (diff === 1) return { label: "tomorrow", time: format(date, "HH:mm") };
  if (diff === -1) return { label: "yesterday", time: format(date, "HH:mm") };

  return {
    label: format(date, "dd MMMM", { locale }),
    time: format(date, "HH:mm"),
  };
};

export const generateDatePresets = () => {
  const now = new Date();
  const nextWeekDate = addDays(now, 7);

  return {
    today: now,
    tomorrow: addDays(now, 1),
    weekend: nextSaturday(now),
    nextWeek: nextWeekDate,
  };
};export const PRIORITY_OPTIONS = [
  {
    value: 4,
    label: "High",
    color: "rgb(229, 57, 53)",
    bg: "rgba(229, 56, 53, 0.1)",
  },
  {
    value: 3,
    label: "Medium",
    color: "rgb(255, 171, 0)",
    bg: "rgba(255, 170, 0, 0.1)",
  },
  {
    value: 2,
    label: "Low",
    color: "rgb(44, 53, 183)",
    bg: "rgba(44, 53, 183, 0.1)",
  },
  {
    value: 1,
    label: "Default",
    color: "#8c8c8c",
    bg: "transparent",
  },
];type ColorOption = { value: string; label: string };
export const OPTIONS: ColorOption[] = [
  { label: "Grey", value: "#8c8c8c" },
  { label: "Pink", value: "#ff69b4" },
  { label: "Red", value: "#ff4d4f" },
  { label: "Orange", value: "#fa8c16" },
  { label: "Yellow", value: "#fadb14" },
  { label: "Green", value: "#52c41a" },
  { label: "Teal", value: "#13c2c2" },
  { label: "Blue", value: "#1677ff" },
  { label: "Purple", value: "#722ed1" },
  { label: "Magenta", value: "#eb2f96" },
];export const generateTimeOptions = (step: number) => {
  const options = Array.from({ length: (24 * 60) / step }, (_, i) => {
    const totalMinutes = i * step;
    const h = Math.floor(totalMinutes / 60)
      .toString()
      .padStart(2, "0");
    const m = (totalMinutes % 60).toString().padStart(2, "0");
    return { value: `${h}:${m}`, label: `${h}:${m}`, icon: "icon-clock" };
  });

  const now = new Date();
  let hours = now.getHours();
  let minutes = Math.ceil(now.getMinutes() / step) * step;
  if (minutes === 60) {
    hours = (hours + 1) % 24;
    minutes = 0;
  }

  const currentTime = `${hours.toString().padStart(2, "0")}:${minutes
    .toString()
    .padStart(2, "0")}`;
  const idx = options.findIndex((o) => o.value === currentTime);

  if (idx === -1) return options;
  return [...options.slice(idx), ...options.slice(0, idx)];
};export const LANG_OPTIONS = [
  { value: "en", label: "English", icon: "icon-language" },
  { value: "uk", label: "Українська", icon: "icon-language" },
  { value: "ru", label: "Русский", icon: "icon-language" },
  { value: "es", label: "Español", icon: "icon-language" },
  { value: "de", label: "Deutsch", icon: "icon-language" },
  { value: "pl", label: "Polski", icon: "icon-language" },
  { value: "fr", label: "Français", icon: "icon-language" },
];
export const FILTER_OPTIONS = [
  {
    icon: "icon-list",
    value: "all",
    label: "show_all_tasks",
    color: "#4270d1",
  },
  {
    icon: "icon-list2",
    value: "active",
    label: "show_active_tasks",
    color: "#9d174d",
  },
];
export const applyTheme = (theme: string) => {
  const root = window.document.documentElement;

  const isDark =
    theme === "dark" ||
    (theme === "system" &&
      window.matchMedia("(prefers-color-scheme: dark)").matches);

  if (isDark) {
    root.classList.add("dark");
  } else {
    root.classList.remove("dark");
  }

  localStorage.setItem("theme", theme);
};

export const THEME_OPTIONS = [
  {
    value: "light",
    label: "theme_light",
    icon: "icon-sun",
    color: "#ffab00",
  },
  {
    value: "dark",
    label: "theme_dark",
    icon: "icon-night",
    color: "#4270d1",
  },
  {
    value: "system",
    label: "theme_system",
    icon: "icon-cog",
    color: "#9e9e9e",
  },
];import {
  BrowserRouter,
  Routes,
  Route,
  Navigate,
  useLocation,
} from "react-router-dom";
import { useEffect } from "react";
import { useTranslation } from "react-i18next";
import { applyTheme } from "@/utils/userSettings";
import { useAuthState } from "@/context/AuthProvider";
import { AuthProvider } from "@/context/AuthContext";
import { ProjectsProvider } from "@/context/ProjectsContext";
import { TasksProvider } from "@/context/TasksContext";
import { useProjectsContext } from "./context/ProjectsContext";
import { AppLayout } from "@/components/AppLayout";
import { TaskList } from "@/components/Tasks/TaskList";
import { AuthPage } from "@/components/AuthPage";
import { ProjectPage } from "@/components/Projects/ProjectPage";

function TasksWrapper({ children }: { children: React.ReactNode }) {
  const { mode, selectedProjectId } = useProjectsContext();
  return (
    <TasksProvider
      mode={mode}
      selectedProjectId={selectedProjectId}
      key={`${mode}-${selectedProjectId}`}
    >
      {children}
    </TasksProvider>
  );
}
export function MainContent() {
  const { mode } = useProjectsContext();

  if (mode === "projects") {
    return <ProjectPage />;
  }

  return <TaskList />;
}

function ProtectedApp() {
  return (
    <ProjectsProvider>
      <TasksWrapper>
        <AppLayout>
          <MainContent />
        </AppLayout>
      </TasksWrapper>
    </ProjectsProvider>
  );
}

function AppContent() {
  const { t } = useTranslation();
  const { isAuthenticated, loading } = useAuthState();
  const location = useLocation();
  useEffect(() => {
    const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");

    const handleChange = () => {
      const savedTheme = localStorage.getItem("theme") || "system";
      if (savedTheme === "system") {
        applyTheme("system");
      }
    };

    mediaQuery.addEventListener("change", handleChange);
    return () => mediaQuery.removeEventListener("change", handleChange);
  }, []);
  if (loading)
    return (
      <div className="h-screen w-full flex items-center justify-center bg-[#111] text-white">
        {t("loading")}...
      </div>
    );

  return (
    <Routes>
      <Route
        path="/login"
        element={
          isAuthenticated ? (
            <Navigate to={location.state?.from?.pathname || "/"} replace />
          ) : (
            <AuthPage isLoginMode={true} />
          )
        }
      />

      <Route
        path="/register"
        element={
          isAuthenticated ? (
            <Navigate to="/" replace />
          ) : (
            <AuthPage isLoginMode={false} />
          )
        }
      />

      <Route
        path="/*"
        element={
          isAuthenticated ? (
            <ProtectedApp />
          ) : (
            <Navigate to="/login" state={{ from: location }} replace />
          )
        }
      />
    </Routes>
  );
}

export default function App() {
  return (
    <BrowserRouter>
      <AuthProvider>
        <AppContent />
      </AuthProvider>
    </BrowserRouter>
  );
}@import "tailwindcss";
@import "../public/fonts/style.css";

@theme {
  --font-sans: system-ui, Avenir, Helvetica, Arial, sans-serif;
}

@variant dark (&:where(.dark, .dark *));

:root {
  --bg-dark: #1f1f1f;
}

html {
  background-color: var(--bg-dark);
}
html,
body {
  height: 100%;
  overflow-x: hidden;
}
main {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}
body {
  margin: 0;
  padding: 0;
  width: 100%;
  background-color: var(--bg-dark);
  color: white;
  font-family: var(--font-sans);
  font-display: swap;
  -webkit-text-size-adjust: 100%;
  overscroll-behavior: none;
}

#root {
  min-height: 100%;
  display: flex;
  flex-direction: column;
  background-color: var(--bg-dark);
}

.container {
  margin: 0 auto;
  width: 100%;
  max-width: 850px;
  padding: 0 16px;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

form {
  width: 100%;
  max-width: 100%;
}

main {
  width: 100%;
  overflow-x: hidden;
}

.fade-in {
  animation: fadeIn 0.2s ease-in-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tip {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: transparent;
  padding: 0.3em;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.25s ease;
}

.tip:hover {
  background-color: #82828241;
}

@media screen and (max-width: 768px) {
  input,
  textarea,
  select {
    font-size: 16px;
  }
}import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "@/index.css";
import "@/i18n";
import App from "@/App.tsx";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <App />
  </StrictMode>,
);<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png+xml" href="/favicon.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=0, viewport-fit=cover"
    />

    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <meta property="og:title" content="Task Manager" />
    <meta
      property="og:description"
      content="Task and project tracking made simple."
    />

    <meta
      property="og:image"
      content="https://task-managerr.pp.ua/og-preview.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:url" content="https://task-managerr.pp.ua/" />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />

    <title>Task Manager</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>
  </body>
</html>import { PrismaClient } from "@prisma/client";

export const prisma = new PrismaClient();import { Router } from "express";
import {
  getTasks,
  createTask,
  updateTask,
  deleteTask,
  moveTask,
} from "../controllers/task.controller";

import { authMiddleware } from "../middleware/auth";
const router = Router();

router.use(authMiddleware);

router.get("/", getTasks);
router.post("/", createTask);
router.patch("/:id", updateTask);
router.delete("/:id", deleteTask);
router.patch("/:id/move", moveTask);

export default router;import { app } from "./app";

const PORT = process.env.PORT || 3001;

app.listen(PORT, () => {
  console.log(`🚀 Server is flying on http://localhost:${PORT}`);
});import express from "express";
import cors from "cors";
import authRoutes from "./routes/auth.routes";
import projectRoutes from "./routes/project.routes";
import taskRoutes from "./routes/task.routes";
import sectionRoutes from "./routes/section.routes";
import { authMiddleware } from "./middleware/auth";
import cookieParser from "cookie-parser";

export const app = express();
app.set("trust proxy", 1);

app.use(
  cors({
    origin: ["https://task-managerr.pp.ua", "http://localhost:5173"],
    credentials: true,
  }),
);
app.use(cookieParser());
app.use(express.json());
app.use("/api/auth", authRoutes);

app.use("/api/projects", authMiddleware, projectRoutes);
app.use("/api/tasks", authMiddleware, taskRoutes);
app.use("/api/sections", authMiddleware, sectionRoutes);import { Router } from "express";
import {
  createSection,
  updateSection,
  deleteSection,
} from "../controllers/section.controller";

import { authMiddleware } from "../middleware/auth";
const router = Router();

router.use(authMiddleware);

router.post("/", createSection);
router.patch("/:id", updateSection);
router.delete("/:id", deleteSection);

export default router;import { Router } from "express";
import {
  getProjects,
  getProjectBoard,
  createProject,
  updateProject,
  deleteProject,
} from "../controllers/project.controller";

import { authMiddleware } from "../middleware/auth";
const router = Router();

router.use(authMiddleware);
router.get("/", getProjects);
router.get("/:id", getProjectBoard);
router.post("/", createProject);
router.patch("/:id", updateProject);
router.delete("/:id", deleteProject);

export default router;import { Router } from "express";
import {
  register,
  login,
  deleteAcc,
  getMe,
  updateMe,
  logout,
} from "../controllers/auth.controller";
import { authMiddleware } from "../middleware/auth";

const router = Router();

router.get("/me", authMiddleware, getMe);
router.post("/register", register);
router.patch("/me", authMiddleware, updateMe);
router.post("/login", login);
router.post("/logout", logout);
router.delete("/me", authMiddleware, deleteAcc);

export default router;import { Request, Response, NextFunction } from "express";
import jwt from "jsonwebtoken";

const JWT_SECRET = process.env.JWT_SECRET || "super-secret-key";

interface AuthenticatedRequest extends Request {
  userId?: string;
}

export const authMiddleware = (
  req: AuthenticatedRequest,
  res: Response,
  next: NextFunction,
) => {
  const token = req.cookies.accessToken;

  if (!token) return res.status(401).json({ error: "No token provided" });

  try {
    const decoded = jwt.verify(token, JWT_SECRET) as { userId: string };
    req.userId = decoded.userId;
    next();
  } catch (e) {
    res.status(401).json({ error: "Invalid token" });
  }
};import { Request, Response } from "express";
import { prisma } from "../prisma";

interface AuthenticatedRequest extends Request {
  userId?: string;
}

export async function getTasks(req: AuthenticatedRequest, res: Response) {
  const { projectId, isDone } = req.query;
  const userId = req.userId as string;
  const projectIdString = Array.isArray(projectId) ? projectId[0] : projectId;

  const isDoneFilter =
    isDone === "true" ? true : isDone === "false" ? false : undefined;

  const tasks = await prisma.task.findMany({
    where: {
      userId,
      parentId: null,
      projectId: projectIdString || null,
      isDone: isDoneFilter ?? undefined,
    },
    include: {
      subtasks: {
        orderBy: [{ isDone: "asc" }, { order: "asc" }],
      },
    },
    orderBy:
      isDoneFilter === true
        ? [{ completedAt: "desc" }, { order: "asc" }]
        : [{ isDone: "asc" }, { order: "asc" }],
  });

  res.json(tasks);
}

export async function updateTask(req: AuthenticatedRequest, res: Response) {
  const { id } = req.params;
  const idString = typeof id === "string" ? id : id?.[0];
  const data = req.body;
  const userId = req.userId as string;

  delete data.userId;
  delete data.id;
  delete data.subtasks;

  if (data.deadline) data.deadline = new Date(data.deadline);

  try {
    await prisma.task.updateMany({
      where: { id: idString, userId },
      data: {
        ...data,
        ...(data.isDone !== undefined && {
          completedAt: data.isDone ? new Date() : null,
        }),
      },
    });

    const updatedTask = await prisma.task.findUnique({
      where: { id: idString },
      include: { subtasks: true },
    });

    res.json(updatedTask);
  } catch (error) {
    res.status(404).json({ error: "Task not found" });
  }
}

export async function createTask(req: AuthenticatedRequest, res: Response) {
  try {
    const {
      title,
      projectId,
      sectionId,
      parentId,
      comment,
      deadline,
      priority,
      order,
      reminderAt,
    } = req.body;

    const userId = req.userId as string;
    if (!title) {
      return res.status(400).json({ error: "title is required" });
    }
    const last = await prisma.task.findFirst({
      where: { sectionId, userId },
      orderBy: { order: "desc" },
    });

    const nextOrder = (last?.order ?? 0) + 1;

    const task = await prisma.task.create({
      data: {
        title,
        userId,
        projectId: projectId || null,
        sectionId: sectionId || null,
        parentId: parentId || null,
        comment: comment || null,
        priority: Number(priority) || 1,
        order: nextOrder,
        deadline: deadline ? new Date(deadline) : null,
        reminderAt: reminderAt || null,
      },
    });

    res.status(201).json(task);
  } catch (error) {
    const errorMessage =
      error instanceof Error ? error.message : "Unknown error";
    console.error("ОШИБКА PRISMA:", error);
    res.status(500).json({ error: errorMessage });
  }
}

export async function deleteTask(req: AuthenticatedRequest, res: Response) {
  const { id } = req.params;
  const idString = typeof id === "string" ? id : id?.[0];
  const userId = req.userId as string;
  try {
    await prisma.task.deleteMany({ where: { id: idString, userId } });
    res.status(204).send();
  } catch (e) {
    res.status(404).json({ error: "Task not found" });
  }
}

function normalizeId(id: string | string[] | undefined): string | undefined {
  if (!id) return undefined;
  return Array.isArray(id) ? id[0] : id;
}

export async function moveTask(req: AuthenticatedRequest, res: Response) {
  try {
    const userId = req.userId;
    const taskId = normalizeId(req.params.id);
    const { toSectionId, toParentId, beforeOrder, afterOrder } = req.body;

    if (!userId) return res.status(401).json({ error: "Unauthorized" });
    if (!taskId) return res.status(400).json({ error: "Task id is required" });

    const task = await prisma.task.findFirst({
      where: { id: taskId, userId },
    });
    if (!task) return res.status(404).json({ error: "Task not found" });

    const normalizedSectionId = toSectionId ?? null;
    const normalizedParentId = toParentId ?? null;

    const before = beforeOrder !== null ? Number(beforeOrder) : null;
    const after = afterOrder !== null ? Number(afterOrder) : null;

    let newOrder: number;
    if (before !== null && after !== null) {
      newOrder = (before + after) / 2;
    } else if (before === null && after !== null) {
      newOrder = after - 1;
    } else if (before !== null && after === null) {
      newOrder = before + 1;
    } else {
      return res.status(400).json({ error: "Invalid move payload" });
    }

    const updated = await prisma.task.update({
      where: { id: taskId },
      data: {
        sectionId: normalizedSectionId,
        parentId: normalizedParentId,
        order: newOrder,
      },
    });

    // Если задача родительская, нужно обновить order всех подзадач внутри
    if (!normalizedParentId) {
      const subtasks = await prisma.task.findMany({
        where: { parentId: taskId },
        orderBy: { order: "asc" },
      });

      for (let i = 0; i < subtasks.length; i++) {
        await prisma.task.update({
          where: { id: subtasks[i].id },
          data: { order: i + 1 },
        });
      }
    }

    res.json(updated);
  } catch (error) {
    console.error("MOVE TASK ERROR:", error);
    res.status(500).json({ error: "Failed to move task" });
  }
}import { Request, Response } from "express";
import { prisma } from "../prisma";

interface AuthenticatedRequest extends Request {
  userId?: string;
}

function normalizeId(id: string | string[] | undefined): string | undefined {
  if (!id) return undefined;
  return Array.isArray(id) ? id[0] : id;
}

export async function createSection(req: AuthenticatedRequest, res: Response) {
  try {
    const { title, projectId, order } = req.body;
    const userId = req.userId;

    if (!userId) return res.status(401).json({ error: "Unauthorized" });
    if (!title) return res.status(400).json({ error: "Title is required" });
    if (!projectId)
      return res.status(400).json({ error: "Project id is required" });

    const project = await prisma.project.findFirst({
      where: { id: String(projectId), userId },
    });

    if (!project) return res.status(403).json({ error: "Access denied" });

    const section = await prisma.section.create({
      data: {
        title: title.trim(),
        order: order ?? 0,
        projectId: String(projectId),
        userId,
      },
    });

    res.status(201).json(section);
  } catch (error) {
    const errorMessage =
      error instanceof Error ? error.message : "Unknown error";
    console.error("CREATE SECTION ERROR:", errorMessage);
    res.status(500).json({ error: errorMessage });
  }
}

export async function updateSection(req: AuthenticatedRequest, res: Response) {
  try {
    const userId = req.userId;
    const id = normalizeId(req.params.id);
    const { title, order } = req.body;

    if (!userId) return res.status(401).json({ error: "Unauthorized" });
    if (!id) return res.status(400).json({ error: "Section id is required" });

    const section = await prisma.section.findFirst({
      where: { id, project: { userId } },
    });

    if (!section) return res.status(404).json({ error: "Section not found" });

    const updated = await prisma.section.update({
      where: { id },
      data: {
        ...(title !== undefined && { title: title.trim() }),
        ...(order !== undefined && { order: Number(order) }),
      },
    });

    res.json(updated);
  } catch (error) {
    console.error("UPDATE SECTION ERROR:", error);
    res.status(500).json({ error: "Failed to update section" });
  }
}

export async function deleteSection(req: AuthenticatedRequest, res: Response) {
  try {
    const userId = req.userId;
    const id = normalizeId(req.params.id);

    if (!userId) return res.status(401).json({ error: "Unauthorized" });
    if (!id) return res.status(400).json({ error: "Section id is required" });

    const section = await prisma.section.findFirst({
      where: { id, project: { userId } },
    });

    if (!section) return res.status(404).json({ error: "Section not found" });

    await prisma.section.delete({
      where: { id },
    });

    res.status(204).send();
  } catch (error) {
    console.error("DELETE SECTION ERROR:", error);
    res.status(500).json({ error: "Failed to delete section" });
  }
}import { Request, Response } from "express";
import { prisma } from "../prisma";

interface AuthenticatedRequest extends Request {
  userId?: string;
}

export async function getProjects(req: AuthenticatedRequest, res: Response) {
  const userId = req.userId as string;

  const projects = await prisma.project.findMany({
    where: { userId },
    include: {
      sections: {
        orderBy: { order: "asc" },
      },
      _count: { select: { tasks: true } },
    },
    orderBy: { order: "asc" },
  });

  res.json(projects);
}

export async function getProjectBoard(
  req: AuthenticatedRequest,
  res: Response,
) {
  const { id } = req.params;

  try {
    const project = await prisma.project.findUnique({
      where: { id: String(id) },
      include: {
        sections: {
          orderBy: { order: "asc" },
          include: {
            tasks: {
              where: { parentId: null },
              orderBy: { order: "asc" },
              include: {
                subtasks: {
                  orderBy: { order: "asc" },
                },
              },
            },
          },
        },

        tasks: {
          where: {
            sectionId: null,
            parentId: null,
          },
          orderBy: { order: "asc" },
          include: {
            subtasks: {
              orderBy: { order: "asc" },
            },
          },
        },
      },
    });

    if (!project) return res.status(404).json({ error: "Project not found" });

    res.json(project);
  } catch (error) {
    res.status(500).json({ error: "Failed to fetch project data" });
  }
}

export async function createProject(req: AuthenticatedRequest, res: Response) {
  const { title, color, favorites, order } = req.body;
  const userId = req.userId as string;
  if (!title) {
    return res.status(400).json({ error: "title is required" });
  }

  const project = await prisma.project.create({
    data: {
      title,
      color,
      favorites: favorites ?? false,
      userId,
      order: order ?? 0,
    },
  });

  res.status(201).json(project);
}

export async function updateProject(req: AuthenticatedRequest, res: Response) {
  const { id } = req.params;

  const { title, color, favorites, order } = req.body;

  if (!id) {
    return res.status(400).json({ error: "id is required" });
  }

  try {
    const project = await prisma.project.updateMany({
      where: { id: String(id) },
      data: {
        ...(title !== undefined && { title }),
        ...(color !== undefined && { color }),
        ...(favorites !== undefined && { favorites }),
        ...(order !== undefined && { order }),
      },
    });
    res.json(project);
  } catch (error) {
    res.status(404).json({ error: "Project not found" });
  }
}

export async function deleteProject(req: AuthenticatedRequest, res: Response) {
  const { id } = req.params;

  await prisma.project.deleteMany({ where: { id: String(id) } });

  res.status(204).send();
}import { Request, Response } from "express";
import { prisma } from "../prisma";
import bcrypt from "bcrypt";
import jwt from "jsonwebtoken";

const JWT_SECRET = process.env.JWT_SECRET || "super-secret-key";

function setAuthCookie(res: Response, token: string) {
  const origin = res.req.headers.origin || "";
  const isLocalhost = origin.includes("localhost");

  res.cookie("accessToken", token, {
    httpOnly: true,

    secure: true,

    sameSite: isLocalhost ? "none" : "lax",

    ...(isLocalhost ? {} : { domain: ".task-managerr.pp.ua" }),

    maxAge: 7 * 24 * 60 * 60 * 1000,
    path: "/",
  });
}
interface AuthenticatedRequest extends Request {
  userId?: string;
}

export async function register(req: Request, res: Response) {
  const { userName, email, password } = req.body;
  const existingUser = await prisma.user.findUnique({
    where: { email },
  });
  if (existingUser) {
    return res.status(400).json({ error: "User already exists" });
  }
  const hashedPassword = await bcrypt.hash(password, 10);

  try {
    const user = await prisma.user.create({
      data: {
        userName: userName || email.split("@")[0],
        email,
        passwordHash: hashedPassword,
      },
      include: {
        _count: {
          select: {
            projects: true,
            tasks: true,
          },
        },
      },
    });

    const token = jwt.sign({ userId: user.id }, JWT_SECRET);
    setAuthCookie(res, token);

    res.status(201).json({
      user: {
        id: user.id,
        email: user.email,
        userName: user.userName,
        _count: user._count,
      },
    });
  } catch (error) {
    console.error("Register Error:", error);
    res.status(500).json({ error: "Failed to register user" });
  }
}

export async function getMe(req: AuthenticatedRequest, res: Response) {
  const userId = req.userId;

  try {
    const user = await prisma.user.findUnique({
      where: { id: userId },
      select: {
        id: true,
        email: true,
        userName: true,
        createdAt: true,
        _count: {
          select: {
            projects: true,
            tasks: { where: { isDone: false } },
          },
        },
      },
    });

    if (!user) {
      return res.status(404).json({ error: "User not found" });
    }

    res.json(user);
  } catch (error) {
    res.status(500).json({ error: "Internal server error" });
  }
}

export async function updateMe(req: AuthenticatedRequest, res: Response) {
  const userId = req.userId;
  const { userName, email } = req.body;

  try {
    const user = await prisma.user.update({
      where: { id: userId },
      data: {
        ...(userName !== undefined && { userName }),
        ...(email !== undefined && { email }),
      },
      select: {
        id: true,
        email: true,
        userName: true,
        createdAt: true,
      },
    });

    res.json(user);
  } catch (error) {
    const e = error as { code?: string; message?: string };
    if (e.code === "P2002") {
      return res.status(400).json({ error: "Этот email уже занят" });
    }
    res.status(500).json({ error: "Internal server error" });
  }
}

export async function login(req: Request, res: Response) {
  const { email, password } = req.body;
  if (!email || !password) {
    return res.status(400).json({ error: "Email and password are required" });
  }
  try {
    const user = await prisma.user.findUnique({
      where: { email },
      include: {
        _count: {
          select: {
            projects: true,
            tasks: true,
          },
        },
      },
    });

    if (!user) {
      return res.status(401).json({ error: "Invalid credentials" });
    }
    const isPasswordValid = await bcrypt.compare(password, user.passwordHash);
    if (!isPasswordValid) {
      return res.status(401).json({ error: "Invalid credentials" });
    }

    const token = jwt.sign({ userId: user.id }, JWT_SECRET);
    setAuthCookie(res, token);

    res.json({
      user: {
        id: user.id,
        email: user.email,
        userName: user.userName,
        _count: user._count,
      },
    });
  } catch (error) {
    console.error("Login Error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}

export async function deleteAcc(req: AuthenticatedRequest, res: Response) {
  const userId = req.userId;

  try {
    await prisma.user.delete({
      where: { id: userId },
    });

    res.status(204).send();
  } catch (error) {
    console.error("Delete Acc Error:", error);
    res.status(500).json({ error: "Failed to delete account" });
  }
}

export async function logout(req: Request, res: Response) {
  const origin = req.headers.origin || "";
  const isLocalhost = origin.includes("localhost");
  const isProduction = process.env.NODE_ENV === "production";

  res.clearCookie("accessToken", {
    httpOnly: true,
    secure: true,
    sameSite: isLocalhost ? "none" : "lax",
    ...(isLocalhost ? {} : { domain: ".task-managerr.pp.ua" }),
    path: "/",
  });

  res.status(200).json({ message: "Logged out successfully" });
} проект написан за полторы месяца и есть еще много чего что я бы хотела сделать но пока так чтобы по быстрее уже пойти на совбес и еще там уже есть заготовки например на секции и дран н дроп но пока не доделанные 